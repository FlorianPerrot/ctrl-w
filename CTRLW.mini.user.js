// ==UserScript==
// @name        CTRL+W
// @namespace   Mush
// @license     MIT License (Expat)
// @include     http://mush.vg/*
// @include     http://mush.twinoid.com/*
// @include     http://mush.twinoid.es/*
// @downloadURL http://localhost/CTRLW.user.mini.js
// @grant       GM_xmlhttpRequest
// @grant       GM_addStyle
// @grant       GM_getResourceText
// @grant       unsafeWindow
// @require     lib/jquery-1.11.1.min.js
// @require     lib/Gettext.js
// @resource    css:jgrowl lib/jquery.jgrowl.css
// @resource    jgrowl lib/jquery.jgrowl.js
// @resource    mush lib/Mush.js
// @resource    translation:fr translations/fr/LC_MESSAGES/ctrl-w.po
// @resource    translation:en translations/en/LC_MESSAGES/ctrl-w.po
// @resource    translation:es translations/es/LC_MESSAGES/ctrl-w.po
// @version     0.35.20
// ==/UserScript==
function addFctToPage(e,t){var a=document,i=a.createElement("script");i.type="text/javascript",e&&(i.textContent=e),t&&(i.textContent=t+" = "+e);var n=a.getElementsByTagName("head")[0]||a.body||a.documentElement;n.appendChild(i)}var Main=unsafeWindow.Main,_tid=unsafeWindow._tid,js=unsafeWindow.js;js.JQuery=$;var mt=unsafeWindow.mt,mush_jquery=unsafeWindow.$;if("undefined"==typeof exportFunction)var exportFunction=function(e,t,a){return e};if("undefined"==typeof createObjectIn)var createObjectIn=function(e,t){return{}};if("undefined"==typeof cloneInto)var cloneInto=function(e,t,a){return e};if(Main.k=createObjectIn(unsafeWindow.Main,{defineAs:"k"}),Main.k.window=unsafeWindow,Main.k.version=GM_info.script.version,Main.k.website="http://ks26782.kimsufi.com/ctrlw",Main.k.servurl="http://ctrl-w.badconker.com",Main.k.servurl_badconker="http://ctrlw.badconker.com",Main.k.window=window,Main.k.domain=document.domain,Main.k.mushurl="http://"+document.domain,Main.k.debug=!1,Main.k.errorList=[],Main.k.debug)var console=unsafeWindow.console;else{var console={};console.log=console.error=console.info=console.debug=console.warn=console.trace=console.dir=console.dirxml=console.group=console.groupEnd=console.time=console.timeEnd=console.assert=console.profile=function(){}}String.prototype.htmlEncode=function(){return $("<div/>").text(this).html()},String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},String.prototype.replaceFromObj=function(e){var t=this;for(var a in e)e.hasOwnProperty(a)&&(t=t.replace(new RegExp(a,"g"),e[a]));return t},String.prototype.hashCode=function(){var e=0;if(0==this.length)return e;for(i=0;i<this.length;i++)char=this.charCodeAt(i),e=(e<<5)-e+char,e&=e;return e},RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},Main.k.initLang=function(){switch(Main.k.domain){case"mush.twinoid.com":Main.k.lang="en";break;case"mush.twinoid.es":Main.k.lang="es";break;default:Main.k.lang="fr"}Main.k.textInit=exportFunction(function(){Main.k.text=new Gettext({domain:"ctrl-w"})},unsafeWindow),Main.k.textInit();try{var e=GM_getResourceText("translation:"+Main.k.lang);if("undefined"==typeof e)return void console.warn("No translations for '"+Main.k.lang+"'");var t=Main.k.text.parse_po(e);Main.k.text.parse_locale_data({"ctrl-w":t})}catch(a){console.error("Error getting translation data:",a)}},Main.k.initData=function(){Main.k.playing=Main.heroes.iterator().hasNext(),Main.k.BMAXWIDTH=1160,Main.k.HEROES=["jin_su","frieda","kuan_ti","janice","roland","hua","paola","chao","finola","stephen","ian","chun","raluca","gioele","eleesha","terrence","andie","derek"],Main.k.HEROES_ALL=Main.k.HEROES.slice(),Main.k.COMMANDERS=["jin_su","chao","gioele","stephen","frieda","kuan_ti","hua","derek","roland","raluca","finola","paola","terrence","eleesha","andie","ian","janice","chun"],Main.k.COMMS=["paola","eleesha","andie","stephen","janice","roland","hua","derek","jin_su","kuan_ti","gioele","chun","ian","finola","terrence","frieda","chao","raluca"],Main.k.ADMINS=["janice","terrence","eleesha","raluca","finola","andie","frieda","ian","stephen","paola","jin_su","hua","kuan_ti","gioele","chun","roland","chao","derek"],Main.k.HEROES.replace={finola:"andie",chao:"derek"},Main.k.h={mush:{tutorial:Main.k.text.gettext("tutorial_id:mush")},jin_su:{short_desc:Main.k.text.gettext("Commandant suprême du Daedalus."),tutorial:Main.k.text.gettext("tutorial_id:jin_su"),dev_surname_long:"kim_jin_su"},frieda:{short_desc:Main.k.text.gettext("Scientifique millénaire."),tutorial:Main.k.text.gettext("tutorial_id:frieda"),dev_surname_long:"frieda_bergmann"},kuan_ti:{short_desc:Main.k.text.gettext("Grand architecte du Daedalus."),tutorial:Main.k.text.gettext("tutorial_id:kuan_ti"),dev_surname_long:"lai_kuan_ti"},janice:{short_desc:Main.k.text.gettext("Psychologue Digitale aux atouts certains."),tutorial:Main.k.text.gettext("tutorial_id:janice"),dev_surname_long:"janice_kent"},roland:{short_desc:Main.k.text.gettext("Humoriste pilote de chasse à ses heures."),tutorial:Main.k.text.gettext("tutorial_id:roland"),dev_surname_long:"roland_zuccali"},hua:{short_desc:Main.k.text.gettext("Exploratrice de l'EXTRÊME."),tutorial:Main.k.text.gettext("tutorial_id:hua"),dev_surname_long:"jiang_hua"},paola:{short_desc:Main.k.text.gettext("Officier principal des Communications du Daedalus."),tutorial:Main.k.text.gettext("tutorial_id:paola"),dev_surname_long:"paola_rinaldo"},chao:{short_desc:Main.k.text.gettext("Chef de la sécurité du Daedalus."),tutorial:Main.k.text.gettext("tutorial_id:chao"),dev_surname_long:"wang_chao"},finola:{short_desc:Main.k.text.gettext("Biologiste de renommée internationale, pionnière dans l'étude du Mush."),tutorial:Main.k.text.gettext("tutorial_id:finola"),dev_surname_long:"finola_keegan"},stephen:{short_desc:Main.k.text.gettext("Cuisinier le plus dangereux de la galaxie."),tutorial:Main.k.text.gettext("tutorial_id:stephen"),dev_surname_long:"stephen_seagull"},ian:{short_desc:Main.k.text.gettext("Chercheur frugivore flexible."),tutorial:Main.k.text.gettext("tutorial_id:ian"),dev_surname_long:"ian_soulton"},chun:{short_desc:Main.k.text.gettext("Dernier espoir de l'Humanité."),tutorial:Main.k.text.gettext("tutorial_id:chun"),dev_surname_long:"zhong_chun"},raluca:{short_desc:Main.k.text.gettext("Génie de la physique quantique félinophile."),tutorial:Main.k.text.gettext("tutorial_id:raluca"),dev_surname_long:"raluca_tomescu"},gioele:{short_desc:Main.k.text.gettext("Armateur philantrophobe."),tutorial:Main.k.text.gettext("tutorial_id:gioele"),dev_surname_long:"gioele_rinaldo"},eleesha:{short_desc:Main.k.text.gettext("Investigatrice déchue de premier plan."),tutorial:Main.k.text.gettext("tutorial_id:eleesha"),dev_surname_long:"eleesha_williams"},terrence:{short_desc:Main.k.text.gettext("Technophile motorisé."),tutorial:Main.k.text.gettext("tutorial_id:terrence"),dev_surname_long:"terrence_archer"},andie:{short_desc:Main.k.text.gettext("Fayot de la fédération."),tutorial:Main.k.text.gettext("tutorial_id:andie"),dev_surname_long:"andie_graham"},derek:{short_desc:Main.k.text.gettext("Héros malgré lui."),tutorial:Main.k.text.gettext("tutorial_id:derek"),dev_surname_long:"derek_hogan"}},$.each(Main.k.h,function(e,t){var a=$(this)[0];"undefined"!=typeof a.dev_surname_long&&(a.name=a.dev_surname_long.replace("_"," ").capitalize())}),Main.k.cssToHeroes=[],Main.k.cssToHeroes["-1185px"]="janice",Main.k.cssToHeroes["-1282px"]="chao",Main.k.cssToHeroes["-1335px"]="eleesha",Main.k.cssToHeroes["-1233px"]="ian",Main.k.cssToHeroes["-1444px"]="terrence",Main.k.cssToHeroes["-1554px"]="hua",Main.k.cssToHeroes["-1499px"]="jin_su",Main.k.cssToHeroes["-1604px"]="jin_su",Main.k.cssToHeroes["-1391px"]="raluca",Main.k.cssToHeroes["-1681px"]="stephen",Main.k.cssToHeroes["-1728px"]="paola",Main.k.cssToHeroes["-1056px"]="roland",Main.k.compActiveMush=[],Main.k.compInactiveMush=[],Main.k.compInactiveMush.cold_blood=!0,Main.k.compInactiveMush.opportunist=!0,Main.k.compInactiveMush.optimistic=!0,Main.k.compInactiveMush.mycologist=!0,Main.k.compInactiveMush.panic=!0,Main.k.compInactiveMush.caffeinomaniac=!0,Main.k.compInactiveMush.frugivore=!0,Main.k.researchGlory=[],Main.k.researchGlory.drug_dispenser=0,Main.k.researchGlory.healing_ointmant=0,Main.k.researchGlory.natamy_gun=0,Main.k.researchGlory.ncc_lens=0,Main.k.researchGlory.spore_extractor=0,Main.k.researchGlory.steroids=0,Main.k.researchGlory.tesla_sup2x=0,Main.k.researchGlory.antispore_gaz=3,Main.k.researchGlory.constipaspore_serum=3,Main.k.researchGlory.fungus_scrambler=3,Main.k.researchGlory.infinite_water=3,Main.k.researchGlory.mushicide_soap=3,Main.k.researchGlory.mushophage_bacteria=3,Main.k.researchGlory.myco_alarm=3,Main.k.researchGlory.mycoscan=3,Main.k.researchGlory.patuline_scrambler=3,Main.k.researchGlory.pheromodem=3,Main.k.researchGlory.mush_breeding_system=6,Main.k.researchGlory.mush_breeds=6,Main.k.researchGlory.myco_dialect=6,Main.k.researchGlory.mush_predator=6,Main.k.researchGlory.anti_mush_serum=16,Main.k.statusImages=[],Main.k.statusImages.bronze="http://imgup.motion-twin.com/twinoid/6/b/8b8ae4d5_4030.jpg",Main.k.statusImages.silver="http://imgup.motion-twin.com/twinoid/a/e/3c341777_4030.jpg",Main.k.statusImages.gold="http://imgup.motion-twin.com/twinoid/c/1/4e43e15c_4030.jpg",Main.k.statuses={inactive:{desc:Main.k.text.gettext("Vous ne vous êtes pas connecté depuis 24h. Bonne chance pour la suite..."),img:"sleepy",name:Main.k.text.gettext("Inactif")},hinactive:{desc:Main.k.text.gettext("Description grand inactif"),img:"noob",name:Main.k.text.gettext("Grand inactif")},mush:{desc:Main.k.text.gettext("Vous faites partie du Mush."),img:"mush",name:Main.k.text.gettext("Mush")}}},Main.k.init=function(){Main.k.initLang(),Main.k.Options.init(),Main.k.Game.init(),Main.k.initData(),Main.k.displayMainMenu(),$(window).load(function(){$("img[data-async_src]").each(function(){$(this).attr("src",$(this).attr("data-async_src")),$(this).removeAttr("data-async_src")})})},Main.k.getFullName=function(e){return e.replace(/_/g," ").capitalize()},Main.k.getHeroBySurname=function(e){console.info("Main.heroes",Main.heroes);for(var t=Main.heroes.iterator();t.hasNext();){var a=t.next();if(console.log(e,a.dev_surname),a.dev_surname==e)return a}return null},Main.k.MakeButton=function(e,t,a,i,n){var s=$("<div>").addClass("action but"),o=$("<div>").addClass("butright").appendTo(s),r=$("<div>").addClass("butbg").appendTo(o),l=$("<a>").attr("href",t?t:"#").html(e).appendTo(r).on("click",a?a:t?null:function(){return!1});return null!=t&&t.indexOf(Main.k.text.gettext("mush.vg"))&&l.attr("target","_blank"),(i||n)&&(i&&l.attr("_title",i),n&&l.attr("_desc",n),l.on("mouseover",Main.k.CustomTip),l.on("mouseout",Main.k.hideTip)),s},Main.k.clearCache=function(){Main.k.showLoading(),Main.k.Game.clear(),localStorage.removeItem("ctrlw_update_cache"),localStorage.removeItem("ctrlw_remaining_cycles"),window.location.reload()},Main.k.treatingBug=function(e){Main.k.errorList+=e},Main.k.displayBug=function(e){var t="",a=[];void 0!=Main.k.errorList&&(a=Main.k.errorList);for(var i=0;i<a.length;i++)t+="Name : "+a[i].name+"Message : "+a[i].message+"\n";a.length>0&&alert("nbError : "+a.length+"\n\n"+t)},Main.k.showLoading=function(){if(0==$(".ctrlw_overlay_loading").length){var e=$('<div class="ctrlw_overlay_loading"></div>');$("body").append(e),e.after('<div class="ctrlw_loading_ball_wrapper"><div class="ctrlw_loading_ball"></div><div class="ctrlw_loading_ball1"></div></div>')}},Main.k.hideLoading=function(){$(".ctrlw_overlay_loading,.ctrlw_loading_ball_wrapper").remove()},Main.k.displayMainMenu=function(){Main.k.css.customMenu();var e=$("ul.mtabs").length>0?70:20;$("#maincontainer, .boxcontainer").css("margin",e+"px auto 0"),Main.k.ownHero=$(".hero h1.who").length>0?$(".who").html().toLowerCase().trim().replace(/(\s)/g,"_"):!1,Main.k.silver=!0,Main.k.fds=$("a.butmini[href='/fds']").length>0;var t=$("<ul>").addClass("kmenu").insertBefore("#maincontainer, .boxcontainer"),a=$("<li class='kmenuel active first'><a href='"+Main.k.mushurl+"/chooseHero'>"+Main.k.text.gettext("Jouer")+"</a></li>").appendTo(t),i=$("<li class='kmenuel'><a href='"+Main.k.mushurl+"/me'>"+Main.k.text.gettext("Mon compte")+"</a></li>").appendTo(t);if("ForumCastingsId"!=Main.k.text.gettext("ForumCastingsId")){$("<li class='kmenuel' id='ctrlw-main-menu-castings'><a href='"+Main.k.mushurl+"/group/list'>"+Main.k.text.gettext("Castings")+"</a></li>").appendTo(t)}var n=$("<li class='kmenuel'><a href='"+Main.k.mushurl+"/ranking'>"+Main.k.text.gettext("Classements")+"</a></li>").appendTo(t),s=$("<li class='kmenuel'><a href='"+Main.k.mushurl+"/tid/forum'>"+Main.k.text.gettext("Forum")+"</a></li>").appendTo(t),o=$("<li class='kmenuel last'><a href='"+Main.k.mushurl+"/help'>"+Main.k.text.gettext("Aide")+"</a></li>").appendTo(t),r=$("<ul>").appendTo(a),l=$("<ul>").attr("id","accountmenu").appendTo(i);$("<li><a class='kssmenuel' href='"+Main.k.mushurl+"/me'><img src='/img/icons/skills/persistent.png' />"+Main.k.text.gettext("Expérience")+"</a></li>").appendTo(l),$("<li><a class='kssmenuel' href='"+Main.k.mushurl+"/me?profile'><img src='/img/icons/skills/opportunist.png' />"+Main.k.text.gettext("Ma fiche")+"</a></li>").appendTo(l),$("<li><a class='kssmenuel' href='"+Main.k.mushurl+"/me?config'><img src='/img/icons/skills/engineer.png' />"+Main.k.text.gettext("Mes réglages")+"</a></li>").appendTo(l),$("<li><a class='kssmenuel' href='"+Main.k.mushurl+"/me?news'><img src='/img/icons/skills/radio_expert.png' />"+Main.k.text.gettext("News")+"</a></li>").appendTo(l);var p=$("<ul>").appendTo(n);$("<li><a class='kssmenuel' href='"+Main.k.mushurl+"/ranking'><img src='/img/icons/skills/persistent.png' />"+Main.k.text.gettext("Classements")+"</a></li>").appendTo(p),$("<li><a class='kssmenuel ext' href='http://twinorank.kubegb.fr/jeux/Mush' target='_blank'><img src='/img/icons/skills/persistent.png' />Twin-O-Rank</a></li>").appendTo(p);var d=$("<ul>").appendTo(s);"ForumDiscussionId"!=Main.k.text.gettext("ForumDiscussionId")&&$("<li><a class='kssmenuel ext' href='"+Main.k.mushurl+"/tid/forum#!view/"+Main.k.text.gettext("ForumDiscussionId")+"'><img src='"+Main.k.servurl+"/img/radioh.png' />"+Main.k.text.gettext("Discussion")+"</a></li>").appendTo(d),"ForumAdviceId"!=Main.k.text.gettext("ForumAdviceId")&&$("<li><a class='kssmenuel ext' href='"+Main.k.mushurl+"/tid/forum#!view/"+Main.k.text.gettext("ForumAdviceId")+"'><img src='"+Main.k.servurl+"/img/radioh.png' />"+Main.k.text.gettext("Entraide")+"</a></li>").appendTo(d),"ForumLoungeId"!=Main.k.text.gettext("ForumLoungeId")&&$("<li><a class='kssmenuel ext' href='"+Main.k.mushurl+"/tid/forum#!view/"+Main.k.text.gettext("ForumLoungeId")+"'><img src='"+Main.k.servurl+"/img/radioh.png' />"+Main.k.text.gettext("Détente")+"</a></li>").appendTo(d),"ForumCastingsId"!=Main.k.text.gettext("ForumCastingsId")&&$("<li><a class='kssmenuel ext' href='"+Main.k.mushurl+"/tid/forum#!view/"+Main.k.text.gettext("ForumCastingsId")+"'><img src='"+Main.k.servurl+"/img/radioh.png' />"+Main.k.text.gettext("Castings")+"</a></li>").appendTo(d),"ForumOfficersId"!=Main.k.text.gettext("ForumOfficersId")&&$("<li><a class='kssmenuel ext' href='"+Main.k.mushurl+"/tid/forum#!view/"+Main.k.text.gettext("ForumOfficersId")+"'><img src='/img/icons/skills/rebel.png' />"+Main.k.text.gettext("Officiers")+"</a></li>").appendTo(d);var c=$("<ul>").appendTo(o);if($("<li><a class='kssmenuel' href='"+Main.k.mushurl+"/help'><img src='/img/icons/skills/genius.png' />"+Main.k.text.gettext("Aide Mush")+"</a></li>").appendTo(c),$("<li><a class='kssmenuel' href='"+Main.k.mushurl+"/patchlog'><img src='/img/icons/skills/persistent.png' />"+Main.k.text.gettext("Patchlog")+"</a></li>").appendTo(c),Main.k.ownHero&&"undefined"!=typeof Main.k.h[Main.k.ownHero]){var u=Main.k.ownHero.replace("_","");$("<li><a class='kssmenuel ext' href='"+Main.k.mushurl+"/tid/forum#!view/"+Main.k.text.gettext("ForumAdviceId")+"|thread/"+Main.k.h[Main.k.ownHero].tutorial+"'><img src='/img/icons/ui/"+u+".png' />"+Main.k.text.strargs(Main.k.text.gettext("Tuto %1"),[Main.k.ownHero.capitalize()])+"</a></li>").appendTo(c)}$("<li><a class='kssmenuel ext' target='_blank' href='"+Main.k.text.gettext("http://www.twinpedia.com/mush")+"'><img data-async_src='"+Main.k.text.gettext("http://www.twinpedia.com/_media/favicon.ico")+"' />"+Main.k.text.gettext("Twinpedia")+"</a></li>").appendTo(c),$("<li><a class='kssmenuel ext' href='http://pictoid.fr/mush/picto' target='_blank'><img data-async_src='http://pictoid.fr/favicon.png' />Pictoid</a></li>").appendTo(c),Main.k.fds&&($("<li><a class='kssmenuel ext' href='"+Main.k.mushurl+"/tid/forum#!view/"+Main.k.text.gettext("ForumFDSId")+"'><img src='/img/icons/skills/juge.png' />"+Main.k.text.gettext("Magistrature")+"</a></li>").appendTo(d),$("<li><a class='kssmenuel' href='"+Main.k.mushurl+"/fds'><img src='/img/icons/skills/juge.png' />FDS</a></li>").appendTo(r)),Main.k.updateMainMenu()},Main.k.updateMainMenu=function(){var e=$("#ctrlw-main-menu-castings"),t=e.find(" > ul");t.length>0&&t.remove(),t=$("<ul>").appendTo(e);var a=Main.k.Game.data.castings;if(!$.isEmptyObject(a)){var i,n;$.each(a,function(e,a){i=$("<li></li>").appendTo(t);var s=$("<a class='kssmenuel' href='"+Main.k.mushurl+"/group/"+a.id+"'><img src='"+a.icon+"' />"+a.short_name+"</a>").appendTo(i);a.long_name!=a.short_name&&s.attr("_title",Main.k.text.gettext("Nom complet")).attr("_desc","<strong>"+a.long_name+"</strong>").on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),n=$("<ul>").appendTo(i),$("<li><a href='"+Main.k.mushurl+"/group/page/"+a.id+"'><img src='"+Main.k.mushurl+"/img/icons/skills/conceptor.png' />"+Main.k.text.gettext("Mémoire")+"</a></li>").appendTo(n),$("<li><a href='"+Main.k.mushurl+"/group/nexus/"+a.id+"'><img src='"+Main.k.mushurl+"/img/icons/skills/logistics.png' />"+Main.k.text.gettext("Nexus")+"</a></li>").appendTo(n),$("<li><a href='"+Main.k.mushurl+"/group/forum/"+a.id+"'><img src='"+Main.k.servurl+"/img/radioh.png' />"+Main.k.text.gettext("Forum")+"</a></li>").appendTo(n),$("<li><a href='"+Main.k.mushurl+"/group/members/"+a.id+"'><img src='"+Main.k.mushurl+"/img/icons/skills/optimistic.png' />"+Main.k.text.gettext("Membres")+"</a></li>").appendTo(n),$("<li><a href='"+Main.k.mushurl+"/group/history/"+a.id+"'><img src='"+Main.k.mushurl+"/img/icons/skills/hunt.png' />"+Main.k.text.gettext("Historique")+"</a></li>").appendTo(n)}),$("<li style='height:2px'>&nbsp</li>").appendTo(t)}$("<li><a href='http://mtrg.kubegb.fr/' class='kssmenuel ext' title='Mush Triumph Remap Generator'><img src='"+Main.k.mushurl+"/img/icons/ui/triumph.png' />MTRG</a></li>").appendTo(t)},Main.k.CreateNeronAlert=function(e){var t=Main.k.CreatePopup();t.content.css({height:"auto","max-height":"90%",width:"500px",color:"#FFF"});var a="<img class=\"img_neron\" alt='neron' src='/img/design/neron_chat.png' /><p>"+e+"</p>",i="'Main.k.ClosePopup();'",n='<div id="cancel" class="but updatesbtn" onclick='+i+'><div class="butright"><div class="butbg"><a href="#">'+Main.k.text.gettext("ok")+"</a></div></div></div></div>",s=$('<div class="neron_alert_buttons"></div>');s.append(n),$("<div>").attr("id","neron_alert_content").append(a).append(s).appendTo(t.content),Main.k.OpenPopup(t.dom)},Main.k.CreateNeronPrompt=function(){var e=Main.k.CreatePopup();e.content.css({height:"auto","max-height":"90%",width:"500px",color:"#FFF"});var t="'Main.k.ClosePopup();'",a='<div id="validate" class="but updatesbtn" ><div class="butright"><div class="butbg"><a href="#">'+Main.k.text.gettext("valider")+"</a></div></div></div></div>",i='<div id="cancel" class="but updatesbtn" onclick='+t+'><div class="butright"><div class="butbg"><a href="#">'+Main.k.text.gettext("annuler")+"</a></div></div></div></div>",n="<input type='text' name='neron_prompt'>",s="<img class=\"img_neron\" alt='neron' src='/img/design/neron_chat.png' /><p>"+Main.k.text.gettext("Saisissez le titre du message")+" : </p>";$("<div>").attr("id","neron_alert_content").html(s+n+"<br/>"+a+i).appendTo(e.content),Main.k.OpenPopup(e.dom)},Main.k.quickNotice=function(e,t){"undefined"==typeof t||"info"==t?$.jGrowl("<img src='http://imgup.motion-twin.com/twinoid/8/5/ab7aced9_4030.jpg' height='16' alt='notice'/> "+e):"error"==t&&$.jGrowl("<img src='http://imgup.motion-twin.com/twinoid/9/a/8429c028_4030.jpg' height='16' alt='notice'/> "+e,{theme:"ctrlw-error",life:6e3})},Main.k.quickNoticeError=function(e){Main.k.quickNotice(e,"error")},Main.k.CreatePopup=function(){var e={};return e.dom=$("<td>").attr("id","usPopup").addClass("usPopup chat_box"),e.mask=$("<div>").addClass("usPopupMask").attr("onclick","Main.k.ClosePopup();").appendTo(e.dom),e.content=$("<div>").addClass("usPopupContent chattext").css({width:Main.k.window.innerWidth-300+"px",height:Main.k.window.innerHeight-100+"px"}).appendTo(e.dom),e},Main.k.OpenPopup=function(e){$("body").append(e)},Main.k.ClosePopup=function(){var e=$("#usPopup");if(e.get()){e.remove();var t=$("#formattingpopuptgt");t.get()&&(t.focus(),t.attr("id",""))}},exportFunction(Main.k.ClosePopup,unsafeWindow.Main.k,{defineAs:"ClosePopup"}),Main.k.SyncAstropad=function(e){var t=$("#astro_maj_inventaire");t.length>0&&(t[0].click(),Main.k.quickNotice(Main.k.text.gettext("Astropad synchronisé.")),Main.showTip(e,"<div class='tiptop' ><div class='tipbottom'><div class='tipbg'><div class='tipcontent'>"+Main.k.text.gettext("Astropad synchronisé.")+"</div></div></div></div>"))},Main.k.CustomTip=function(e){var t=(e||event).target,a=t.getAttribute("_title"),i=t.getAttribute("_desc");i&&(i=i.replace(/(\\r|\\n)/g,""));for(var n=3,s=0,o=t;!a&&!i&&n>s;)o=o.parentNode,a=o.getAttribute("_title"),i=o.getAttribute("_desc"),i&&(i=i.replace(/(\\r|\\n)/g,"")),s++;Main.showTip(t,"<div class='tiptop' ><div class='tipbottom'><div class='tipbg'><div class='tipcontent'>"+(a?"<h1>"+a+"</h1>":"")+(i?"<p>"+i.replace("\n","")+"</p>":"")+"</div></div></div></div>")},Main.k.hideTip=function(){Main.hideTip()},Main.k.countdownTimer={},Main.k.countdownTimer.counters={},Main.k.countdownTimer.go=function(e,t,a){var i=e,n=this;this.counters[t]=setInterval(function(){i--,a(i),0>=i&&clearInterval(n.counters[t])},1e3)},Main.k.countdownTimer.stop=function(e){"undefined"!=typeof this.counters[e]&&clearInterval(this.counters[e])},Main.k.ArrayContains=function(e,t){for(var a in e)if(a==t)return!0;for(var i=0;i<e.length;i++)if(e[i]==t)return!0;return!1},Main.k.EliminateDuplicates=function(e){var t,a=e.length,i=[],n={};for(t=0;a>t;t++)n[e[t]]=0;for(t in n)n.hasOwnProperty(t)&&i.push(t);return i},Main.k.GetHeroNameFromTopic=function(e){var t="",a=null;if(e.find(".char,.tid_char").length>0&&(a=e.find(".char,.tid_char"),t=a.attr("class").replace("char ","").replace("tid_char tid_","")),null!=a&&""==t){var i=a.css("backgroundPosition").split(" "),n=i[1];t=Main.k.cssToHeroes[n]}return t?t:"jin_su"},Main.k.css={},Main.k.css.bubbles=function(){var e="3px",t="text-shadow: 0 0 "+e+" #FFF, 0 0 "+e+" #FFF, 0 0 "+e+" #FFF, 0 0 "+e+" #FFF, 0 0 "+e+" #FFF, 0 0 "+e+" #FFF, 0 0 "+e+" #FFF;";$("<style>").attr("type","text/css").html("	.bubble_stephen {		background: url("+Main.k.servurl+"/img/tile_stephen.png) center repeat #FFF! important;		border: 1px solid #b48d75;"+t+"		padding: 3px 5px! important;	}	.bubble_hua {		background: url("+Main.k.servurl+"/img/tile_hua.png) center repeat #FFF! important;		border: 1px solid #6c543e;"+t+"		padding: 3px 5px! important;	}	.bubble_frieda {		background: url("+Main.k.servurl+"/img/tile_frieda.png) center repeat #FFF! important;		border: 1px solid #204563;"+t+"		padding: 3px 5px! important;	}	.bubble_roland {		background: url("+Main.k.servurl+"/img/tile_roland.png) center repeat #FFF! important;		border: 1px solid #dc3d8d;"+t+"		padding: 3px 5px! important;	}	.bubble_paola {		background: url("+Main.k.servurl+"/img/tile_paola.png) center repeat #FFF! important;		border: 1px solid #792b70;"+t+"		padding: 3px 5px! important;	}	.bubble_jin_su {		background: url("+Main.k.servurl+"/img/tile_jin_su.png) center repeat #FFF! important;		border: 1px solid #a41834;"+t+"		padding: 3px 5px! important;	}	.bubble_chao {		background: url("+Main.k.servurl+"/img/tile_chao.png) center repeat #FFF! important;		border: 1px solid #5457b0;"+t+"		padding: 3px 5px! important;	}	.bubble_derek {		background: url("+Main.k.servurl+"/img/tile_chao.png) center repeat #FFF! important;		border: 1px solid #5457b0;"+t+"		padding: 3px 5px! important;	}	.bubble_finola {		background: url("+Main.k.servurl+"/img/tile_finola.png) center repeat #FFF! important;		border: 1px solid #35adbc;"+t+"		padding: 3px 5px! important;	}	.bubble_andie {		background: url("+Main.k.servurl+"/img/tile_finola.png) center repeat #FFF! important;		border: 1px solid #35adbc;"+t+"		padding: 3px 5px! important;	}	.bubble_kuan_ti {		background: url("+Main.k.servurl+"/img/tile_kuan_ti.png) center repeat #FFF! important;		border: 1px solid #e89413;"+t+"		padding: 3px 5px! important;	}	.bubble_ian {		background: url("+Main.k.servurl+"/img/tile_ian.png) center repeat #FFF! important;		border: 1px solid #647c27;"+t+"		padding: 3px 5px! important;	}	.bubble_eleesha {		background: url("+Main.k.servurl+"/img/tile_eleesha.png) center repeat #FFF! important;		border: 1px solid #dca312;"+t+"		padding: 3px 5px! important;	}	.bubble_terrence {		background: url("+Main.k.servurl+"/img/tile_terrence.png) center repeat #FFF! important;		border: 1px solid #55141c;"+t+"		padding: 3px 5px! important;	}	.bubble_janice {		background: url("+Main.k.servurl+"/img/tile_janice.png) center repeat #FFF! important;		border: 1px solid #df2b4e;"+t+"		padding: 3px 5px! important;	}	.bubble_raluca {		background: url("+Main.k.servurl+"/img/tile_raluca.png) center repeat #FFF! important;		border: 1px solid #4c4e4c;"+t+"		padding: 3px 5px! important;	}	.bubble_chun {		background: url("+Main.k.servurl+"/img/tile_chun.png) center repeat #FFF! important;		border: 1px solid #3aa669;"+t+"		padding: 3px 5px! important;	}	.bubble_gioele {		background: url("+Main.k.servurl+"/img/tile_gioele.png) center repeat #FFF! important;		border: 1px solid #cb5b29;"+t+"		padding: 3px 5px! important;	}	.custombubbles_nobackground {		background: #FFF! important;	}	.bubble_stephen span.buddy, .colored_stephen { color: #b48d75! important; }	.bubble_hua span.buddy, .colored_hua { color: #6c543e! important; }	.bubble_frieda span.buddy, .colored_frieda { color: #204563! important; }	.bubble_roland span.buddy, .colored_roland { color: #dc3d8d! important; }	.bubble_paola span.buddy, .colored_paola { color: #792b70! important; }	.bubble_jin_su span.buddy, .colored_jin_su { color: #a41834! important; }	.bubble_chao span.buddy, .colored_chao { color: #5457b0! important; }	.bubble_derek span.buddy, .colored_derek { color: #5457b0! important; }	.bubble_finola span.buddy, .colored_finola { color: #35adbc! important; }	.bubble_andie span.buddy, .colored_andie { color: #35adbc! important; }	.bubble_kuan_ti span.buddy, .colored_kuan_ti { color: #e89413! important; }	.bubble_ian span.buddy, .colored_ian { color: #647c27! important; }	.bubble_eleesha span.buddy, .colored_eleesha { color: #dca312! important; }	.bubble_terrence span.buddy, .colored_terrence { color: #55141c! important; }	.bubble_janice span.buddy, .colored_janice { color: #df2b4e! important; }	.bubble_raluca span.buddy, .colored_raluca { color: #4c4e4c! important; }	.bubble_chun span.buddy, .colored_chun { color: #3aa669! important; }	.bubble_gioele span.buddy, .colored_gioele { color: #cb5b29! important; }	.bubble .replybuttons { text-shadow: none! important; }	.bubble ::-moz-selection {		text-shadow: none! important;		background: #38F;		color: #fff;	}	.bubble ::-webkit-selection {		text-shadow: none! important;		background: #38F;		color: #fff;	}	.bubble ::selection {		text-shadow: none! important;		background: #38F;		color: #fff;	}	.planet .analyse .buttons .share-planet.but{		width:20px;	}	").appendTo("head")},Main.k.css.customMenu=function(){$("<style>").attr("type","text/css").html("	body.gold #maincontainer{margin-top:543px !important;}	#menuBar { display: none; }	.mxhead a[class^=logo] { position: relative! important; display: block; }	.mxhead {padding:0}	.kmenu {		margin: 10px auto 20px;		text-align: center;	}	.kmenuel {		position: relative;		display: inline-block;		border: 1px solid rgba(19,32,85,0.8);		border-left: none;		background: #003baf;		box-shadow: 0 2px 3px 1px rgba(0,0,0,0.3), inset 0px -15px 15px -10px rgba(0,0,0,0.5);	}	.kmenuel a {		display: block;		width: 160px;		height: 24px;		padding: 4px 5px;		color: #DDD! important;		text-decoration: none! important;		text-shadow: 0 0 3px #000;	}	.kmenuel:hover a { color: #FFF! important; }	.kmenuel a:hover { color: rgb(255, 78, 100)! important; }	.kmenuel a:hover li {		color: #FFF! important;		text-shadow: 0 0 1px #000;	}	.kmenuel:hover {		border-color: rgb(19,32,85);		background: #0044bd;		box-shadow: 0 2px 3px 1px rgba(0,0,0,0.3), inset 0px 5px 15px 0px rgba(0,0,0,0.4);	}	.kmenuel.first {		border-left: 1px solid rgba(19,32,85,0.8);		border-top-left-radius: 8px;		border-bottom-left-radius: 8px;	}	.kmenuel.last {		border-top-right-radius: 8px;		border-bottom-right-radius: 8px;	}	.kmenuel ul { display: none; }	.kmenuel ul a { display: block; width: auto; padding: 0px 5px }	.kmenuel:hover > ul {		display: block;		position: absolute;		width: 100%;		top: 33px;		left: 0;		text-align: right;		z-index: 9;		padding: 0;	}	.kmenuel ul li:hover ul {		display: block;		position: absolute;		width: 100%;		text-align: right;		z-index: 9;		padding: 0;	}	.kmenuel ul li {		text-align: left;		margin: 0 3px;		display: block! important;		border: 1px solid rgb(2,16,66);		border-top: none! important;		height: auto;		background: #0071e3;		color: #EEE;		text-shadow: 0 0 1px #000;		text-decoration: none! important;		box-shadow: 0 2px 3px 1px rgba(0,0,0,0.3), inset 0px -8px 8px -5px rgba(0,0,0,0.3);	}	.kmenuel ul li:hover {		background: #0094ff;		text-shadow: 0 0 3px #000;		box-shadow: 0 2px 3px 1px rgba(0,0,0,0.3), inset 0px 4px 8px 0px rgba(0,0,0,0.3);	}	.kmenuel ul li ul {		right: -160px;		top: 0px;	}	.kmenuel ul li img {		margin-right : 5px;		position: relative;		top: 2px;		height: 16px;	}	.kmenuel .kssmenuel{		display:block;		line-height: 22px;	}	").appendTo("head")},Main.k.css.ingame=function(){Main.k.css.bubbles(),$("<style>").attr("type","text/css").html("	.tid_editorContent {	  visibility: visible;	 }	.blink-limited {		-moz-animation: blink 1s 3 linear;		-webkit-animation: blink 1s 3 linear;	}	@-moz-keyframes blink {		from { opacity: 1; }		50% { opacity: 0; }		to { opacity: 1; }	}	@-webkit-keyframes blink {		from { opacity: 1; }		50% { opacity: 0; }		to { opacity: 1; }	}	.but.loading{		overflow:hidden;	}	.but.loading:before{		background: -moz-linear-gradient(left, rgba(255,255,255,0) 0%, rgba(255,255,255,0.65) 50%, rgba(255,255,255,0.1) 95%, rgba(255,255,255,0) 100%); /* FF3.6+ */		background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba(255,255,255,0)), color-stop(50%,rgba(255,255,255,0.65)), color-stop(95%,rgba(255,255,255,0.1)), color-stop(100%,rgba(255,255,255,0))); /* Chrome,Safari4+ */		background: -webkit-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(255,255,255,0.65) 50%,rgba(255,255,255,0.1) 95%,rgba(255,255,255,0) 100%); /* Chrome10+,Safari5.1+ */		background: -o-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(255,255,255,0.65) 50%,rgba(255,255,255,0.1) 95%,rgba(255,255,255,0) 100%); /* Opera 11.10+ */		background: linear-gradient(to right, rgba(255,255,255,0) 0%,rgba(255,255,255,0.65) 50%,rgba(255,255,255,0.1) 95%,rgba(255,255,255,0) 100%); /* W3C */		content: '';		height: 21px;		left: 0;		position: absolute;		width: 70px;		-moz-animation: loading-button 1s infinite linear;		-webkit-animation: loading-button 1s infinite linear;	}	@-moz-keyframes loading-button{		from { margin-left: -70px; }		to {margin-left: 100%; }	}	@-webkit-keyframes loading-button{		from { margin-left: -70px; }		to {margin-left: 100%; }	}	.ctrlw_overlay_loading{		background-color: #4E5162;		background-image: url('http://data.twinoid.com/img/design/mask.png');		height : 100%;		left : 0;		opacity:0.9;		position : fixed;		top : 0;		width : 100%;		z-index:1000;	}	.ctrlw_loading_ball_wrapper{		position:fixed;		left:50%;		top:50%;		z-index:1001;	}	.ctrlw_loading_ball {		background-color: rgba(0,0,0,0);		border: 5px solid rgba(0,183,229,0.9);		opacity: 1;		border-top: 5px solid rgba(0,0,0,0);		border-left: 5px solid rgba(0,0,0,0);		border-radius: 50px;		box-shadow: 0 0 35px #2187e7;		width: 50px;		height: 50px;		margin: 0 auto;		-moz-animation: spin .5s infinite linear;		-webkit-animation: spin .5s infinite linear;	}	.ctrlw_loading_ball1 {		background-color: rgba(0,0,0,0);		border: 5px solid rgba(0,183,229,0.9);		opacity: 1;		border-top: 5px solid rgba(0,0,0,0);		border-left: 5px solid rgba(0,0,0,0);		border-radius: 50px;		box-shadow: 0 0 15px #2187e7;		width: 30px;		height: 30px;		margin: 0 auto;		position: relative;		top: -50px;		-moz-animation: spinoff .5s infinite linear;		-webkit-animation: spinoff .5s infinite linear;	}	@-moz-keyframes spin {		0% {			-moz-transform: rotate(0deg);		}		100% {			-moz-transform: rotate(360deg);		};	}	@-moz-keyframes spinoff {		0% {			-moz-transform: rotate(0deg);		}			100% {			-moz-transform: rotate(-360deg);		};	}	@-webkit-keyframes spin {		0% {			-webkit-transform: rotate(0deg);		}		100% {			-webkit-transform: rotate(360deg);		};	}	@-webkit-keyframes spinoff {		0% {			-webkit-transform: rotate(0deg);		}		100% {			-webkit-transform: rotate(-360deg);		};	}	.mxhead { height: 0; }	.cdReadMeHook { display: none! important; }	.tabon { background-image: url("+Main.k.servurl+"/img/tabon.png)! important; }	.taboff { background-image: url("+Main.k.servurl+"/img/taboff.png)! important; }	.taboff:hover { background-image: url("+Main.k.servurl+"/img/tabon.png)! important; }	td.chat_box .right {		position: relative;		background: url("+Main.k.servurl+"/img/chatbgtop.png) no-repeat scroll right top;	}	td.chat_box .right:before {		content: '';		display: block;		position: absolute;		top: 0; left: 0; right: 6px;		height: 5px;		background: rgb(194, 243, 252);	}	td.chat_box .chattext .bubble .talks .from { background-image: url("+Main.k.servurl+"/img/chat_from_left.png)! important; }	.customtabs li { margin-right: 3px; margin-bottom: 0! important; }	html { overflow-x: auto; width: 100%; }	body { background-position: 50% -100px; overflow-x: hidden! important; min-width: "+Main.k.BMAXWIDTH+"px; width: 100%; }	ul.mtabs li { margin-right: 5px! important; }	.helpguide { display: none; }	#tid_bar_down { clear: both; }	#cdMainChat { position: relative; }	#cdTabsChat { margin: 0; top: -24px; }	#topinfo_bar { margin-top: 5px; }	#tooltip { z-index: 100! important; }	#floating_ui_start { position: absolute; top: 42px; left: 5px; z-index: 20; }	.mtabs a { color: #FFF! important; }	#char_col .sheetmain { position: relative; }	#char_col .statuses { margin: 0! important; top: 10px; left: 7px; }	#char_col .skills { margin: 0! important; top: 0px; left: 177px; }	span.highlight {		background: #FF6;		padding: 0 2px;		margin: 0 -2px;	}	.exploring {		top: -30px! important;		right: 15px! important;		width: 200px! important;		height: 24px! important;		z-index: 20;		overflow: hidden! important;	}	.exploring .exploring2 {		height: 22px! important;	}	.exploring:hover {		width: auto! important;		height: auto! important;	}	.exploring:hover .exploring2 {		height: auto! important;	}	a.butmini { 		outline: none! important; 		position: relative;	}	a.butmini:after { 		display: block;		content: '';		position: absolute;		top: 0px; bottom: 0px; left: 0px; right: 0px;		border: 1px solid #1D2028;		z-index: 3;	}	.customreply { 		right: -7px! important;		bottom: 2px! important;		text-align: right;	}	.customreply a { 		opacity: 0.8;	}	.customreply a:hover { 		opacity: 1;	}	.chatformatbtn { 		float: right;		margin-right: 5px! important;		margin-top: 7px! important;		width: auto! important;	}	.chatformatbtn img { 		vertical-align: middle! important;	}	.alertnbwrapper { 		position: absolute;		top: 16px;		left: -3px;		height: 17px;		width: 22px;		text-align: center;		overflow: visible;		cursor: default;		z-index: 1;	}	.alertnbwrapper .alertnb { 		position: relative;		display: inline-block;		background: url(/img/design/alarm_on_bg.gif) repeat-x bottom;		color: rgb(255, 78, 100);		padding: 0 0px;		font-size: 10px;		line-height: 16px;		height: 17px;		min-width: 10px;	}	.alertnbwrapper .alertnb:before { 		content: '';		display: block;		position: absolute;		left: -4px;		top: 0px;		bottom: 0px;		width: 4px;		background: url("+Main.k.servurl+"/img/alertleft.gif) bottom left;	}	.alertnbwrapper .alertnb:after { 		content: '';		display: block;		position: absolute;		right: -4px;		top: 0px;		bottom: 0px;		width: 4px;		background: url("+Main.k.servurl+"/img/alertright.gif) bottom right;	}	.usLeftbar { 		position: relative;		float: left;		background-color: #17195B;		background: url('/img/design/bg_right.png') right repeat-y;		border-right: 1px solid rgba(0,0,0,0.1);		box-shadow: 1px 0 3px 1px rgba(0,0,0,0.2);		min-height: 725px;		margin-right: 15px;		padding: 8px 0;		width: 125px;	}	.usLeftbar:before { 		display: block;		content: '';		position: absolute;		top: 0; bottom: 0; right: 113px;		width: 10000px;		background-color: #17195B;		z-index: -1;	}	.usLeftbar h3 { 		clear: both;		position: relative;		margin: 20px 0 10px;		padding: 0 16px 2px 4px;		color: rgba(255,255,255,0.8);		font-variant: small-caps;		font-size: 15px;		border-bottom: 1px solid rgba(255,255,255,0.6);	}	.usLeftbar h3:before { 		display: block;		content: '';		position: absolute;		bottom: -3px; left: 0; right: 0;		border-bottom: 1px solid rgba(255,255,255,0.6);	}	.usLeftbar h3.first { 		margin: 0 0 10px 0! important;	}	.usLeftbar h3 span { 		position: absolute;		width: 16px;		height: 16px;		top: 1px; right: 4px;		cursor: pointer;		opacity: 0.4;	}	.usLeftbar h3 span:hover { 		opacity: 1;	}	.usLeftbar h3 .displaymore { 		background: url(/img/icons/ui/more.png);	}	.usLeftbar h3 .displayless { 		background: url(/img/icons/ui/less.png);	}	.usLeftbar .hero { 		position: relative;		clear: both;		margin: 10px 0;		height: 36px;		padding-right: 20px;		background: rgba(255,255,255,0.08);		border-top: 1px solid rgba(255,255,255,0.1);		border-bottom: 1px solid rgba(255,255,255,0.1);	}	.usLeftbar .missingheroes { 		position: relative;		clear: both;		margin: 10px 0;		padding: 1px 3px 3px;		line-height: 0px;		background: rgba(255,255,255,0.08);		border-top: 1px solid rgba(255,255,255,0.1);		border-bottom: 1px solid rgba(255,255,255,0.1);	}	.usLeftbar img { 		opacity: 0.7;	}	.butbg img.alerted {		vertical-align: -20%;		margin-right: -10px;	}	.butbg img.alert {		position: relative;		left: 0px;		top: 2px;		transform: scale(1);	}	.usLeftbar .inventory { 		padding-left: 4px;	}	.usLeftbar .item { 		position: relative;		transform: scale(0.5);		-webkit-transform: scale(0.5);		margin: -14px;	}	.usLeftbar .item img.broken { 		position: absolute;		right: 2px; top: 1px;		transform: scale(1.2);		-webkit-transform: scale(1.2);		opacity: 1! important;	}	.usLeftbar .item span.charges { 		position: absolute;		padding: 0px 2px;		left: 2px; bottom: 1px;		background: rgba(0,0,0,0.7);		transform: scale(1.2);		-webkit-transform: scale(1.2);	}	.usLeftbar .item span.charges img { 		width: 12px; height: 12px;	}	.usLeftbar .body { 		float: left;		position: relative;		opacity: 1;		left: -5px;		top: -5px;		width: 28px;		height: 44px;		background: url('/img/art/char.png') no-repeat;		z-index: 2;	}	.usLeftbar .missingheroes .body { 		height: 24px;		opacity: 0.7;		position: static! important;		float: none! important;		margin: 0 -3px! important;	}	.usLeftbar .hero .icons{		white-space: nowrap;		position: relative;		left: -2px;	}	.usLeftbar img:hover { 		opacity: 1 !important;	}	.usLeftbar .but,	.ctrlw.but{ 		margin: 0 2px;	}	.usLeftbar .but img { 		opacity: 1;	}	.usLeftbar .hero .skills { 		top: 2px;	}	.usLeftbar .hero .skills span.skill { 		position: relative;	}	.icons.skills .skill{		display: inline-block;		font-size: 0;		position: relative;	}	.icons.skills{		height: 18px;		margin-bottom:3px;	}	.usLeftbar .hero .skills span.skill img.actmush,	.icons.skills .skill img.actmush	 { 		position: absolute;		bottom: -3px;		right: 0px;		opacity: 1! important;	}	.usLeftbar .hero .titles { 		position: absolute;		top: -3px;		right: 2px;		width: 16px;		line-height: 12px;		z-index: 2;	}	.usLeftbar .titles_list .icon { 		margin: 0px 5px 3px 4px;		opacity: 1;	}	.usLeftbar .titles_list .body { 		height: 24px;		opacity: 0.5;		position: static! important;		float: none! important;		margin: 0 -3px! important;	}	.usLeftbar .projectspreview { 		text-align: center;	}	.usLeftbar .labpreview { 		max-width: 120px;	}	.usLeftbar .projectpreview { 		display: inline-block;		position: relative;		margin: 0 1px;		width: 34px;		height: 43px;		overflow: hidden;		border: 1px solid #458ddf;	}	.usLeftbar .projectpreview img.projectimg { 		position: absolute;		top: -15px;		left: -7px;		z-index: 1;	}	.usLeftbar .projectpreview:hover img.projectimg { 		opacity: 1;	}	.usLeftbar .projectpreview .projectpct { 		position: absolute;		top: 6px;		left: 0px;		width: 34px;		text-align: center;		font-weight: bold;		font-size: 14px;		text-shadow: 0 0 6px black;		cursor: default;		z-index: 3;	}	.usLeftbar .projectpreview .projectbonus { 		position: absolute;		bottom: 0px;		left: 0px;		width: 34px;		height: 16px;		text-align: center;		z-index: 3;	}	.usLeftbar .projectpreview .projectbonus img { 		height: 16px;		opacity: 1;	}	td.chat_box .chattext .wall .mainmessage.neron_talks {		background-color : #74CBF3! important;		font-variant: small-caps;	}	#tabreply_content .loading, #tabcustom_content .loading { 		text-align: center;		margin-top: 42px;	}	#tabreply_content .wall, #tabcustom_content .wall { 		resize: none;	}	#tabreply_content .tid_buttons, #tabcustom_content .tid_buttons { 		width: 100%;		text-align: center;		margin: 5px 0;	}	#tabreply_content .tid_button, #tabcustom_content .tid_button { 		min-width: 0! important;		display: inline-block;		margin: 10px 4px;		padding: 3px 8px;	}	#tabreply_content textarea, #tabcustom_content textarea, #tabreply_content .reply, #tabcustom_content .reply { 		width: 95%;		height: 80px! important;		resize: none! important;		margin: 3px auto! important;		background-color: #fff;		box-shadow: inset 0 0 3px #aad4e5, 0px 1px 0px #fff;		border: 1px solid #aad4e5;		border-radius : 3px;		color: rgb(10,40,80);		padding: 3px 5px;		font-size: 10pt;		overflow: auto;		text-align: left;	}	#tabreply_content form, #tabcustom_content form  { 		height: 100%! important;	}	#tabreply_content .tid_wrapper, #tabcustom_content .tid_wrapper { 		height: 100%! important;		padding: 4px;	}	#tabreply_content .tid_smileyPanel, #tabcustom_content .tid_smileyPanel { 		margin: 2px auto;	}	#tabreply_content .tid_smileyPopUp .tid_wrapper, #tabcustom_content .tid_smileyPopUp .tid_wrapper  { 		max-height: 80px! important;	}	#tabcustom_content .array_messages_prerecorded { 		padding: 10px 10px 10px 35px;		background-color: #e1f9fe;		border-bottom: 1px solid #aad4e5;		border-top: 1px solid #aad4e5;		text-align: center;	}	#tabcustom_content .message_prerecorded { 		margin: 2px;		padding: 2px 4px;		box-shadow: inset 0 0 3px #aad4e5, 0px 1px 0px #fff;		border: 1px solid #aad4e5;		border-radius : 3px;		cursor:  pointer;	}	#tabcustom_content .selected{ 		background-color: #a1c9ce;	}	.recap p { 		border: 1px solid rgb(9,10,97);		background: rgba(255,255,255,0.3);		margin: 10px 20px;		padding: 2px;		text-align: center;	}	.recap .chars { 		text-align: center;	}	.recap .chars .hero { 		display: inline-block;		position: relative;		width: 26px;		height: 30px;	}	.recap .chars .hero img { 		position: absolute;		top: 0; left: 4px;	}	.recap .chars .hero span { 		position: absolute;		bottom: 0; left: 0;		width: 100%;		text-align: center;		font-size: 10px;	}	.recap .chars .highlight { 		width: 105px;		height: 16px;		margin-bottom: 6px;	}	.recap .chars .highlight span { 		top: 0px; left: 24px;		width: auto;		line-height: 16px;		text-align: left;		font-size: 12px;	}	.recap textarea { 		display: block;		height: 40px;		width: 90%;		border: 1px solid rgb(10,40,80);		padding: 2px;		margin: 5px auto;		font-size: 10px;		color: rgb(10,40,80);		opacity: 0.4;		resize: none;	}	.recap textarea:active { 		opacity: 1;	}	.recap textarea:focus { 		opacity: 1;	}	#tabtopic_content .mainmessage { 		margin: 3px 5px;	}	#tabtopic_content table.treereply { 		width: 92%;	}	#tabtopic_content td.tree { 		width: 15px;	}	#tabfav_content .reply, #tabsearch_content .reply, #tabnew_content .reply, #tabwall_content .reply { 		max-height: 65px;		overflow-y: hidden! important;		width: 92%;		margin: 5px 5px 0! important;	}	#tabfav_content .topicact, #tabsearch_content .topicact, #tabnew_content .topicact, #tabwall_content .topicact { 		display: block;		text-align: center;		color: rgb(150,22,12)! important;		margin: 0 20px 8px;	}	#tabsearch_content { 		padding-top: 30px;		position: relative;	}	#tabsearch_content .bar { 		position: absolute;		top: 0px;		left: 0px;		right: 0px;		text-align: center;		padding: 4px 0;		border-bottom: 1px solid #555;	}	#tabsearch_content .bar input[type=text] { 		color: black;		padding: 1px 3px;		border: 1px solid #555;	}	#tabsearch_content .bar .butmini { 		margin: 0px 2px -6px;		padding: 3px 4px;	}	#searchresults h4 { 		margin: 4px 8px; 		font-size: 14px; 	}	#searchresults p.help { 		margin: 4px 8px; 	}	#searchresults p.help i { 		color: rgb(80,10,10); 	}	.usPopup { 		display: block! important;		position: fixed;		top: 23px;		bottom: 0px;		left: 0px;		right: 0px;		z-index: 98;	}	.usPopup .usPopupMask { 		position: absolute;		top: 0; bottom: 0; right: 0; left: 0;		background: rgba(0,0,0,0.8);		z-index: -1;	}	.usPopup .usPopupContent { 		position: relative;		margin: 100px auto 0 auto;		background: rgba(28, 56, 126, 0.976);		box-shadow: 0px 0px 3px 3px rgba(57, 101, 251, 0.5), 0px 0px 3px 3px rgba(57, 101, 251, 0.5) inset;		resize: none! important;	}	.popup-content{		margin: 30px;	}	.popup-actions{		margin-bottom: 10px;		text-align: center;	}	.updatescontent { 		margin: 30px;	}	.updatescontent ul.updateslist { 		font-size: 12px;		margin: 10px;	}	.updatescontent ul.updateslist li { 		margin-left: 20px;		list-style-type: square;	}	.updatesactions{ 		text-align: center;		margin-bottom: 10px;	}	.updatesbtn { 		display: inline-block;		margin: 0 3px;	}	#neron_alert_content {		padding: 10px;	}	#neron_alert_content .img_neron{		float:left;		height:45px;		margin:0 8px 5px 0;	}	#neron_alert_content p{		margin: 10px 0;	}	#neron_alert_content input{		color: black;		margin-bottom: 10px;	}	.neron_alert_buttons{		text-align: center;	}	#char_col, #room_col, #chat_col, #topics_col, #topic_col, #reply_col, #options_col, #about_col, #profile_col {		transition: all 200ms;		-webkit-transition: all 200ms;		-o-transition: all 200ms;	}	#profile_col .hero-details{		height: 95px;		margin-left: 95px;		margin-right: 5px;		position: relative;	}	.profile-custom-infos{		border-top: 1px solid #FFF;		bottom: 0;		padding-top: 3px;		position: absolute;		width: 100%;	}	.profile-custom-infos label{		margin-right: 10px;	}	#profile-notes{	}	#profile-notes textarea{		height:40px;		display: block;		margin-bottom: 12px;		margin-top: 5px;		resize: none;	}	#profile-notes textarea:last-child{		height:146px;		overflow: hidden;	}	#profile-notes .actions {		bottom: 3px;		left: 0;		position: absolute;		right: 0;		text-align: center;	}	#profile-notes .profile-content{		height: 260px;		overflow: hidden;		padding: 0 10px;	}	/** pour régler les probleme du au scale css3 sur firefox**/	#char_col .sheetbgcontent table td.two .extrapa{		position:relative;	}	#cdMainContent{		position:relative;	}	.ctrlw_col input,	.ctrlw_col textarea{		color: #090A61;	}	.ctrlw-row-options{		background: none repeat scroll 0 0 rgba(255, 255, 255, 0.1);		border: 1px dashed #EEEEEE;		clear: both;		color: #EEEEEE;		margin: 10px 20px;		padding: 5px;	}	.ctrlw_col{		color: rgb(9,10,97);	}	.ctrlw_col p{		margin: 10px 0;	}	").appendTo("head"),
-1==navigator.userAgent.indexOf("Firefox")&&$(".usLeftbar .hero .icons").css("padding-right","30px")},Main.k.Game={},Main.k.Game.data={},Main.k.Game.data.day=0,Main.k.Game.data.cycle=0,Main.k.Game.data.xp=1,Main.k.Game.data.player_status="bronze",Main.k.Game.data.castings={},Main.k.Game.init=function(){var e=localStorage.getItem("ctrlw_game");null!=e&&(Main.k.Game.data=JSON.parse(e))},Main.k.Game.displayRemainingCyclesToNextLevel=function(){$(".levelingame").each(function(){var e,t,a=/(<p>.*>[^0-9]?)([0-9]+)([a-zA-Z ]*)(<)(.*<\/p>)/;if(void 0!==$(this).attr("onmouseover_save")?e=$(this).attr("onmouseover_save"):(e=$(this).attr("onmouseover"),$(this).attr("onmouseover_save",e)),null!=a.exec(e)){t="gold"==Main.k.Game.data.player_status?2:1;var i=RegExp.$2,n=localStorage.getItem("ctrlw_remaining_cycles");localStorage.setItem("ctrlw_remaining_cycles",i),n!=i&&null!=n&&Main.k.Game.updatePlayerInfos();var s=Math.ceil(i-Main.k.Game.data.xp/t),o=8;$('.miniConf img[src*="fast_cycle"]').length>0?o=12:$('.miniConf img[src$="blitz_cycle.png"]').length>0&&(o=24);var r=Math.round(s/o),l="";r>0&&(l=Main.k.text.strargs(Main.k.text.ngettext("(~%1 jour)","(~%1 jours)",r),[r]),l=" "+l),$(this).attr("onmouseover",e.replace(a,"$1"+s+"$3"+l+"$4$5"))}}),$(".levelingame_no_anim").length>0&&localStorage.setItem("ctrlw_remaining_cycles",0)},Main.k.Game.updateDayAndCycle=function(e,t){(e!=this.data.day||t!=this.data.cycle)&&(this.data.day=e,this.data.cycle=t,Main.k.Game.onCycleChange(),this.updatePlayerInfos(),this.save())},Main.k.Game.onCycleChange=function(){localStorage.removeItem("ctrlw_update_cache"),localStorage.removeItem("ctrlw_remaining_cycles",0)},Main.k.Game.clear=function(){Main.k.Game.data.day=0,this.save()},Main.k.Game.save=function(){localStorage.setItem("ctrlw_game",JSON.stringify(Main.k.Game.data))},Main.k.Game.updateDayAndCycle=function(e,t){(e!=this.data.day||t!=this.data.cycle)&&(this.data.day=e,this.data.cycle=t,Main.k.onCycleChange(),this.updatePlayerInfos(),this.save())},Main.k.Game.updatePlayerInfos=function(){var e=this;console.info("Mise à jour des infos joueurs - envoi"),Tools.ping("/me",function(t){console.group("Mise à jour des infos joueurs - retour");var a='<div id="body-mock">'+t.replace(/^[\s\S]*<body.*?>|<\/body>[\s\S]*$/g,"")+"</div>",i=$(a);console.log("récupération de l'xp"),i.find("#cdActualXp").length>0&&(e.data.xp=i.find("#cdActualXp").text(),console.log("xp",e.data.xp)),console.log("récupération du statut du joueur"),i.find("#experience .bought.goldactive").length>0?(e.data.player_status="gold",console.log("le joueur est gold")):i.find("#experience .bought").length>0?(e.data.player_status="silver",console.log("le joueur est silver")):(e.data.player_status="bronze",console.log("le joueur est bronze")),e.data.castings={},i.find("#profile .bgtablesummar:last li").each(function(t,a){var n={};n.id=$(this).find("a").attr("href").replace("/group/",""),n.icon=$(this).find("img").attr("src");var s=i.find(".nameCast a:eq("+t+")").text();n.long_name=n.short_name=s,s.length>18&&(n.short_name=s.match(/\b(\w)/g).join(".").concat(".")),e.data.castings[n.id]=n}),e.save(),Main.k.MushUpdate(),Main.k.updateMainMenu(),Main.k.quickNotice(Main.k.text.gettext("Infos du joueur mises à jour."))})},Main.k.Options={},Main.k.Options.initialized=!1,Main.k.Options.cbubbles=!1,Main.k.Options.cbubblesNB=!1,Main.k.Options.dlogo=!1,Main.k.Options.splitpjt=!0,Main.k.Options.altpa=!1,Main.k.Options.mushNoConf=!1,Main.k.Options.options=[],Main.k.Options.init=function(){Main.k.Options.options=[["cbubbles",Main.k.Options.cbubbles,!1,Main.k.customBubbles,Main.k.text.gettext("Activer la mise en forme personnalisée des messages (bordure + couleur nom + image de fond).")],["cbubblesNB",Main.k.Options.cbubblesNB,!1,Main.k.customBubbles,Main.k.text.gettext("Simplifier la mise en forme personnalisée des messages (suppression de l'image de fond).")],["dlogo",Main.k.Options.dlogo,!0,null,Main.k.text.gettext("Afficher le logo Mush au dessus des onglets.")],["splitpjt",Main.k.Options.splitpjt,!1,Main.k.updateBottom,Main.k.text.gettext("Séparer les projets / recherches / pilgred sous la zone de jeu.")]];var e=js.Cookie.get("ctrlwoptions");if(e)for(var t=e.split("|"),a=0;a<t.length;a++){var i=t[a].split(":"),n=i[0],s=i[1];Main.k.Options.updateOpt(n,s)}},Main.k.Options.open=function(){if("options"==Main.k.folding.displayed)return void Main.k.folding.displayGame();if(!Main.k.Options.initialized){Main.k.Options.initialized=!0;var e=$("<td>").addClass("chat_box").css({"padding-right":"6px","padding-top":"1px",transform:"scale(0,1)",color:"rgb(9,10,97)"}).attr("id","options_col").appendTo($("table.inter tr").first());$("<p>").addClass("warning").text(Main.k.text.gettext("Plus d'options disponibles prochainement.")).appendTo(e);for(var t=0;t<Main.k.Options.options.length;t++){var a=Main.k.Options.options[t],i=a[4];a[2]&&(i+=" "+Main.k.text.gettext("Nécessite un rechargement de la page."));var n=$("<p>").css({color:"#EEE",padding:"5px",border:"1px dashed #EEE",background:"rgba(255,255,255,0.1)",margin:"10px 20px",clear:"both"}).html('<label style="margin-left: 30px;display:block" for="ctrlw_'+a[0]+'">'+i+"</label>").appendTo(e),s=$("<input>").css({"float":"left"}).attr("type","checkbox").attr("optname",a[0]).attr("id","ctrlw_"+a[0]).attr("opti",t).on("change",Main.k.Options.update).prependTo(n);a[1]&&s.attr("checked","checked")}Main.k.MakeButton("<img src='/img/icons/ui/reported.png' style='vertical-align: -20%' /> "+Main.k.text.gettext("Vider le cache du script"),null,null,Main.k.text.gettext("Vider le cache du script"),Main.k.text.gettext("Ce bouton vous permet de vider le cache du script pour, par exemple, prendre en compte tout de suite votre mode Or ou forcer une vérification de mise à jour. A utiliser avec parcimonie svp.")).appendTo(e).find("a").on("mousedown",function(){Main.k.clearCache()})}Main.k.folding.display([null,null,"#options_col"],"options")},Main.k.Options.update=function(e){var t=$(e.target),a=$(t).attr("optname"),i=$(t).is(":checked")?"y":"n",n=$(t).attr("opti");Main.k.Options.updateOpt(a,i),Main.k.Options.updateCookie(),Main.k.Options.options[n][3]&&Main.k.Options.options[n][3]()},Main.k.Options.updateCookie=function(){for(var e="",t=0;t<Main.k.Options.options.length;t++)t>0&&(e+="|"),e+=Main.k.Options.options[t][0]+":",e+=Main.k.Options.options[t][1]?"y":"n";js.Cookie.set("ctrlwoptions",e,42e7)},Main.k.Options.updateOpt=function(e,t){switch(e){case"custombubbles":case"cbubbles":Main.k.Options.cbubbles="y"==t,Main.k.Options.options[0][1]="y"==t;break;case"custombubbles_nobackground":case"cbubblesNB":Main.k.Options.cbubblesNB="y"==t,Main.k.Options.options[1][1]="y"==t;break;case"displaylogo":case"dlogo":Main.k.Options.dlogo="y"==t,Main.k.Options.options[2][1]="y"==t;break;case"splitpjt":Main.k.Options.splitpjt="y"==t,Main.k.Options.options[3][1]="y"==t}},Main.k.tabs={},Main.k.tabs.credits=function(){$("blockquote").css("overflow","visible"),$("blockquote p").css({height:"auto","font-size":"10pt","margin-top":"10px"}),$("#extra").find(".nova").css("display","none"),$("<div>").addClass("mainmenu").html('<ul id="menuBar">		<li class="daed"><a href="/">Jouer</a></li>		<li><a href="/me">Mon Compte</a></li>		<li><a href="/ranking">Classement</a></li>		<li><a href="/tid/forum">Forum</a></li>	</ul>').appendTo(".mxhead"),$(".scoremush").siblings("h3").css("color","rgb(255, 64, 89)"),$(".triumphmush").siblings(".dude").find("h3").css("color","rgb(255, 64, 89)")},Main.k.tabs.expPerma=function(){Main.k.Options.cbubbles&&(Main.k.css.bubbles(),$("div.exploreevent p").each(function(){var e=[],t=[];$("ul.adventurers .char").each(function(){var a=Main.k.GetHeroNameFromTopic($(this).parent()),i=a.replace("_"," ").capitalize();t.push('<span class="colored_'+a+'"><img src="/img/icons/ui/'+a.replace("_","")+'.png" /> '+i+"</span>"),e.push(i)});for(var a=$(this).html(),i=0;i<e.length;i++){var n=new RegExp(e[i],"g");a=a.replace(n,t[i])}$(this).html(a)}))},Main.k.tabs.gameover=function(){var e=$("#logtri li span, #logtri div div li"),t={humanC:0,researchMin:0,research:0,hunter:0,expe:0,planet:0},a=/([0-9]+)\sx\s([^\(]+)\s\(\s(?:\+|-)\s([0-9]+)\s\)/,i=$("#logtri");i.find("div").css("display","block"),i.find(".rreadmore").css("display","none"),e.each(function(){var e=!1,i=a.exec($(this).html());switch(i[2].trim()){case Main.k.text.gettext("Cycle Humain"):e=!0,t.humanC+=parseInt(i[1]);break;case Main.k.text.gettext("Recherche Mineur"):e=!0,t.researchMin+=parseInt(i[1]);break;case Main.k.text.gettext("Recherche"):e=!0,t.research+=parseInt(i[1]);break;case Main.k.text.gettext("Défenseur Du Daedalus"):e=!0,t.hunter+=parseInt(i[1]);break;case Main.k.text.gettext("Expédition"):e=!0,t.expe+=parseInt(i[1]);break;case Main.k.text.gettext("Nouvel Planète"):e=!0,t.planet+=parseInt(i[1])}if(e){var n="SPAN"==$(this).tagName?$(this).parent():$(this);n.css("display","none")}}),t.planet&&$("<li>").html(t.planet+" x "+Main.k.text.gettext("Nouvelle Planète")+" ( + "+5*t.planet+" )").attr("_title",Main.k.text.gettext("Nouvelle Planète")).attr("_desc",Main.k.text.gettext("Gagné à chaque planète (arrivée en orbite).")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).prependTo("#logtri"),t.expe&&$("<li>").html(t.expe+" x "+Main.k.text.gettext("Expédition")+" ( + "+3*t.expe+" )").attr("_title",Main.k.text.gettext("Expédition")).attr("_desc",Main.k.text.gettext("Gagné à chaque exploration.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).prependTo("#logtri"),t.researchMin&&$("<li>").html(t.researchMin+" x "+Main.k.text.gettext("Recherche Mineure")+" ( + "+3*t.researchMin+" )").attr("_title",Main.k.text.gettext("Recherche Mineure")).attr("_desc",Main.k.text.gettext("Gagné lorsque la recherche est terminée ainsi qu'une seconde fois lors du retour sur SOL.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).prependTo("#logtri"),t.research&&$("<li>").html(t.research+" x "+Main.k.text.gettext("Recherche")+" ( + "+6*t.research+" )").attr("_title",Main.k.text.gettext("Recherche")).attr("_desc",Main.k.text.gettext("Gagné lorsque la recherche est terminée ainsi qu'une seconde fois lors du retour sur SOL.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).prependTo("#logtri"),t.hunter&&$("<li>").html(t.hunter+" x "+Main.k.text.gettext("Défenseur du Daedalus")+" ( + "+t.hunter+" )").attr("_title",Main.k.text.gettext("Défenseur du Daedalus")).attr("_desc",Main.k.text.gettext("Gagné pour chaque Hunter abattu.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).prependTo("#logtri"),t.humanC&&$("<li>").html(t.humanC+" x "+Main.k.text.gettext("Cycle Humain")+" ( + "+t.humanC+" )").attr("_title",Main.k.text.gettext("Cycle Humain")).attr("_desc",Main.k.text.gettext("Gagné à chaque cycle.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).prependTo("#logtri"),$(document).on("click","a.like",function(){$(this).replaceWith('<img class="cdLoading" src="/img/icons/ui/loading1.gif" alt="loading..." />')})},Main.k.tabs.playerProfile=function(){if($("#experience.cdTabTgt").length>0){$(".charboostbg ul.slots").css("display","none"),$("ul.boost li.charboost").css("height","200px"),$("#accountmenu").find("a").each(function(){$(this).on("click",function(){var e=/\?([a-z]+)$/;if(e.test(this.href)){$(".cdTabTgt").hide(),$("#"+e.exec(this.href)[1]).show();var t=$("#"+e.exec(this.href)[1]+"tab");t.addClass("active"),t.siblings().removeClass("active")}else{$(".cdTabTgt").hide(),$("#experience").show();var a=$("#experiencetab");a.addClass("active"),a.siblings().removeClass("active")}return!1})});var e=Main.k.window.location,t=/\?([a-z]+)$/;if(t.test(e)){$(".cdTabTgt").hide(),$("#"+t.exec(e)[1]).show();var a=$("#"+t.exec(e)[1]+"tab");a.addClass("active"),a.siblings().removeClass("active")}}$(".cdTripEntry td .char").css("margin","5px 0"),$(".cdTripEntry").each(function(){$(this).find("td").eq(-2).css("width","71px")}),$(".cdTripEntry .new").remove(),$(".cdTripPrevious").on("click",function(){$(".cdTripPage").text()>1&&$(".cdTripPrevious").show()})},Main.k.tabs.playing=function(){var callbacks_storage_sync=$.Callbacks();Main.k.css.ingame(),$("ul.kmenu a.ext").on("click",function(){return Main.k.window.open(this.href),!1}),Main.k.hasTalkie=$("#walltab").length>0,$("#swf_ISO_MODULE").click(function(){var e=$(".fakeitem.on");1==e.length&&Main.k.fakeSelectItem(e)}),$.fn.insertAtCaret=function(e){return this.each(function(){if(this.selectionStart||"0"==this.selectionStart){var t=this.selectionStart,a=this.selectionEnd,i=this.scrollTop;this.value=this.value.substring(0,t)+e+this.value.substring(a,this.value.length),this.focus(),this.selectionStart=t+e.length,this.selectionEnd=t+e.length,this.scrollTop=i}else this.value+=e,this.focus(),this.value=this.value})},$.fn.insertAroundCaret=function(e,t){return this.each(function(){if(this.selectionStart||"0"==this.selectionStart){var a=this.selectionStart,i=this.selectionEnd,n=this.scrollTop;this.value=this.value.substring(0,a)+e+this.value.substring(a,i)+t+this.value.substring(i,this.value.length),this.focus(),this.selectionStart=a+e.length,this.selectionEnd=i+t.length,this.scrollTop=n}else this.value+=e+t,this.focus(),this.value=this.value})},$.fn.addHeroDescToolTip=function(e){var t=$("<div/>"),a=$("<div/>"),i=Main.k.Profiles.get(e);a.append(i.name),$.each(i.titles,function(e,t){$("<img>").attr("src","/img/icons/ui/"+t.img+".png").css({"margin-left":"5px","line-height":"7px"}).attr("alt",t.img).appendTo(a)});var n=$("<div>").addClass("icons statuses").css("float","right");if(t.append(n),i.statuses.length>0&&$.each(i.statuses,function(e,t){$("<img>").attr("src","/img/icons/ui/status/"+t.img+".png").attr("height","16").attr("alt",t.img).appendTo(n)}),"undefined"!=typeof i.spores&&null!=i.spores){var s=$("<div>").css({position:"relative",display:"inline-block","margin-left":"2px",top:"2px"}).appendTo(n);$("<img>").attr("src","/img/icons/ui/spore.png").attr("height","16").attr("alt",i.spores.name).attr("_title",i.spores.name).attr("_desc",i.spores.desc).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(s),$("<span>").text(i.spores.nb).css({color:"#FFF","font-size":"10px",position:"absolute",left:"4px",top:"1px",opacity:.7,"pointer-events":"none"}).appendTo(s)}if(i.skills.length>0){var o=$("<p>").addClass("icons skills");$.each(i.skills,function(e,a){var i=$("<span>").addClass("skill").appendTo(o);$("<img>").attr("src","/img/icons/skills/"+a.img+".png").attr("height","19").attr("alt",a.img).appendTo(i),Main.k.compInactiveMush[a.img]&&$("<img>").attr("src",Main.k.servurl_badconker+"/img/non-mush.png").addClass("actmush").attr("width","10").attr("height","10").appendTo(i),t.append(o)})}return t.append('<div class="clear"></div>'),t.append("<p>"+i.short_desc.htmlEncode().replace(/([\r\n]+)/g,"<br/>")+"</p>"),t.append("<p><strong>"+Main.k.text.gettext("Cliquez pour plus d'informations")+"</strong></p>"),$(this).attr("_title",a.html()).attr("_desc",t.html()).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$(this)},$.fn.addTooltip=function(e,t){return $(this).attr("_title",e).attr("_desc",t).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$(this)},Main.k.extend=createObjectIn(unsafeWindow.Main.k,{defineAs:"extend"}),Main.k.extend.updateContent=Main.updateContent,Main.updateContent=function(e,t,a,i){console.log("update content"),Main.k.extend.updateContent(e,t,a,function(){try{null!=i&&i()}catch(t){console.error("erreur",t),Main.k.MushUpdate()}if(/\/choosePeer\?charId=[0-9]+&idx=([0-9]+)/.test(e)){var a=".cdPrivateTab"+RegExp.$1;Main.k.MushUpdate(),$(a).length>0&&$(a).trigger("click")}})},addFctToPage(Main.updateContent,"Main.updateContent"),Main.k.extend.onChatFocus=function(e,t){console.log("Main.rst",Main.rst),0==(Main.rst&1<<t)&&(console.log("Main.rst if"),Main.rst|=1<<t,e.parent().find(".formatbtn").get(0)||($("<a>").addClass("butmini chatformatbtn").html("<img src='/img/icons/ui/pam.png' /> Formater").attr("href","#").appendTo(e.parent()).on("click",function(){var e=$(this);return e.hasClass("butmini")&&(e=e.parent().find("textarea")),Main.k.Manager.openOn("newtopic",e.val()),!1}),e.siblings("input").show(),e.siblings("input").attr("tabindex",1))),console.log("onchatfocus end")},Main.k.extend.onChatInput=function(e){var t=$(this),a=new mush_jquery(e.target);if(a.siblings("input").show(),13==e.keyCode)if(e.ctrlKey)$(a).insertAtCaret("\n"),Tools.send2Store("mush_chatContent_"+t.attr("id"),a.val());else{e.preventDefault();var i=a.parent();i.submit(),Tools.send2Store("mush_chatContent_"+t.attr("id"),""),a.data("default",!0)}else Tools.send2Store("mush_chatContent_"+t.attr("id"),a.val())},Main.k.extend.onWallInput=function(e){var t=new mush_jquery(e.target),a=t.val();if(13==e.keyCode)if(!e.ctrlKey&&a.length>1){e.preventDefault();var i=["cdTabsChat","chatBlock","char_col"],n=new js.JQuery(".cdWallChannel").scrollTop(),s=function(){Main.resetJs();var e=new $(".cdWallChannel");e.scrollTop(n+100)};unsafeWindow.sendChatProc=exportFunction(s,unsafeWindow,{defineAs:"sendChatProc"}),Main.isTuto()&&(i.unshift("floating_ui_start"),i.unshift("cdDialogs"),i.push("ode"));var o=encodeURIComponent(a),r="/wallReply?k="+Std.string(t.closest(".unit").data("k"))+"&msg="+o;Main.updateContent(r,cloneInto(i,unsafeWindow),null,unsafeWindow.sendChatProc),Tools.send2Store("mush_wallReply_"+t.attr("id"),""),t.val(""),t.data("default",!0)}else $(t).insertAtCaret("\n"),Tools.send2Store("mush_wallReply_"+t.attr("id"),t.val());else Tools.send2Store("mush_wallReply_"+t.attr("id"),t.val())},Main.k.extend.onWallFocus=function(){if(jq=$(this),console.info("Main.onWallFocus"),!jq.parent().find(".formatbtn").get(0)){jq.attr("onblur","");var e=jq.parent().parent().siblings("td").first(),t=$("<div>").css({"margin-top":"20px","margin-left":"5px"}).appendTo(e);$("<a>").addClass("butmini formatbtn").html("<img src='"+Main.k.servurl+"/img/viemoral.png' />").attr("href","#").appendTo(t).on("click",function(){var e=Main.k.FormatLife();return $(this).parent().parent().siblings("td").first().find("textarea").insertAtCaret(e),!1}).attr("_title",Main.k.text.gettext("Partager son état de santé")).attr("_desc",Main.k.text.gettext("<p>Insère votre nombre de points de vie et de moral dans la zone de texte active, de la forme&nbsp;:</p><p>TODO: example</p>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$("<a>").addClass("butmini formatbtn").html("<img src='http://data.hordes.fr/gfx/icons/item_bag.gif' />").attr("href","#").appendTo(t).on("click",function(e){var t=Main.k.FormatInventory();return $(this).parent().parent().siblings("td").first().find("textarea").insertAtCaret(t),Main.k.SyncAstropad(e),!1}).attr("_title",Main.k.text.gettext("Partager l'inventaire")).attr("_desc",Main.k.text.gettext("Insère l'inventaire de la pièce dans la zone de texte active, de la forme&nbsp;:</p><p><strong>Couloir central :</strong> <i>Combinaison</i>, <i>Couteau</i>, <i>Médikit</i>, <i>Extincteur</i></p><p><strong>Partage aussi sur Astropad si celui-ci est installé.</strong></p>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),"none"!=$("#pharmashare").css("display")&&$("<a>").addClass("butmini formatbtn").html("<img src='/img/icons/ui/sat.png' />").attr("href","#").appendTo(t).on("click",function(){var e=Main.k.FormatPharma();return $(this).parent().parent().siblings("td").first().find("textarea").insertAtCaret(e),!1}),$("#plantmanager").length>0&&$("<a>").addClass("butmini formatbtn").html("<img src='/img/icons/ui/plant_youngling.png' />").attr("href","#").appendTo(t).on("click",function(){var e=Main.k.FormatPlants();return $(this).parent().parent().siblings("td").first().find("textarea").insertAtCaret(e),!1}).attr("_title",Main.k.text.gettext("Partager l'état des plantes")).attr("_desc",Main.k.text.gettext("<p>Insère l'état des plantes dans la zone de texte active.</p><p>TODO: Exemple</p>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$(".shareprojectbtn").length>0&&$("<a>").addClass("butmini formatbtn").html("<img src='/img/icons/ui/conceptor.png' />").attr("href","#").appendTo(t).on("click",function(){var e=Main.k.FormatProjects();return $(this).parent().parent().siblings("td").first().find("textarea").insertAtCaret(e),!1}).attr("_title",Main.k.text.gettext("Partager les projets")).attr("_desc",Main.k.text.gettext("Insère la liste de projets dans la zone de texte active, de la forme&nbsp;:</p><p><li><strong>Nom du projet</strong> - 0%<br/>Description du projet<br/>Bonus : <i>Tireur</i>, <i>Pilote</i></li><li><strong>Nom du projet</strong> - 0%<br/>Description du projet<br/>Bonus : <i>Tireur</i>, <i>Pilote</i></li><li><strong>Nom du projet</strong> - 0%<br/>Description du projet<br/>Bonus : <i>Tireur</i>, <i>Pilote</i></li>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$(".shareresearchbtn").length>0&&$("<a>").addClass("butmini formatbtn").html("<img src='/img/icons/ui/microsc.png' />").attr("href","#").appendTo(t).on("click",function(){var e=Main.k.FormatResearch();return $(this).parent().parent().siblings("td").first().find("textarea").insertAtCaret(e),!1}).attr("_title",Main.k.text.gettext("Partager les recherches")).attr("_desc",Main.k.text.gettext("Insère la liste de recherches dans la zone de texte active, de la forme&nbsp;:</p><p><li><strong>Nom de la recherche</strong> - 0%<br/>Description de la recherche<br/>Bonus : <i>Biologiste</i>, <i>Médecin</i></li><li><strong>Nom de la recherche</strong> - 0%<br/>Description de la recherche<br/>Bonus : <i>Biologiste</i>, <i>Médecin</i></li><li><strong>Nom de la recherche</strong> - 0%<br/>Description de la recherche<br/>Bonus : <i>Biologiste</i>, <i>Médecin</i></li>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$("#biosModule").length>0&&$("<a>").addClass("butmini formatbtn").html("<img src='/img/icons/ui/pa_core.png' />").attr("href","#").appendTo(t).on("click",function(){var e=Main.k.FormatBIOS();return $(this).parent().parent().siblings("td").first().find("textarea").insertAtCaret(e),!1}).attr("_title",Main.k.text.gettext("Partager les paramètres BIOS")).attr("_desc",Main.k.text.gettext("Insère la liste de paramètres BIOS Neron dans la zone de texte active, de la forme&nbsp;:</p><p>TODO: aperçu")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$("#navModule").length>0&&$("<a>").addClass("butmini formatbtn").html("<img src='/img/icons/ui/planet.png' />").attr("href","#").appendTo(t).on("click",function(){var e=Main.k.FormatPlanets();return $(this).parent().parent().siblings("td").first().find("textarea").insertAtCaret(e),!1}).attr("_title",Main.k.text.gettext("Partager les planètes")).attr("_desc",Main.k.text.gettext("<p>Insère les détails des planètes dans la zone de texte active.</p><p>TODO: Exemple</p>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip);var a=$("<div>").addClass("replybuttons customreply").appendTo(jq.parent());a.siblings("textarea").css({"padding-bottom":"22px",height:"130px"}),$("<a>").addClass("butmini formatbtn").html("<strong>B</strong>").attr("href","#").appendTo(a).on("click",function(){$(this).parent().parent().find("textarea").insertAroundCaret("**","**")}),$("<a>").addClass("butmini formatbtn").html("<i>I</i>").attr("href","#").appendTo(a).on("click",function(){$(this).parent().parent().find("textarea").insertAroundCaret("//","//")}),$("<a>").addClass("butmini formatbtn").html("<img src='/img/icons/ui/moral.png' />").attr("href","#").appendTo(a).on("click",function(){}).attr("_title",Main.k.text.gettext("Insérer un smiley")).attr("_desc",Main.k.text.gettext("Bientôt disponible.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$("<a>").addClass("butmini").html("<img src='/img/icons/ui/bin.png' />").attr("href","#").appendTo(a).on("click",function(){var e=$(this).closest(".unit").find("textarea");return e.val(""),e.focus(),!1}).attr("_desc",Main.k.text.gettext("Vider la zone de texte.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$("<a>").addClass("butmini").html("<img src='/img/icons/ui/status/unsociable.png' />").attr("href","#").appendTo(a).on("click",function(){var e=$(this),t=e.closest(".unit");return t.find(".tree").not(".cdTreeReply").last().addClass("treelast"),t.find(".blockreply").addClass("hide"),t.find("textarea").val(""),!1}).attr("_desc",Main.k.text.gettext("Fermer la zone de texte.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$("<span>&nbsp;</span>").appendTo(a),$("<a>").addClass("butmini formatbtn").html("<img src='/img/icons/ui/pam.png' /> Formater").attr("href","#").appendTo(a).on("click",function(){var e=$(this);return e.hasClass("butmini")&&(e=e.parent().parent().find("textarea")),Main.k.Manager.openOn("reply",e.val(),e.closest(".unit").attr("data-k")),!1}).attr("_desc",Main.k.text.gettext("Ouvrir le manager.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip)}},Main.k.extend.onChatScroll=function(){var e=$(this),t=Main.curChatIndex();Main.curScroll.set(t,e.scrollTop()),t==ChatType.Wall[1]&&e.scrollTop()+e.height()+8>=e.toArray()[0].scrollHeight&&Main.k.extend.loadMoreWall()},Main.loadMoreWall=function(){},addFctToPage(Main.loadMoreWall,"Main.loadMoreWall"),Main.k.extend.loadMoreWall=function(){if(!Main.lmwProcessing){Main.lmwProcessing=!0,Main.lmw_spin++;var e=Main.getChannel(Main.curChatIndex()).find("div.wall div.unit"),t=e.last(),a=t.closest(".wall");if(t.length>0){JqEx.postLoading(a);var i="/retrWallAfter/"+Std.string(t.data("k"));Tools.ping(i,function(e){var t=new js.JQuery(e);JqEx.remLoading(a);for(var i=Lambda.list(t.find(".wall form")),n=i.iterator();n.hasNext();){var s=n.next(),o=s.find(".unit");if(null!=o)for(var r=function(e){var t,i=a.find(".unit");return t=i.iterator()}(this);r.hasNext();){var l=r.next(),p=o.data("k"),d=l.data("k");haxe.Log.trace(p+" <>  "+d,{fileName:"Main.hx",lineNumber:3841,className:"Main",methodName:"loadMoreWall"}),d==p&&i.remove(s)}}for(var c=i.iterator();c.hasNext();){var u=c.next();a.append(u.html())}Main.lmwProcessing=!1,Main.k.Options.cbubbles&&Main.k.customBubbles(),$("table.treereply tr.not_read.cdRepl").css("display","table-row")})}else Main.lmwProcessing=!1}},Main.k.extend.resetJs=Main.resetJs,Main.resetJs=function(e,t){Main.k.extend.resetJs(e),t||Main.k.MushUpdate()},exportFunction(Main.resetJs,unsafeWindow.Main,{defineAs:"resetJs"}),Main.k.UpdateData={currversion:0,changelog:[]},Main.k.UpdateCheck=function(){var e;if(void 0==Main.k.UpdateCheck.b_in_progress&&(Main.k.UpdateCheck.b_in_progress=!1),1!=Main.k.UpdateCheck.b_in_progress){var t=js.Cookie.get("ctrlwVersion");e="undefined"!=typeof t&&t<Main.k.version?t:Main.k.version,null==localStorage.getItem("ctrlw_update_cache")?(Main.k.UpdateCheck.b_in_progress=!0,GM_xmlhttpRequest({method:"GET",url:Main.k.servurl+"/versions/update/"+e,headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(e){setTimeout(function(){console.warn("update_json",e),localStorage.setItem("ctrlw_update_cache",JSON.stringify(e)),Main.k.UpdateCheck.b_in_progress=!1},0),Main.k.UpdateCheckScriptVersion(e,t)},onerror:function(e,t,a){console.warn(e,t,a)}})):Main.k.UpdateCheckScriptVersion(JSON.parse(localStorage.getItem("ctrlw_update_cache")),t)}},Main.k.UpdateCheckScriptVersion=function(e,t){try{e=JSON.parse(e.response)}catch(a){return!1}Main.k.UpdateData.currversion=e.numero,Main.k.UpdateData.changelog="undefined"!=typeof e["changelog_long_"+Main.k.lang]?e["changelog_long_"+Main.k.lang]:e.changelog_long,Main.k.UpdateData.url=e.url,e.user_code_version<e.code&&e.user_num_version==GM_info.script.version?$("#updatebtn").css("display","block"):("undefined"!=typeof t&&t!=GM_info.script.version&&Main.k.AutoUpdateDialog(),js.Cookie.set("ctrlwVersion",GM_info.script.version,42e7),$("#updatebtn").css("display","none"))},Main.k.UpdateDialog=function(){var e=Main.k.UpdateData.url,t=Main.k.CreatePopup();t.content.css({height:"auto","max-height":"90%",width:"600px",color:"#FFF"});for(var a=Main.k.text.gettext("Version "+Main.k.UpdateData.currversion+" disponible :")+" <br/> <ul class='updateslist'>",i=0;i<Main.k.UpdateData.changelog.length;i++){var n=Main.k.UpdateData.changelog[i];a+="<li>"+n+"</li>"}a+="</ul>";var s="<div class='updatescontent'>"+a+"</div>",o='<div class=\'updatesactions\'><div id="ok" class="but updatesbtn" ><div class="butright"><div class="butbg"><a onclick="$(\'#final\').show();" href="'+e+'">'+Main.k.text.gettext("Mettre à jour")+"</a></div></div></div>",r="'Main.k.ClosePopup();'",l='<div id="cancel" class="but updatesbtn" onclick='+r+'><div class="butright"><div class="butbg"><a href="#">'+Main.getText("cancel")+"</a></div></div></div></div>",p='<div id="final" class="updatesactions" style="display:none"><div><strong>'+Main.k.text.gettext("Pour finaliser la mise à jour, après avoir installé le script, veuillez cliquer sur le bouton ci-dessous.")+'</strong></div><div class="but updatesbtn" onclick="Main.k.ClosePopup();window.location.reload();"><div class="butright"><div class="butbg"><a href="#">'+Main.k.text.gettext("Finaliser la mise à jour")+"</a></div></div></div></div></div>";$("<div>").html(s+o+l+p).appendTo(t.content),Main.k.OpenPopup(t.dom)},Main.k.AutoUpdateDialog=function(){var e=Main.k.CreatePopup();e.content.css({height:"auto","max-height":"90%",width:"600px",color:"#FFF"});var t=Main.k.text.strargs(Main.k.text.gettext("Dernière version de CTRL+W installée (%1) :"),[GM_info.script.version]);t+=" <br/> <ul class='updateslist'>";for(var a=0;a<Main.k.UpdateData.changelog.length;a++){var i=Main.k.UpdateData.changelog[a];t+="<li>"+i+"</li>"}t+="</ul>";var n="<div class='updatescontent'>"+t+"</div>",s='<div class=\'updatesactions\'><div id="ok" class="but updatesbtn" ><div class="butright"><div class="butbg"><a onclick="Main.k.ClosePopup();" href="#">'+Main.k.text.gettext("Très bien, merci !")+"</a></div></div></div>";$("<div>").html(n+s).appendTo(e.content),Main.k.OpenPopup(e.dom)},Main.k.COMPLETE_SURNAME=function(e){return e.replace("_"," ").capitalize()},Main.k.LoadJS=function(e,t,a){var i=js.Lib.document.createElement("script");i.async=!0;var n=Reflect.copy(t);n.jsm="1",n.lang="FR",i.src=_tid.makeUrl(e,cloneInto(n,unsafeWindow)),null!=a&&(i.onload=a),js.Lib.document.body.appendChild(i)},Main.k.postMessage=function(e,t,a){var i=StringTools.urlEncode(t);js.Cookie.set("lastsentmsg",i),Main.k.displayLastSent(!0);var n=function(){Main.resetJs(),Main.k.displayLastSent(!1),a&&a()},s=["cdTabsChat","chatBlock","char_col"],o="/wallReply?k="+e+"&msg="+i;Main.updateContent(o,s,null,n)},Main.k.newTopic=function(e,t){var a=StringTools.urlEncode(e);js.Cookie.set("lastsentmsg",a),Main.k.displayLastSent(!0);var i=function(){Main.resetJs(),Main.k.displayLastSent(!1),t&&t()},n=["cdTabsChat","chatBlock","char_col"],s="/newWallThread?message="+a;Main.updateContent(s,n,null,i)},Main.k.displayLastSent=function(e){var t=$("#lastsentmsg");if(e){t.css("display","block");{js.Cookie.get("lastsentmsg")}}else t.css("display","none"),js.Cookie.set("lastsentmsg","")},Main.k.FormatInventory=function(){var e="**"+$("#input").attr("d_name")+" :** ",t=$("#room").clone();t.find(".cdEmptySlot").remove();var a=!0;t.find("li").each(function(t){if(-1==$(this).attr("data-name").indexOf("/img/icons/ui/hidden.png")){for(var i=$(this).attr("data-name"),n=["itrakie","itrackie","talkie","walkie","traqueur","tracker"],s=0;s<n.length;s++)if(-1!=i.toLowerCase().indexOf(n[s].toLowerCase()))return;var o=i.indexOf("/img/icons/ui/broken.png")>-1;i=i.replace(/(<img.+\/>)/gi,"").trim(),i.toLowerCase()==Main.k.text.gettext("apprentron")&&(i=decodeURIComponent(/namey[0-9]+:(.+)g$/.exec($(this).attr("data-tip"))[1]).replace(/(\s\s)/," "));var r="";$(this).find(".qty").get(0)&&(r=" x"+$(this).find(".qty").html().trim());var l=/x([0-9]+)$/;l.test(i)&&(i+=" "+Main.k.text.gettext("charges")),a||(e+=", "),e+="//"+i+"//"+r,o&&(e+=" :alert:"),a=!1}}),a&&(e+="//"+Main.k.text.gettext("vide")+"//");for(var i=0,n=0,s=Main.items.iterator();s.hasNext();){var o=s.next();

"CAMERA"==o.iid?i++:"HELP_DRONE"==o.iid&&n++}return(i||n)&&(e+=" ["),i&&(e+=i+" "+Main.k.text.gettext("caméra")+(1!=i?"s":"")),i&&n&&(e+=" - "),n&&(e+=n+" "+Main.k.text.gettext("drone")+(1!=n?"s":"")),(i||n)&&(e+="]"),e},Main.k.FormatPlants=function(){var e="**//"+Main.k.text.gettext("plantes").capitalize()+" : //**";return $("#room").find("[data-id='TREE_POT']").each(function(t){var a=/^([^<]+)/.exec($(this).attr("data-name"))[1].trim(),i=-1!=$(this).attr("data-name").indexOf("plant_diseased"),n=-1!=$(this).attr("data-name").indexOf("plant_thirsty"),s=-1!=$(this).attr("data-name").indexOf("plant_dry");e+="\n- ////**"+a+"** ",e+=" - ";var o=[];i&&o.push("//"+Main.k.text.gettext("malade").capitalize()+"//"),n&&o.push("//"+Main.k.text.gettext("soif").capitalize()+"//"),s&&o.push("//"+Main.k.text.gettext("desséché").capitalize()+"//"),0==o.length&&o.push("//"+Main.k.text.gettext("RAS").capitalize()+"//"),e+=o.join()}),e},Main.k.FormatProjects=function(){var e="**//"+Main.k.text.gettext("Projets")+" : //**",t=function(e){return e=e.replace(/<img\s+src=\"\/img\/icons\/ui\/pa_slot1.png\"[\/\s]*>/gi,":pa:"),e=e.replace(/&nbsp;/gi," "),e=e.replace(/\n/gi,""),e=e.replace(/<p>/gi," "),e=e.replace(/<\/?[^>]+>/g,"")};return $("#cdModuleContent").find("ul.dev li.cdProjCard").each(function(a){var i=$(this).find("h3").html().trim(),n=$(this).find("span").html().trim(),s=t($(this).find("div.desc").html().trim()),o=/<h1>([^<]+)<\/h1>/.exec($(this).find("div.suggestprogress ul li img").first().attr("onmouseover"))[1].trim(),r=/<h1>([^<]+)<\/h1>/.exec($(this).find("div.suggestprogress ul li img").last().attr("onmouseover"))[1].trim();e+="\n**"+i+"** - "+n+"\n",e+=""+s+"\n",e+="Bonus : //"+o+"//, //"+r+"//"}),e},Main.k.FormatResearch=function(e){var t="**//"+Main.k.text.gettext("Recherches")+" : //**",a=function(e){return e=e.replace(/<img\s+src=\"\/img\/icons\/ui\/triumph.png\"\s+alt=\"triomphe\"[\/\s]*>/gi,":mush_triumph:"),e=e.replace(/&nbsp;/gi," "),e=e.replace(/\n/gi,""),e=e.replace(/<p>/gi," "),e=e.replace(/<\/?[^>]+>/g,"")};return $("#cdModuleContent").find("ul.dev li.cdProjCard").each(function(i){var n=$(this).find("h3").clone();n.find("em").remove();var s=a(n.html().trim()),o=$(this).find("span").html().trim(),r=a($(this).find("div.desc").html().trim()),l=/<strong>([^<]+)<\/strong>/.exec($(this).find("div.suggestprogress ul li img").first().attr("onmouseover"))[1].trim().replace("Médeçin","Médecin"),p=/<strong>([^<]+)<\/strong>/.exec($(this).find("div.suggestprogress ul li img").last().attr("onmouseover"))[1].trim().replace("Médeçin","Médecin");t+="\n**"+s+"** - "+o,("undefined"==typeof e||1!=e)&&(t+="\n"+r+"\n",t+="Bonus : //"+l+"//, //"+p+"//")}),t},Main.k.FormatPlanets=function(e){var t="**//"+Main.k.text.gettext("Planètes")+" : //**";return $("#navModule").find(".planet").not(".planetoff").each(function(a){if(null!=e&&a!=e)return!0;var i,n,s=$(this).find("h3").html().trim(),o=($(this).find("img.previmg").attr("src"),$(this).find("ul.pllist li"));if(o.length>0){var r=new RegExp(Main.k.text.gettext("(Nord|Est|Ouest|Sud)"));i=r.exec(o.eq(-2).html())[1],n=/([0-9]+)/.exec(o.last().html())[1]}var l=$(this).find("td img.explTag").length,p=[],d=/<h1>([^<]+)<\/h1>/;$(this).find("td img.explTag.on").each(function(){p.push(d.exec($(this).attr("onmouseover"))[1])}),t+="\n**"+s+"** ("+l+" "+Main.k.text.gettext("cases")+")\n",n&&i&&(t+="//"+i+" - "+n+" :mush_fuel:****//\n"),t+=p.join(", ")}),t},Main.k.FormatBIOS=function(){var e="//**"+Main.k.text.gettext("Paramètres BIOS:")+"**//";return $("#biosModule").find("ul.dev li").each(function(){$(this);e+="\n**"+$(this).children("h3:first").text().trim()+"** : ",e+=$(this).find("input[checked='checked']").siblings("label").text()}),e},Main.k.FormatComm=function(){var e="//**"+Main.k.text.gettext("Communications:")+"**//",t=$("#trackerModule");return t.find(".sensors").each(function(){var t=$(this).find("h2").html().trim();e+="\n//"+t+"//: ";var a=[];$(this).find("p").each(function(){a.push($(this).find("em").html())}),a.length<2?a.push(" :alert:"):(a.pop(),a.push(" :com:")),e+=a.join("")}),t.find(".neron").each(function(){var t=$(this).find("h2").html().trim();e+="\n//"+t+"//\n"}),t.find(".xyloph").each(function(){var t=$(this).find("h2").html().trim(),a=0,i=[],n=/<h1>([^<]+)<\/h1>/;$(this).find("li").not(".undone").each(function(){a+=1,i.push(n.exec($(this).attr("onmouseover"))[1].replace("\\",""))}),12==a?(e+="//"+t+"//: ",e+=a+"/12\n"):a>0&&(e+="//"+t+"//: ",e+=a+"/12\n ▶ **"+i.join("** \n ▶ **")+"**\n")}),t.find(".network .bases").each(function(){var t,a="//"+Main.k.text.gettext("Décodage: ")+"//";$(this).find("li").each(function(){t=$(this).attr("data-id"),$(this).find(".percent").not(".off").each(function(){a+=t+"► "+$(this).html().trim()})}),a!="//"+Main.k.text.gettext("Décodage: ")+"//"&&(e+=a+"\n");var i="//"+Main.k.text.gettext("Base(s) décodée(s): ")+"//",n="//"+Main.k.text.gettext("Base(s) perdue(s): ")+"//",s="";$(this).find("li").each(function(){s=$(this).attr("data-id"),$(this).find("h3").each(function(){"???"!=$(this).html().trim()&&""!=$(this).html().trim()&&(i+=$(this).html().trim()+", ")}),$(this).find("span").not(".percent").each(function(){n+=s+", "})}),i!="//"+Main.k.text.gettext("Base(s) décodée(s): ")+"//"&&(e+=i,e=e.substring(0,e.length-2)+"\n"),n!="//"+Main.k.text.gettext("Base(s) perdue(s): ")+"//"&&(e+=n.substring(0,n.length-2))}),e},Main.k.FormatPharma=function(){var e="**//"+Main.k.text.gettext("Consommables :")+" //**",t={};t[Main.k.text.gettext("Guérie la maladie")]=":pa_heal:",t[Main.k.text.gettext("satiété")]=":pa_cook:",t[Main.k.text.gettext("Provoque la maladie")]=":ill:";var a=[];a.push(Main.k.text.gettext("Impérissable"));var i=new RegExp("^("+a.join("|")+"$)"),n=$("#room");return n.find("li").not(".cdEmptySlot").each(function(){var a=$(this).attr("data-name").capitalize(),n=$(this).attr("data-desc").split("\\'").join("'");if(-1!=n.indexOf("Effets")||"CONSUMABLE"==$(this).data("id")){var s=$("<div>"+n+"</div>");if(s.has("p")){var o=[];s.find("p").each(function(){i.test($(this).html())||o.push($(this).html().replaceFromObj(t))}),o.length>0&&(e+="\n**"+a+"** : ",e+=o.join(", "))}}}),e=e.replace(/<\/p>/g,", "),e=e.replace(/(\t|\\r\\n|\\|<\/?(p|div)>)/g,""),e=e.replace(/,\s<br\/>/g,"\n"),e=e.replace(/<img[^>]+pa_slot1[^>]+>/g,":pa:"),e=e.replace(/<img[^>]+pa_slot2[^>]+>/g,":pm:"),e=e.replace(/<img[^>]+moral[^>]+>/g,":moral:"),e=e.replace(/<img[^>]+lp\.png[^>]+>/g,":hp:"),e=e.replace(/<img[^>]+>/g,"")},Main.k.FormatLife=function(){var e=$("table.pvsm td").not(".barmoral").find("span").html().trim(),t=$("table.pvsm td.barmoral span").html().trim();return e+" :mush_hp: / "+t+" :mush_moral:"},Main.k.Resize=function(){var e=$(".usLeftbar"),t=$("#content"),a=$("body"),i=a.width(),n=126,s=Math.min(Main.k.BMAXWIDTH,i-n-30);t.css("width",s),$(Main.k.window).width()>s+2*(n+15)?(t.css("left",(i-s)/2+"px"),Main.k.Options.dlogo&&a.css("background-position","-"+(1830-i)/2+"px 20px")):(t.css("left",n+15+"px"),Main.k.Options.dlogo&&a.css("background-position","-272px 20px"));var o=t.height()+t.position().top;e.height()<o?e.css("height",o-11):t.css("height",e.height()-t.position().top+11)},Main.k.ToggleDisplay=function(){"displaymore"==this.className?(this.className="displayless",$(""+$(this).attr("_target")).css("display","block")):(this.className="displaymore",$(""+$(this).attr("_target")).css("display","none")),Main.k.Resize()},Main.k.ExtendPilgred=function(){var e=$("#cdBottomBlock");$("#pilgredbonus").remove();var t=e.find("div.pilgred").parent().css({position:"relative","margin-right":"160px"}),a=e.find("div.research"),i=0;a.each(function(){var e=$(this).parent().find("img").attr("src").replace("/img/cards/research/","").replace(".png","");Main.k.researchGlory[e]&&(i+=Main.k.researchGlory[e])});var n=$("ul.people img[src='/img/icons/ui/p_mush.png']").length,s=-10*n,o="<h4>"+Main.k.text.gettext("Triomphe retour sur sol")+"</h4>- "+Main.k.text.gettext("Retour sur Sol :")+" 20 <br/>- "+Main.k.text.gettext("Bonus recherches : ")+i+"<br/>- "+Main.k.text.gettext("Malus mush en vie : ")+s+"<br/>"+Main.k.text.gettext("Total :")+" "+(20+i+s);$("<div>").attr("id","pilgredbonus").attr("_title",Main.k.text.gettext("Triomphe retour sur sol")).attr("_desc",Main.k.text.gettext("Ne tient pas compte des mushs anonymes.")).css({position:"absolute",top:"3px",left:"54px",width:"150px","font-size":"11px"}).html(o).appendTo(t).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip)},Main.k.maxAgo=function(e,t){var a,i;if(!e)return t;if(!t)return e;if("&lt;1m"==e)return t;if("&lt;1m"==t)return e;var n=/([0-9]+)min/;if(n.test(e))return n.test(t)?(a=parseInt(n.exec(e)[1]),i=parseInt(n.exec(t)[1]),i>=a?t:e):t;if(n.test(t))return n.test(e)?(a=parseInt(n.exec(e)[1]),i=parseInt(n.exec(t)[1]),i>=a?t:e):e;var s=/\~([0-9]+)h/;if(s.test(e))return s.test(t)?(a=parseInt(s.exec(e)[1]),i=parseInt(s.exec(t)[1]),i>=a?t:e):t;if(s.test(t))return s.test(e)?(a=parseInt(s.exec(e)[1]),i=parseInt(s.exec(t)[1]),i>=a?t:e):e;var o=/\~([0-9]+)j/;return o.test(e)?o.test(t)?(a=parseInt(o.exec(e)[1]),i=parseInt(o.exec(t)[1]),i>=a?t:e):t:o.test(t)&&o.test(e)?(a=parseInt(o.exec(e)[1]),i=parseInt(o.exec(t)[1]),i>=a?t:e):e},Main.k.minAgo=function(e,t){var a,i;if(!e)return t;if(!t)return e;if("&lt;1m"==e)return e;if("&lt;1m"==t)return t;var n=/([0-9]+)min/;if(n.test(e))return n.test(t)?(a=parseInt(n.exec(e)[1]),i=parseInt(n.exec(t)[1]),i>=a?e:t):e;if(n.test(t))return n.test(e)?(a=parseInt(n.exec(e)[1]),i=parseInt(n.exec(t)[1]),i>=a?e:t):t;var s=/\~([0-9]+)h/;if(s.test(e))return s.test(t)?(a=parseInt(s.exec(e)[1]),i=parseInt(s.exec(t)[1]),i>=a?e:t):e;if(s.test(t))return s.test(e)?(a=parseInt(s.exec(e)[1]),i=parseInt(s.exec(t)[1]),i>=a?e:t):t;var o=/\~([0-9]+)j/;return o.test(e)?o.test(t)?(a=parseInt(o.exec(e)[1]),i=parseInt(o.exec(t)[1]),i>=a?e:t):e:o.test(t)?o.test(e)?(a=parseInt(o.exec(e)[1]),i=parseInt(o.exec(t)[1]),i>=a?e:t):t:e},Main.k.extendAgo=function(e){var t=1==parseInt(/([0-9]+)/.exec(e)[1]);return e=e.replace("min"," minute"+(t?"":"s")),e=e.replace("h"," heure"+(t?"":"s")),e=e.replace("j"," jour"+(t?"":"s")),e=e.replace("&lt;1m","moins d'une minute"),e=e.replace("~","environ ")},Main.k.surnameToBubble=function(e){return e.replace(/(\s)/g,"_").toLowerCase()},Main.k.customBubbles=function(){var e=$(".bubble");if(Main.k.Options.cbubbles)e.each(function(){var e=Main.k.GetHeroNameFromTopic($(this).parent());$(this).addClass("bubble_"+e),Main.k.Options.cbubblesNB&&$(this).addClass("custombubbles_nobackground")});else{e.removeClass("custombubbles_nobackground");for(var t=0;t<Main.k.HEROES.length;t++)e.removeClass("bubble_"+Main.k.HEROES[t])}},Main.k.updateBottom=function(){var e=$("#cdBottomBlock");e.find("div.pilgred").length>0&&Main.k.ExtendPilgred(),e.find("div.split").remove(),Main.k.Options.splitpjt&&(e.find("div.project").length>0&&$("<div>").addClass("split").insertAfter(e.find("div.project").last().parent()),e.find("div.research").length>0&&$("<div>").addClass("split").insertAfter(e.find("div.research").last().parent()))},Main.k.folding={},Main.k.folding.displayed="game",Main.k.folding.busy=!1,Main.k.folding.currcols=["#char_col","#room_col","#chat_col"],Main.k.folding.gamecols=["#char_col","#room_col","#chat_col"],Main.k.folding.display=function(e,t,a){if(!Main.k.folding.busy){Main.k.folding.busy=!0,Main.k.folding.displayed=t;for(var i=[null,null,null],n=0;n<Main.k.folding.currcols.length;n++)e[n]?e[n]!=Main.k.folding.currcols[n]&&(i[n]=Main.k.folding.currcols[n]):Main.k.folding.currcols[n]!=Main.k.folding.gamecols[n]&&(i[n]=Main.k.folding.currcols[n]);var s=function(){for(var t=[null,null,null],i=0;i<Main.k.folding.currcols.length;i++)e[i]?e[i]!=Main.k.folding.currcols[i]&&(t[i]=e[i]):Main.k.folding.currcols[i]!=Main.k.folding.gamecols[i]&&(t[i]=Main.k.folding.gamecols[i]);Main.k.folding.unfold(t,function(){Main.k.folding.busy=!1,a&&"function"==typeof a&&a()})};Main.k.folding.fold(i,s)}},Main.k.folding.displayGame=function(e){if(!Main.k.folding.busy){Main.k.folding.busy=!0,Main.k.folding.displayed="game";for(var t=[null,null,null],a=0;a<Main.k.folding.currcols.length;a++)Main.k.folding.currcols[a]!=Main.k.folding.gamecols[a]&&(t[a]=Main.k.folding.currcols[a]);var i=function(){for(var t=[null,null,null],a=0;a<Main.k.folding.currcols.length;a++)Main.k.folding.currcols[a]!=Main.k.folding.gamecols[a]&&(t[a]=Main.k.folding.gamecols[a]);Main.k.folding.unfold(t,function(){Main.k.folding.busy=!1,e&&e()})};Main.k.folding.fold(t,i)}},Main.k.folding.fold=function(e,t){for(var a=0;a<e.length;a++)e[a]&&$(e[a]).css({transform:"scale(0,1)","-o-transform":"scale(0,1)","-webkit-transform":"scale(0,1)"});setTimeout(function(){for(var a=0;a<e.length;a++)e[a]&&$(e[a]).hide();t&&t()},250)},Main.k.folding.unfold=function(e,t){for(var a=0;a<e.length;a++)e[a]&&$(e[a]).show();setTimeout(function(){for(var a=0;a<e.length;a++)e[a]&&$(e[a]).css({transform:"scale(1,1)","-o-transform":"scale(1,1)","-webkit-transform":"scale(1,1)"});setTimeout(function(){for(var a=0;a<e.length;a++)e[a]&&(Main.k.folding.currcols[a]=e[a]);t&&t(),e[1]==Main.k.folding.gamecols[1]&&$("body").delay(200,"myQueue").queue("myQueue",function(){Main.refreshChat(),Main.acListMaintainer.refresh(!0),Main.syncInvOffset(null,!0),Main.doChatPacks(),Main.topChat(),Main.onChanDone(ChatType.Local[1],!0)}).dequeue("myQueue")},230)},20)},Main.k.About={},Main.k.About.initialized=!1,Main.k.About.open=function(){if("about"==Main.k.folding.displayed)return void Main.k.folding.displayGame();if(!Main.k.About.initialized){Main.k.About.initialized=!0;var e=$("<td>").addClass("").css({"padding-right":"6px","padding-top":"1px",transform:"scale(0,1)",color:"rgb(9,10,97)"}).attr("id","about_col").appendTo($("table.inter tr").first()),t=$("<div>").css({"text-align":"center"}).appendTo(e);$("<img>").css({height:"100px",margin:"0 auto 0px"}).attr("src",Main.k.servurl+"/img/ctrlw1.png").appendTo(t),$("<br/>").appendTo(t),Main.k.MakeButton("<img src='/img/icons/ui/planet.png' /> Groupe Twinoid","http://twinoid.com/g/ctrl-w").css({margin:"0 2px",display:"inline-block"}).appendTo(t),Main.k.MakeButton("<img src='/img/icons/ui/talkie.png' /> Chan IRC","http://webchat.quakenet.org/?channels=#ctrlw").css({margin:"0 2px",display:"inline-block"}).appendTo(t).find("a").attr("_title",Main.k.text.gettext("Chan IRC")).attr("_desc",Main.k.text.gettext("Venez discuter sur IRC avec les autres utilisateurs du script. 			Vous pourrez également y trouver de l'aide ou faire des suggestions.</p><p><strong>Chan #ctrlw sur Quakenet</strong>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> "+Main.k.text.gettext("Topic (Forum Mush)"),Main.k.text.gettext("http://twd.io/e/0fdb0w")).css({margin:"0 2px",display:"inline-block"}).appendTo(t),$("<p>").css({margin:"20px",color:"#CCC","text-align":"center"}).html(Main.k.text.gettext("Script développé par <a href='http://twinoid.com/user/8297'>kill0u</a>, maintenu par <a href='http://twinoid.com/user/1244143'>badconker</a><br/>Le logo, les images (mise en forme personnalisée des messages) et le design du site web ont été faits par <a href='http://twinoid.com/user/2992052'>Gnux</a>.<br/>"+Main.k.text.gettext("Contributeurs : ")+"<a href='http://twinoid.com/user/362197'>FloKy</a>, <a href='http://twinoid.com/user/5140898'>_Fraise__</a>, <a href='http://twinoid.com/user/8011565'>NightExcessive</a><br/>"+Main.k.text.gettext("Traducteurs : ")+"<a href='http://twinoid.com/user/7845671'>Avistew (en)</a>, <a href='http://twinoid.com/user/6031682'>Kohaku (es)</a>, <a href='http://twinoid.com/user/531084'>R3my (es)</a>, <br/><a href='http://twinoid.com/user/21696'>Javiernh (es)</a>")).appendTo(e);var a=$("<div>").css({"text-align":"center",margin:"30px 0 0"}).appendTo(e);Main.k.MakeButton("<img src='/img/icons/ui/pageleft.png' /> "+Main.k.text.gettext("Retour au jeu"),null,Main.k.About.open).css("display","inline-block").appendTo(a)}Main.k.folding.display([null,null,"#about_col"],"about")},Main.k.Sync={},Main.k.Sync.initialized=!1,Main.k.Sync.push_timer=null,Main.k.Sync.open=function(){if(!Main.k.Sync.initialized){this.initialized=!0;var e=$("<td>").addClass("chat_box ctrlw_col").css({"padding-right":"6px","padding-top":"1px",transform:"scale(0,1)"}).attr("id","sync_col").appendTo($("table.inter tr").first()),t=new RegExp("[0-9]+$"),a=(t.exec($("#tid_openRight").attr("href")),localStorage.getItem("ctrlw_sync_key"));$("<p>").addClass("ctrlw-row-options").append($("<label>").html('<span style="display: inline-block; width:10%">'+Main.k.text.gettext("Clé :")+"</span>").append($("<input>").attr({type:"text",placeholder:Main.k.text.gettext("Collez votre clé ici"),id:"ctrlw-sync-key"}).css({"text-align":"center",display:"inline-block",width:"80%","margin-right":"10px"}).data("val",localStorage.getItem("ctrlw_sync_key")).val(null!=a?a:"").on("paste",function(e){var t=$(this);setTimeout(function(){var e=t.val(),a=t.data("val");if(e.length>20&&localStorage.getItem("ctrlw_sync_key")!=e&&a!=e){var i=$(".status_sync");i.hide(),$(".status_sync_load").show(),$.when(Main.k.Sync.pull(e)).then(function(){localStorage.setItem("ctrlw_sync_key",e),i.hide(),$(".status_sync_ok").show()}).fail(function(){i.hide(),$(".status_sync_ko").show()})}t.data("val",e)},10)})).append($("<div>").css({display:"inline-block",position:"relative",top:"2px"}).append($("<img>").attr({src:"/img/icons/ui/alert.png"}).addClass("status_sync status_sync_ko").css({"margin-left":"5px",display:null!=a?"none":"inline",position:"relative",top:"-2px"})).append($("<img>").attr({src:"/img/icons/ui/reported.png"}).addClass("status_sync status_sync_ok").css({"margin-left":"5px",display:null==a?"none":"inline"})).append('<img class="cdLoading status_sync status_sync_load" src="/img/icons/ui/loading1.gif" alt="loading..." style="display:none"/>'))).appendTo(e),$("<p>").css({"text-align":"center"}).append(Main.k.MakeButton("<img src='/img/icons/ui/neron_fluw.png' /> "+Main.k.text.gettext("Générer une nouvelle clé"),null,Main.k.Sync.createKey).css("display","inline-block").addClass("ctrlw")).appendTo(e),$("<p>").css({"text-align":"center"}).append(Main.k.MakeButton("<img src='http://imgup.motion-twin.com/twinoid/6/4/6666e528_4030.jpg' /> "+Main.k.text.gettext("Supprimer la clé"),null,function(){confirm(Main.k.text.gettext("Si vous supprimez la clé, vous ne pourrez plus synchroniser vos données, voulez vous continuer ?"))&&($(".status_sync").hide(),$(".status_sync_ko").show(),localStorage.removeItem("ctrlw_sync_key"),$("#ctrlw-sync-key").val(""))}).css("display","inline-block").addClass("ctrlw")).appendTo(e),$('<p class="info">').html(Main.k.text.gettext("Afin de pouvoir synchroniser vos données vous devez entrer votre clé d'authentification. Si vous n'en n'avez pas, cliquez sur le bouton \"Générer une nouvelle clé\"")).appendTo(e),$('<p class="warning">'+Main.k.text.gettext("Conservez précieusement votre clé (dans votre bloc-note Twinoid par exemple) afin de pouvoir récupérer vos données.")+"<p>").appendTo(e)}Main.k.folding.display([null,null,"#sync_col"],"sync",function(){})},Main.k.Sync.display=function(e){"sync"==Main.k.folding.displayed?Main.k.Sync.close():Main.k.Sync.open()},Main.k.Sync.close=function(){Main.k.folding.displayGame()},Main.k.Sync.createKey=function(){var e=$(".status_sync");e.hide(),$(".status_sync_load").show(),GM_xmlhttpRequest({url:Main.k.servurl+"/sync/createkey",method:"GET",onload:function(t){e.hide(),$(".status_sync_ok").show();try{t=JSON.parse(t.response)}catch(a){return Main.k.quickNoticeError("Une erreur serveur s'est produite"),console.error("json key",t),!1}localStorage.setItem("ctrlw_sync_key",t.key),$("#ctrlw-sync-key").val(t.key),Main.k.Sync.push()},onerror:function(t,a,i){var n=JSON.parse(t.responseText).message;e.hide(),$(".status_sync_ko").show(),Main.k.quickNoticeError("Une erreur s'est produite : "+n),console.warn(t,a,i)}})},Main.k.Sync.pull=function(e){console.info("Main.k.Sync.pull");var t=new jQuery.Deferred;if("undefined"==typeof e&&(e=localStorage.getItem("ctrlw_sync_key")),null==e)t.reject("key_null");else{var a=$("#ctrlw_sync_button");a.find("img").hide(),a.find(".ctrlw_down").show(),console.log("Main.k.Sync.pull request"),GM_xmlhttpRequest({method:"POST",url:Main.k.servurl+"/sync/pull",data:$.param({last_update_time:localStorage.getItem("ctrlw_sync_last_update_time"),key:e}),headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(e){if(a.find("img").hide(),a.find(".ctrlw_normal").show(),200==e.status){var i=JSON.parse(e.responseText);console.log("Main.k.Sync.pull response",i),"auth"==i.error?(Main.k.quickNoticeError("Cette clé n'existe pas"),t.reject("auth")):("outdated"==i.status&&(console.warn(JSON.parse(i.sync.profiles)),Main.k.Profiles.load(i.sync.profiles,!0),"undefined"!=typeof i.sync.msgs_prerecorded&&Main.k.Manager.loadMsgsPrerecorded(i.sync.msgs_prerecorded,!0),Main.k.GameInfos.load(i.sync.game_infos),Main.k.quickNotice(Main.k.text.gettext("Synchronisation effectuée")),Main.k.MushUpdate()),t.resolve())}else Main.k.quickNoticeError("Sync pull, fatal error")},onerror:function(e,i,n){alert("error Main.k.Sync.pull"),console.warn(e,i,n),a.find("img").hide(),a.find(".ctrlw_normal").show(),t.reject("ajax_error")}})}return t.promise()},Main.k.Sync.push=function(e){console.info("xhr Sync.push1");var t=localStorage.getItem("ctrlw_sync_key");if(null!=t){"undefined"==typeof e&&(e=!1);var a=$("#ctrlw_sync_button");a.find("img").hide(),a.find(".ctrlw_up").show(),console.info("xhr Sync.push2"),setTimeout(function(){GM_xmlhttpRequest({method:"POST",url:Main.k.servurl+"/sync/push",data:$.param({last_update_time:localStorage.getItem("ctrlw_sync_last_update_time"),mush_time:$("#input").attr("now"),profiles:JSON.stringify(Main.k.Profiles.data),game_infos:JSON.stringify(Main.k.GameInfos.data),msgs_prerecorded:JSON.stringify(Main.k.Manager.msgs_prerecorded),key:t,force:e?1:0}),headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(e){if(console.warn("response",e),200==e.status){var t=JSON.parse(e.responseText);if(console.warn("json",t),"ok"==t.status)localStorage.setItem("ctrlw_sync_last_update_time",$("#input").attr("now"));else if(console.warn("json.status",t.status),"undefined"!=typeof t.status)if("undefined"!=typeof t.error&&"auth"==t.error)Main.k.quickNoticeError(Main.k.text.gettext("Synchronisation impossible, clé incorrecte"));else{var i=Main.k.CreatePopup();i.content.css({height:"auto","max-height":"90%",width:"700px",color:"#FFF"});var n="<div class='sync_ask popup-content'>"+Main.k.text.gettext("Les données distantes sont plus récentes que les données locales. <br/> Que voulez vous faire ?")+"<br/>"+Main.k.text.gettext("Date synchro serveur : ")+new Date(t.sync.mush_time)+"<br/>"+Main.k.text.gettext("Date synchro locale : ")+new Date(parseInt(localStorage.getItem("ctrlw_sync_last_update_time")))+"</div>",s=$('<div class=\'popup-actions\'><div id="confirm_pull" class="but updatesbtn" ><div class="butright"><div class="butbg"><a href="#">'+Main.k.text.gettext("Ecraser les données locales")+'</a></div></div></div><div id="confirm_push" class="but updatesbtn" ><div class="butright"><div class="butbg"><a href="#">'+Main.k.text.gettext("Ecraser les données distantes")+"</a></div></div></div></div>");s.find("#confirm_pull").on("click",function(e){e.preventDefault(),Main.k.Sync.pull(),Main.k.ClosePopup()}),s.find("#confirm_push").on("click",function(e){e.preventDefault(),Main.k.Sync.push(!0),Main.k.ClosePopup()});var o="'Main.k.ClosePopup();'",r='<div id="cancel" class="but updatesbtn" onclick='+o+'><div class="butright"><div class="butbg"><a href="#">'+Main.getText("cancel")+"</a></div></div></div></div>";s.append(r),$("<div>").html(n).append(s).appendTo(i.content),Main.k.OpenPopup(i.dom)}a.find("img").hide(),a.find(".ctrlw_normal").show()}else Main.k.quickNoticeError("Sync push, fatal error")},onerror:function(e,t,a){alert("error Main.k.Sync.push"),console.warn(e,t,a)}})},0)}},Main.k.Sync.pushDelay=function(){var e=5,t=localStorage.getItem("ctrlw_sync_key");if(null!=t){var a=$("#ctrlw_sync_button");a.find("img").hide(),a.find(".ctrlw_wheels").show(),clearTimeout(Main.k.Sync.push_timer),a.removeClass("loading");var i=a.clone(!0);a.before(i).remove(),a=i;var n=a.find(".counter");Main.k.countdownTimer.stop("syncdelay"),a.addClass("loading"),n.text(e),Main.k.countdownTimer.go(e,"syncdelay",function(e){a.find(".counter").text(e),0>=e&&n.text("")}),Main.k.Sync.push_timer=setTimeout(function(){a.find("img").hide(),a.find(".ctrlw_normal").show(),a.removeClass("loading"),Main.k.Sync.push(),Main.k.Sync.push_timer=null},1e3*e)}},callbacks_storage_sync.add(Main.k.Sync.pushDelay),Main.k.Profiles={},Main.k.Profiles.initialized=!1,Main.k.Profiles.current=null,Main.k.Profiles.data={},Main.k.Profiles.open=function(){if(console.log("Main.k.folding.displayed",Main.k.folding.displayed),!Main.k.Profiles.initialized){Main.k.Profiles.initialized=!0;var e=Main.k.h[Main.k.Profiles.current];console.log(e);var t=$("<td>").addClass("chat_box ctrlw_col").css({"padding-right":"6px","padding-top":"1px",transform:"scale(0,1)",color:"rgb(9,10,97)"}).attr("id","profile_col").appendTo($("table.inter tr").first()),a=$("<div>").addClass("header").css({background:"rgba(52,74,146,0.35)"}).appendTo(t);$("<img>").css({height:"120px","float":"left",margin:"4px"}).attr("src","/img/art/char/"+e.dev_surname_long+".jpg").appendTo(a),$("<h3>").css({position:"relative",margin:"2px 5px 5px 94px",color:"#EEE","border-bottom":"2px solid #EEE","padding-bottom":"2px","font-size":"17px"}).html("<span>"+Main.k.getFullName(Main.k.Profiles.current)+"</span>").appendTo(a),Main.k.MakeButton("<img src='/img/icons/ui/awake.png' />",null,function(e){Main.k.Profiles.set(Main.k.Profiles.current)}).css({position:"absolute",top:"2px",right:"3px"}).addClass("spy ctrlw").appendTo($("h3",a)).find("a").attr("_title",Main.k.text.gettext("Espionnage")).attr("_desc",Main.k.text.gettext("<p>Vous êtes dans la même pièce que cette personne ; vous pouvez donc l'examiner de plus près.</p><p><strong>Cliquez ici pour enregistrer les compétences visibles, statuts publiques et titres de ce personnage.</strong><p>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),$("<div>").addClass("hero-details").appendTo(a),$("<div>").addClass("clear").appendTo(a);var i=$("<div>").addClass("right").css({"margin-top":"10px"}).appendTo(t),n=$("<div>").attr("id","profile-notes").addClass("rightbg chattext").css({resize:"none",height:"293px","min-height":"0"}).appendTo(i);n.append($("<div>").addClass("profile-content").append($("<label>").attr("for","tiny-notes").html('<img src="/img/icons/ui/infoalert.png" style="vertical-align: text-bottom"/> '+Main.k.text.gettext("Notes résumées :")).addTooltip(Main.k.text.gettext("Notes résumées :"),Main.k.text.gettext("Ce texte apparaitra au survol de la souris sur l'icone du personnage à la place de la description originale du jeu"))).append($("<textarea>").addClass("chatbox").attr("id","tiny-notes").on("focus",function(){$(this).addClass("chatboxfocus")}).on("keyup",function(){$(".desc-submit-button img").hide(),$(".desc-submit-button img.desc-ko").show()})).append($("<label>").attr("for","long-notes").text(Main.k.text.gettext("Notes détaillées :"))).append($("<textarea>").addClass("chatbox").attr("id","long-notes").on("focus",function(){$(this).addClass("chatboxfocus")}).on("keyup",function(){$(".desc-submit-button img").hide(),$(".desc-submit-button img.desc-ko").show()})));var s=$("<div>").addClass("actions").appendTo(n);Main.k.MakeButton("<img src='/img/icons/ui/alert.png' style=\"display:none\" class=\"desc-ko\" /><img class=\"desc-ok\" style='vertical-align:text-bottom' src='/img/icons/ui/projects_done.png' /> "+Main.k.text.gettext("Enregistrer"),null,function(e){e.preventDefault();var t=Main.k.Profiles.get();t.short_desc=$("#tiny-notes").val(),t.long_desc=$("#long-notes").val(),Main.k.Profiles.set(t),$(".desc-submit-button img").hide(),$(".desc-submit-button img.desc-ok").show()}).css("display","inline-block").addClass("desc-submit-button").appendTo(s);var o=$("<div>").css({"text-align":"center",margin:"10px 0 0"}).appendTo(t);Main.k.MakeButton("<img src='/img/icons/ui/pageleft.png' /> "+Main.k.text.gettext("Retour au jeu"),null,Main.k.Profiles.close).css("display","inline-block").appendTo(o)}Main.k.Profiles.update(),Main.k.folding.display([null,null,"#profile_col"],"profiles",function(){})},Main.k.Profiles.display=function(e){console.group("Main.k.Profiles.display"),console.log("surname",e),console.log(Main.k.folding.displayed+' == "profiles" && '+e+" == "+Main.k.Profiles.current),"profiles"==Main.k.folding.displayed&&e==Main.k.Profiles.current?Main.k.Profiles.close():(Main.k.Profiles.current=e,Main.k.Profiles.open()),console.groupEnd()},Main.k.Profiles.update=function(){if(console.group("Main.k.Profiles.update"),null!=Main.k.Profiles.current){console.log("Main.k.Profiles.current",Main.k.Profiles.current);var e=$("#profile_col"),t=e.find(".header"),a=e.find(".hero-details"),i=this,n=Main.k.h[Main.k.Profiles.current];a.empty(),t.find("img").first().attr("src","/img/art/char/"+n.dev_surname_long+".jpg"),t.find("h3 span").html(Main.k.getFullName(Main.k.Profiles.current));var s=this.get(Main.k.Profiles.current),o=e.find(".spy");if(-1!=$.inArray(Main.k.Profiles.current,Main.k.heroes_same_room)?o.show():o.hide(),console.log("o_hero",s),null!=s){var r=$("<div>").addClass("icons statuses");if($.each(s.statuses,function(e,t){$("<img>").attr("src","/img/icons/ui/status/"+t.img+".png").attr("alt",t.img).attr("_title",t.name).attr("_desc",t.desc).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(r)}),"undefined"!=typeof s.spores&&null!=s.spores){console.warn(s.spores);var l=$("<div>").css({position:"relative",display:"inline-block","margin-left":"2px",top:"2px"}).appendTo(r);$("<img>").attr("src","/img/icons/ui/spore.png").attr("height","16").attr("alt",s.spores.name).attr("_title",s.spores.name).attr("_desc",s.spores.desc).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(l),$("<span>").text(s.spores.nb).css({color:"#FFF","font-size":"10px",position:"absolute",left:"4px",top:"1px",opacity:.7,"pointer-events":"none"}).appendTo(l)}var p=$("<div>").addClass("icons skills");$.each(s.skills,function(e,t){var a=$("<span>").addClass("skill").appendTo(p);$("<img>").attr("src","/img/icons/skills/"+t.img+".png").attr("height","19").attr("alt",t.img).attr("_title",t.name).attr("_desc",t.desc+(Main.k.compInactiveMush[t.img]?"<p><strong>"+Main.k.text.gettext("Compétence inactive mush")+"</strong></p>":"")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(a),Main.k.compInactiveMush[t.img]&&$("<img>").attr("src",Main.k.servurl_badconker+"/img/non-mush.png").addClass("actmush").attr("width","10").attr("height","10").attr("_title",Main.k.text.gettext("Compétence inactive mush")).attr("_desc",Main.k.text.gettext("Cette compétence est inactive quand on est mush (source : Twinpedia).")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(a)});var d=$("<div>").css({position:"absolute",right:"5px",top:0}).addClass("titles");console.info("o_hero.titles",s.titles),$.each(s.titles,function(e,t){console.log(t),$("<img>").attr("src","/img/icons/ui/"+t.img+".png").attr("alt",t.img).attr("_title",t.name).attr("_desc",t.desc).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(d)}),a.append(p),a.append(r),a.append(d),$("#long-notes").val("undefined"!=typeof s.long_desc?s.long_desc:""),$("#tiny-notes").val(s.short_desc)}else $("<div>").html(Main.k.text.gettext("Aucune donnée enregistrée")).css({color:"#FFF"}).appendTo(a);var c=$("<div>").addClass("profile-custom-infos").appendTo(a);$("<label />").attr("for","hero_details_dead").append($("<img>").attr({src:"/img/icons/ui/dead.png",alt:Main.k.text.gettext("Mort"),title:Main.k.text.gettext("Mort")})).append($("<input />").attr({id:"hero_details_dead",type:"checkbox"}).prop("checked",s.dead).on("change",function(){
var e=i.get();e.dead=$(this).prop("checked"),i.set(e)})).appendTo(c),$("<label />").attr("for","hero_details_inactive").append($("<img>").attr({src:"/img/icons/ui/"+Main.k.statuses.inactive.img+".png",alt:Main.k.statuses.inactive.name,title:Main.k.statuses.inactive.name})).append($("<input />").attr({id:"hero_details_inactive",type:"checkbox"}).prop("checked",i.hasAttr(s,"statuses",Main.k.statuses.inactive.img)).on("change",function(){var e=i.get();$(this).prop("checked")?e.statuses.push(Main.k.statuses.inactive):e=i.removeAttrFromProfile(e,"statuses",Main.k.statuses.inactive.img),i.set(e),i.update()})).appendTo(c),$("<label />").attr("for","hero_details_hinactive").append($("<img>").attr({src:"/img/icons/ui/"+Main.k.statuses.hinactive.img+".png",alt:Main.k.statuses.hinactive.name,title:Main.k.statuses.hinactive.name})).append($("<input />").attr({id:"hero_details_hinactive",type:"checkbox"}).prop("checked",i.hasAttr(s,"statuses",Main.k.statuses.hinactive.img)).on("change",function(){var e=i.get();$(this).prop("checked")?e.statuses.push(Main.k.statuses.hinactive):e=i.removeAttrFromProfile(e,"statuses",Main.k.statuses.hinactive.img),i.set(e),i.update()})).appendTo(c),$("<label />").attr("for","hero_details_mush").append($("<img>").attr({src:"/img/icons/ui/"+Main.k.statuses.mush.img+".png",alt:Main.k.statuses.mush.name,title:Main.k.statuses.mush.name})).append($("<input />").attr({id:"hero_details_mush",type:"checkbox"}).prop("checked",i.hasAttr(s,"statuses",Main.k.statuses.mush.img)).on("change",function(){var e=i.get();$(this).prop("checked")?e.statuses.push(Main.k.statuses.mush):e=i.removeAttrFromProfile(e,"statuses",Main.k.statuses.mush.img),i.set(e),i.update()})).appendTo(c),console.groupEnd()}},Main.k.Profiles.create=function(e){return{name:Main.k.h[e].name,dev_surname:e,short_desc:Main.k.h[e].short_desc,long_desc:"",statuses:[],titles:[],skills:[],dead:!1}},Main.k.Profiles.set=function(e,t){null==t&&(t=!0),console.group("Main.k.Profiles.save"),console.log("profile",e);var a=this.data;null==a&&(a={}),"string"==typeof e&&(e=this.convertHeroToProfile(Main.k.getHeroBySurname(e))),a[e.dev_surname]=e,this.data=a,console.groupEnd(),t&&(this.save(),Main.k.MushUpdate())},Main.k.Profiles.get=function(e){"undefined"==typeof e&&(e=Main.k.Profiles.current);var t=this.data;return null!=t&&"undefined"!=typeof t[e]?(console.groupEnd(),t[e]):(console.groupEnd(),Main.k.Profiles.create(e))},Main.k.Profiles.save=function(){localStorage.setItem("ctrlw_profiles",JSON.stringify(this.data)),callbacks_storage_sync.fire()},Main.k.Profiles.load=function(e,t){console.info("Main.k.Profiles.load");var a;"undefined"!=typeof e?("undefined"==typeof t||t?(a=e,e=JSON.parse(e)):a=JSON.stringify(e),this.data=e,localStorage.setItem("ctrlw_profiles",a)):(a=localStorage.getItem("ctrlw_profiles"),null!=a&&(this.data=JSON.parse(a)))},Main.k.Profiles.convertHeroToProfile=function(e){console.group("convertHeroToSimpleHero"),console.log("o_hero_orig",e);var t=this.get(e.dev_surname);if(null==t&&(t=Main.k.Profiles.create(e.dev_surname)),t.statuses=[],t.titles=[],t.skills=[],t.spores=null,t.name=e.name,t.dev_surname=e.dev_surname,t.dead=!1,e.statuses)for(var a=e.statuses.iterator();a.hasNext();)t.statuses.push(a.next());$("<div>").addClass("icons skills");if(e.skills)for(var i=e.skills.iterator();i.hasNext();)t.skills.push(i.next());$("<div>").addClass("titles");if(e.titles)for(var n=e.titles.iterator();n.hasNext();)t.titles.push(n.next());return e.spores&&(t.spores=e.spores),console.groupEnd(),t},Main.k.Profiles.removeAttrFromProfile=function(e,t,a,i){console.warn("avant",e[t]),"undefined"==typeof i&&(i="img");for(var n=null,s=0;s<e[t].length;s++)e[t][s][i]==a&&(n=s);return console.warn("milieu",n,e[t]),null!=n&&e[t].splice(n,1),console.warn("apres",e[t]),e},Main.k.Profiles.hasAttr=function(e,t,a,i){"undefined"==typeof i&&(i="img");for(var n=0;n<e[t].length;n++)if(e[t][n][i]==a)return!0;return!1},Main.k.Profiles.hasStatusWhichRemoveTitle=function(e){if(e.dead)return!0;for(var t=null,a=0;a<e.statuses.length;a++)if(t=e.statuses[a],-1!=$.inArray(t.img,[Main.k.statuses.inactive.img,Main.k.statuses.hinactive.img]))return!0;return!1},Main.k.Profiles.close=function(){console.log("Main.k.Profiles.close"),Main.k.Profiles.current=null,Main.k.folding.displayGame()},Main.k.Profiles.clear=function(){Main.k.Profiles.data={},localStorage.removeItem("ctrlw_profiles"),callbacks_storage_sync.fire()},Main.k.GameInfos={},Main.k.GameInfos.data={},Main.k.GameInfos.data.heroes_list=[],Main.k.GameInfos.init=function(){var e=localStorage.getItem("ctrlw_game_infos");null!=e&&(Main.k.GameInfos.data=JSON.parse(e))},Main.k.GameInfos.load=function(e){localStorage.setItem("ctrlw_game_infos",e),Main.k.GameInfos.init()},Main.k.GameInfos.save=function(){localStorage.setItem("ctrlw_game_infos",JSON.stringify(Main.k.GameInfos.data)),callbacks_storage_sync.fire()},Main.k.GameInfos.clear=function(){Main.k.Profiles.data={},localStorage.removeItem("ctrlw_game_infos"),callbacks_storage_sync.fire()},Main.k.Manager={},Main.k.Manager.initialized=!1,Main.k.Manager.heroes=[],Main.k.Manager.open=function(e){console.log("manager open debut");var t,a,i;if("manager"==Main.k.folding.displayed||"manager_mini"==Main.k.folding.displayed)return void Main.k.folding.displayGame();var n=!0,s=!0,o=!0,r=!0;if(!Main.k.Manager.initialized){Main.k.Manager.initialized=!0;var l=$("table.inter tr").first(),p=$("<td>").addClass("chat_box").css({"padding-right":"6px","padding-top":"1px",width:"330px",transform:"scale(0,1)"}).attr("id","topics_col").appendTo(l);t=$("<ul>").addClass("tabschat customtabs").css({margin:0,position:"relative"}).appendTo(p),$("<img>").attr("src","/img/icons/ui/tip.png").appendTo($("<li>").addClass("tab taboff").attr("id","tabstats").appendTo(t)),$("<img>").attr("src","http://twinoid.com/img/icons/new.png").appendTo($("<li>").addClass("tab taboff").attr("id","tabnew").appendTo(t)),$("<img>").attr("src","http://twinoid.com/img/icons/search.png").appendTo($("<li>").addClass("tab taboff").attr("id","tabsearch").appendTo(t)),$("<img>").attr("src","/img/icons/ui/wall.png").appendTo($("<li>").addClass("tab taboff").attr("id","tabwall").appendTo(t)),$("<img>").attr("src","/img/icons/ui/fav.png").appendTo($("<li>").addClass("tab tabon").attr("id","tabfav").appendTo(t)),a=$("<div>").addClass("right").css("margin-top",0).appendTo(p),i=$("<div>").addClass("rightbg chattext").css({resize:"none"}).appendTo(a),$("<div>").addClass("tabcontent").attr("id","tabstats_content").appendTo(i),$("<div>").addClass("tabcontent wall").attr("id","tabnew_content").appendTo(i),$("<div>").addClass("tabcontent wall").attr("id","tabsearch_content").appendTo(i),n&&$("<div>").addClass("tabcontent").attr("id","tabmush_content").appendTo(i),$("<div>").addClass("tabcontent wall").attr("id","tabwall_content").appendTo(i),$("<div>").addClass("tabcontent wall").attr("id","tabfav_content").appendTo(i),s&&$("<div>").addClass("tabcontent").attr("id","tabchat1_content").appendTo(i),o&&$("<div>").addClass("tabcontent").attr("id","tabchat2_content").appendTo(i),r&&$("<div>").addClass("tabcontent").attr("id","tabchat3_content").appendTo(i),i.find(".tabcontent").css("display","none");var d=$("#tabstats");d.attr("_title",Main.k.text.gettext("Statistiques")).attr("_desc",Main.k.text.gettext("Affiche les statistiques, et permet de gérer le nombre de messages chargés dans la page.")),$("#tabnew").attr("_title",Main.k.text.gettext("Nouveaux Messages")).attr("_desc",Main.k.text.gettext("Beaucoup de messages à lire ? Le manager permet de rattraper son retard plus facilement. En chargeant tous les messages dans l'onglet Statistiques, vous pouvez aussi voir les messages non lus manqués à cause du bug (Mush) des messages.")),$("#tabsearch").attr("_title",Main.k.text.gettext("Recherche de Messages")).attr("_desc",Main.k.text.gettext("Une discussion à retrouver ? Envie de savoir combien d'incendies se sont déclarés ? (@neron incendie daedalus)")),$("#tabwall").attr("_title","Discussion").attr("_desc",Main.k.text.gettext("Le canal de discussion est indispensable pour s'organiser avec l'équipage.</p><p>Pour participer vous devez posséder un <strong>talkie-walkie</strong>.")),$("#tabfav").attr("_title",Main.k.text.gettext("Favoris")).attr("_desc",Main.k.text.gettext("Votre sélection de sujets favoris.")),t.find(".tab").on("mouseover",Main.k.CustomTip),t.find(".tab").on("mouseout",Main.k.hideTip),t.find(".tab").on("click",function(){Main.k.Manager.selectTab(this)});var c=$("<td>").addClass("chat_box").css({"padding-right":"6px","padding-top":"1px",width:"330px",transform:"scale(0,1)"}).attr("id","topic_col").appendTo(l);t=$("<ul>").addClass("tabschat customtabs").css({margin:0,position:"relative"}).appendTo(c),$("<img>").attr("src","/img/icons/ui/wall.png").appendTo($("<li>").addClass("tab tabon").attr("id","tabtopic").attr("_title","Discussion").attr("_desc",Main.k.text.gettext("Le canal de discussion est indispensable pour s'organiser avec l'équipage.</p><p>Pour participer vous devez posséder un <strong>talkie-walkie</strong>.")).appendTo(t)),a=$("<div>").addClass("right").css("margin-top",0).appendTo(c),i=$("<div>").addClass("rightbg chattext").css({resize:"none"}).appendTo(a);var u=$("<div>").attr("id","tabtopic_content").addClass("tabcontent wall topicwall").css({resize:"none","min-height":"427px"}).appendTo(i);if($("<p>").addClass("warning").html(Main.k.text.gettext("Aucun topic sélectionné.")).appendTo(u),n){var g=$("<li>").addClass("tab taboff").attr("id","tabmush").attr("_title",Main.k.text.gettext("Canal Mush")).attr("_desc",Main.k.text.gettext("Ssshh, personne nous entend ici... Le Canal Mush est le <em>canal privé</em> pour les adhérents aux <strong>Mush</strong> <img src='/img/icons/ui/mush.png' />.</p><p><strong>/!&#92; Fonctionnalité non codée</strong>")).appendTo(t);$("<img>").attr("src","/img/icons/ui/mush.png").appendTo(g);var m=$("<div>").attr("id","tabmush_content").css("display","none").addClass("tabcontent wall").appendTo(i);$("<p>").addClass("warning").html(Main.k.text.gettext("Disponible prochainement.")).appendTo(m)}if(s){var h=$("<li>").addClass("tab taboff").attr("id","tabchat1").attr("_title",Main.k.text.gettext("Chat privé")+" #1").attr("_desc",Main.k.text.gettext("Chat privé ouvert avec :<br/>[liste des participants]</p><p><strong>/!&#92; Fonctionnalité non codée</strong>")).appendTo(t);$("<img>").attr("src","/img/icons/ui/private.png").appendTo(h);var k=$("<div>").attr("id","tabchat1_content").css("display","none").addClass("tabcontent wall").appendTo(i);$("<p>").addClass("warning").html("Disponible prochainement.").appendTo(k)}if(o){var f=$("<li>").addClass("tab taboff").attr("id","tabchat2").attr("_title",Main.k.text.gettext("Chat privé")+" #2").attr("_desc",Main.k.text.gettext("Chat privé ouvert avec :<br/>[liste des participants]</p><p><strong>/!&#92; Fonctionnalité non codée</strong>")).appendTo(t);$("<img>").attr("src","/img/icons/ui/private.png").appendTo(f);var M=$("<div>").attr("id","tabchat2_content").css("display","none").addClass("tabcontent wall").appendTo(i);$("<p>").addClass("warning").html("Disponible prochainement.").appendTo(M)}if(r){var x=$("<li>").addClass("tab taboff").attr("id","tabchat3").attr("_title",Main.k.text.gettext("Chat privé")+" #3").attr("_desc",Main.k.text.gettext("Chat privé ouvert avec :<br/>[liste des participants]</p><p><strong>/!&#92; Fonctionnalité non codée</strong>")).appendTo(t);$("<img>").attr("src","/img/icons/ui/private.png").appendTo(x);var v=$("<div>").attr("id","tabchat3_content").css("display","none").addClass("tabcontent wall").appendTo(i);$("<p>").addClass("warning").html("Disponible prochainement.").appendTo(v)}t.find(".tab").on("mouseover",Main.k.CustomTip),t.find(".tab").on("mouseout",Main.k.hideTip),t.find(".tab").on("click",function(){Main.k.Manager.selectTopicTab(this)});var b=$("<td>").addClass("chat_box").css({transform:"scale(0,1)","padding-top":"1px","text-align":"right"}).attr("id","reply_col").appendTo(l);t=$("<ul>").addClass("tabschat customtabs").css({margin:0,"text-align":"left",position:"relative"}).appendTo(b);var _=$("<li>").addClass("tab tabon").attr("id","tabreply").attr("_title",Main.k.text.gettext("Nouveau message")).attr("_desc",Main.k.text.gettext("Répondez à un topic / une discussion ou créez un nouveau topic.")).appendTo(t),y=$("<li>").addClass("tab taboff").attr("id","tabneron").attr("_title",Main.k.text.gettext("Annonces vocodées")).attr("_desc",Main.k.text.gettext("Assistant pour les Admin. Néron pour faciliter la création d'annonces vocodées.</p><p><strong>/!&#92; Fonctionnalité non codée</strong>")).appendTo(t),w=$("<li>").addClass("tab taboff").attr("id","tabcustom").attr("_title",Main.k.text.gettext("Messages pré-enregistrés")).attr("_desc",Main.k.text.gettext("Messages récurrents & autres (à définir).</p><p><strong>/!&#92; Fonctionnalité non codée</strong>")).appendTo(t);$("<img>").attr("src","http://twinoid.com/img/icons/edit.png").appendTo(_),$("<img>").attr("src","/img/icons/ui/neron.png").appendTo(y),$("<img>").attr("src","/img/icons/ui/book.png").appendTo(w),t.find(".tab").on("mouseover",Main.k.CustomTip),t.find(".tab").on("mouseout",Main.k.hideTip),t.find(".tab").on("click",function(){Main.k.Manager.selectReplyTab(this)}),a=$("<div>").addClass("right").css("margin-top",0).appendTo(b),i=$("<div>").addClass("rightbg chattext").css({resize:"none","text-align":"center",position:"relative"}).appendTo(a);{var T=($("<div>").attr("id","tabreply_content").addClass("tabcontent wall").appendTo(i),$("<div>").attr("id","tabneron_content").css("display","none").addClass("tabcontent wall").appendTo(i));$("<div>").attr("id","tabcustom_content").css("display","none").addClass("tabcontent wall").appendTo(i)}$("<p>").addClass("warning").html(Main.k.text.gettext("Disponible prochainement.")).appendTo(T);var C=Main.k.MakeButton("<img src='/img/icons/ui/less.png' /> Réduire le Manager",null,function(){Main.k.Manager.minimize()}).attr("id","manager_togglemini").appendTo(b);C.css({margin:"3px 4px 0 auto",display:"inline-block"});var P=Main.k.MakeButton("<img src='/img/icons/ui/pageleft.png' /> "+Main.k.text.gettext("Fermer le Manager"),null,function(){Main.k.Manager.open()}).appendTo(b);P.css({margin:"3px 4px 0 auto",display:"inline-block"})}Main.k.Manager.update(),Main.k.Manager.selectTab(d),$("#manager_togglemini").find("a").html("<img src='/img/icons/ui/less.png' /> "+Main.k.text.gettext("Réduire le Manager")),Main.k.folding.display(["#topics_col","#topic_col","#reply_col"],"manager",e)},Main.k.Manager.replywaiting="",Main.k.Manager.openOn=function(e,t,a){if(t&&t.length>0&&(Main.k.Manager.replywaiting=t),"newtopic"==e)Main.k.Manager.open();else if("reply"==e){Main.k.Manager.displayedTopic=a;var i=function(){var e=Main.k.Manager.displayedTopic;Main.k.Manager.selectTopic(e)};Main.k.Manager.open(i)}},Main.k.Manager.minimize=function(){var e=$("#manager_togglemini");"manager"==Main.k.folding.displayed?(e.find("a").html("<img src='/img/icons/ui/more.png' /> Agrandir le Manager"),Main.k.folding.display([Main.k.folding.gamecols[0],Main.k.folding.gamecols[1],"#reply_col"],"manager_mini")):(e.find("a").html("<img src='/img/icons/ui/less.png' /> "+Main.k.text.gettext("Réduire le Manager")),Main.k.folding.display(["#topics_col","#topic_col","#reply_col"],"manager"))},Main.k.Manager.selectTab=function(e){var t=$("#topics_col");t.find(".tab").removeClass("tabon").addClass("taboff"),$(e).removeClass("taboff").addClass("tabon"),t.find(".tabcontent").css("display","none"),$("#"+$(e).attr("id")+"_content").css("display","block")},Main.k.Manager.selectTopicTab=function(e){var t=$("#topics_col");t.find(".tab").removeClass("tabon").addClass("taboff"),$(e).removeClass("taboff").addClass("tabon"),t.find(".tabcontent").css("display","none"),$("#"+$(e).attr("id")+"_content").css("display","block")},Main.k.Manager.selectReplyTab=function(e){var t=$("#reply_col");t.find(".tab").removeClass("tabon").addClass("taboff"),$(e).removeClass("taboff").addClass("tabon"),t.find(".tabcontent").css("display","none"),$("#"+$(e).attr("id")+"_content").css("display","block")},Main.k.Manager.topics=[],Main.k.Manager.replies=[],Main.k.Manager.lastago="",Main.k.Manager.loadedtopics=[],Main.k.Manager.loadedreplies=[],Main.k.Manager.lmwProcessing=!1,Main.k.Manager.loadWholeWall=function(e){if(!Main.k.Manager.lmwProcessing){Main.k.Manager.lmwProcessing=!0;{var t=Main.getChannel(Main.curChatIndex()).find("div.wall div.unit").last();t.closest(".wall")}if(t.length>0){var a=e?e:t.attr("data-k");Tools.ping("/retrWallAfter/"+a,function(e){var t=$(e);if(Main.k.Manager.lmwProcessing=!1,t.find(".wall").html().trim().length>0){Main.k.Manager.parseWall(t.find(".wall"));var a=t.find(".wall .unit").last().attr("data-k");Main.k.Manager.loadWholeWall(a)}else Main.k.Manager.update()})}else Main.k.Manager.lmwProcessing=!1,Main.k.Manager.update()}},Main.k.Manager.parseWall=function(e){e.find||(e=$(e));var t=e.find(".mainmessage");t.each(function(){var e,t=$(this).closest(".unit").attr("data-k"),a=Main.k.Manager.loadedtopics[t],i=a?Main.k.Manager.getTopicByTid(t):{};a||(i.mushid=t),a||(i.fav="cdFavWall"==$(this).closest(".cdWallChannel").attr("id"));var n="";if(!a){if(0!=$(this).find(".mainsaid.neron_talks").length)if(n="neron",Main.k.Manager.heroes[n].mess++,$(this).find(".mainsaid.neron_talks p").length>0)Main.k.Manager.heroes[n].av++,i.msg="",$(this).find("p, ul").each(function(){i.msg+="<"+$(this).prop("tagName")+">"+$(this).html()+"</"+$(this).prop("tagName")+">"});else{Main.k.Manager.heroes[n].a++;var s=$(this).find(".mainsaid.neron_talks").html();s=s.replace(/([\r\n]+)/g,""),i.msg=/NERON\s:<\/span>(.+)<span\s*class="ago"/i.exec(s)[1].trim()}else n=Main.k.GetHeroNameFromTopic($(this)),Main.k.Manager.heroes[n].mess++,Main.k.Manager.heroes[n].topic++,i.msg="",$(this).find("p, ul").each(function(){i.msg+="<"+$(this).prop("tagName")+">"+$(this).html()+"</"+$(this).prop("tagName")+">"}),""==i.msg&&(i.msg=$(this).find(".mainsaid").clone().children().remove().end().text());i.author=n,i.id=Main.k.Manager.topics.length}i.ago=$(this).find(".ago").html().trim(),e=i.ago,i.read=!$(this).hasClass("not_read"),i.realread=!$(this).hasClass("not_read"),(i.realread||Main.k.hasTalkie)&&(Main.k.Manager.loadedtopics[t]=!0,a||(i.replies=[]),a||Main.k.Manager.topics.push(i),$(this).parent().find(".cdRepl").each(function(){var t=$(this).closest(".unit").attr("data-k"),a=Main.k.Manager.getTopicByTid(t),i=$(this).attr("data-idx"),n=a.mushid+"."+i,s=1==Main.k.Manager.loadedreplies[n],o=s?a.replies[i]:{};o||(o={});var r="";s||(0!=$(this).find(".neron").length?(r="neron",Main.k.Manager.heroes[r].mess++,Main.k.Manager.heroes[r].av++):(r=Main.k.GetHeroNameFromTopic($(this)),Main.k.Manager.heroes[r].mess++),o.author=r,o.msg="",$(this).find("p, ul").each(function(){o.msg+="<"+$(this).prop("tagName")+">"+$(this).html()+"</"+$(this).prop("tagName")+">"}),""==o.msg&&(o.msg=$(this).find(".reply").clone().children().remove().end().text()),o.tid=a.id,o.id=i),o.ago=$(this).find(".ago").html().trim(),e=Main.k.minAgo(o.ago,e),o.read=!$(this).hasClass("not_read"),a.read&&!o.read&&(a.read=!1),(o.read||Main.k.hasTalkie)&&(Main.k.Manager.loadedreplies[n]=!0,s||(a.replies.push(o),Main.k.Manager.replies.push(o)))}),Main.k.Manager.lastago=Main.k.maxAgo(e,Main.k.Manager.lastago))})},Main.k.Manager.parseTopic=function(e,t){var a=$("<div>").addClass("reply bubble unit");Main.k.Options.cbubbles&&a.addClass("bubble_"+e.author),Main.k.Options.cbubblesNB&&a.addClass("custombubbles_nobackground");var i="neron"==e.author,n=$("<div>").addClass(i?e.author:"char "+e.author).appendTo(a);"neron"==e.author&&n.html('<img src="/img/icons/ui/neron.png">'),$("<span>").addClass("buddy").html(i?" NERON : ":" "+Main.k.COMPLETE_SURNAME(e.author)+" : ").appendTo(a);var s=e.msg;if(t)for(var o=0;o<t.length;o++){var r=new RegExp(t[o],"gi");s=s.replace(r,"<span class='highlight'>"+t[o]+"</span>")}return $("<div>").css("display","inline").html(s).appendTo(a),$("<span>").addClass("ago").html(e.ago).appendTo(a),a},Main.k.Manager.displayedTopic=null,Main.k.Manager.displayTopic=function(e,t){var a=!0,i=$("#tabtopic_content").empty(),n=Main.k.Manager.topics[e],s=Main.k.Manager.parseTopic(n,t);Main.k.Manager.displayedTopic=n.mushid,s.attr("class","bubble mainmessage mainsaid"),"neron"==n.author&&(s.find("img").remove(),s.addClass("neron_talks")),s.css({"padding-bottom":"20px","z-index":"10"}).appendTo(i),Main.k.Options.cbubbles?(s.addClass("bubble_"+n.author),Main.k.Options.cbubblesNB&&s.addClass("custombubbles_nobackground")):s.css("background","rgba(255,255,255,0.8)"),n.realread||(s.addClass("not_read"),s.prepend($("<img>").addClass("recent").attr("src","/img/icons/ui/recent.png")),s.attr("data-k",n.mushid),s.on("mouseover",function(){ArrayEx.pushBack(Main.checkedWallPost,$(this).attr("data-k")),haxe.Timer.delay(Main.sendWallChecked,1e3),$(this).find(".recent").remove(),$(this).removeClass("not_read"),$(this).off("onmouseover")})),n.replies.length>10&&!a&&$("<a>").addClass("displaymore").attr("href","#").on("click",Main.k.Manager.displayAllReplies).html("Afficher les "+n.replies.length+" messages").appendTo(i);for(var o=$("<table>").addClass("treereply").appendTo(i),r=$("<tbody>").appendTo(o),l=0;l<n.replies.length;l++){var p=n.replies[l],d=$("<tr>").addClass("cdRepl").appendTo(r);n.replies.length>10&&p.read&&!a&&d.addClass("messread"),p.read||d.addClass("not_read");var c="tree"+(l==n.replies.length-1?" treelast":"");$("<td>").addClass(c).appendTo(d);var u=$("<td>").appendTo(d),g=Main.k.Manager.parseTopic(p,t);g.removeClass("unit").appendTo(u),g.prepend($("<div>").attr("class","triangleup")),p.read||g.prepend($("<img>").addClass("recent").attr("src","/img/icons/ui/recent.png")),d.attr("data-k",n.mushid),d.attr("data-idx",p.id),d.on("mouseover",function(){ArrayEx.pushBack(Main.checkedWallPost,$(this).attr("data-k")+"#"+$(this).attr("data-idx")),haxe.Timer.delay(Main.sendWallChecked,1e3),$(this).find(".recent").remove(),$(this).removeClass("not_read"),$(this).off("mouseover")})}},Main.k.Manager.displayAllReplies=function(){var e=$("#tabtopic_content");e.find(".messread").each(function(){$(this).removeClass("messread")}),e.find(".displaymore").addClass("messread")},Main.k.Manager.getTopicByTid=function(e){for(var t=0;t<Main.k.Manager.topics.length;t++){var a=Main.k.Manager.topics[t];if(a.mushid==e)return a}return!1},Main.k.Manager.clearSess=function(){js.Cookie.set("sid","",-42,"/","."+Main.k.domain),$("<iframe>",{src:Main.k.mushurl+"/me",id:"sessionframe",scrolling:"no"}).css({width:0,height:0,display:"none",position:"absolute"}).appendTo("body").load(function(){var el=$("#cdContent",$("#sessionframe").contents()).clone();el.find("embed").remove();var $cdContent=$("#cdContent");$cdContent.replaceWith(el),eval($cdContent.find("script").html()),$("#sessionframe").remove(),Main.refreshChat(),Main.acListMaintainer.refresh(!0),$(document).attr("title","Mush - Jeu de survie dans l'espace : Vous êtes le seul espoir de l'humanité !"),Main.k.Manager.topics=[],Main.k.Manager.replies=[],Main.k.Manager.lastago="",Main.k.Manager.loadedtopics=[],Main.k.Manager.loadedreplies=[],Main.k.Manager.update()})},Main.k.Manager.updateHeroes=function(){Main.k.Manager.initHeroes();for(var e=0;e<Main.k.Manager.topics.length;e++){var t=Main.k.Manager.topics[e];Main.k.Manager.heroes[t.author].topic++,Main.k.Manager.heroes[t.author].mess++;for(var a=0;a<t.replies.length;a++){var i=t.replies[a];Main.k.Manager.heroes[i.author].mess++}}},Main.k.Manager.sortedheroes=[],Main.k.Manager.sortHeroes=function(){Main.k.Manager.sortedheroes=[];for(var e in Main.k.Manager.heroes)if(Main.k.Manager.heroes.hasOwnProperty(e)){var t=Main.k.Manager.heroes[e];if(!t||void 0==t.mess)continue;Main.k.Manager.sortedheroes.push(e)}Main.k.Manager.sortedheroes.sort(function(e,t){t=Main.k.Manager.heroes[t],e=Main.k.Manager.heroes[e];var a=t.mess,i=e.mess;if(a==i){var n=t.topic,s=e.topic;if(n==s){var o=t.name,r=e.name;return o>r?1:-1}return n>s?1:-1}return a>i?1:-1})},Main.k.Manager.loadingMessages=function(){var e=$("#recap_div");e.empty(),$("<p>").addClass("warning").html(Main.k.text.gettext("Chargement en cours...")).appendTo(e)},Main.k.Manager.fillStats=function(){var e=$("#tabstats_content").empty();e.css({color:"rgb(9, 10, 97)"});var t=$("<div>").addClass("warning").html(Main.k.text.gettext("Gérez le nombre de messages chargés.Le manager est plus complet lorsque tous les messages sont chargés, mais le jeu devient beaucoup plus lent à cause du chargement de ces messages à chaque action (particularité de mush...).")).css("background-position","7px 15px").appendTo(e),a=$("<div>").css({"text-align":"center","margin-top":"8px"}).appendTo(t);Main.k.MakeButton("<img src='/img/icons/ui/wall.png' class='alerted' /><img src='/img/icons/ui/onceplus.png' class='alert' /> "+Main.k.text.gettext("Tout charger"),null,function(){Main.k.Manager.loadingMessages(),Main.k.Manager.loadWholeWall()}).appendTo(a).find("a").attr("_title",Main.k.text.gettext("Charger tous les messages")).attr("_desc",Main.k.text.gettext("Chargez tous les messages pour profiter pleinement du manager : recherches dans tous les messages depuis le début de la partie, nouveaux messages manqués à cause du bug de mush, statistiques complètes, etc.</p><p><strong>Cette action peut prendre un certain temps, suivant le nombre de messages postés sur votre vaisseau.</strong>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),Main.k.MakeButton("<img src='/img/icons/ui/wall.png' class='alerted' /><img src='/img/icons/ui/bin.png' class='alert' /> "+Main.k.text.gettext("Décharger"),null,function(){Main.k.Manager.loadingMessages(),Main.k.Manager.clearSess()}).appendTo(a).find("a").attr("_title",Main.k.text.gettext("Décharger les messages")).attr("_desc",Main.k.text.gettext("Déchargez la liste de messages pour alléger le jeu. Lorsque vous chargez des messages (en scrollant sur le chat, par exemple), ceux-ci restent chargés. Mush chargeant toute la page (dont les messages) à chaque action, votre jeu est grandement ralenti lorsque le nombre de messages chargés est conséquent.</p><p><strong>Cette action bloque le jeu pendant quelques secondes.</strong>")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),a.find(".but").css({display:"inline-block",margin:"0 2px"});var i=$("<div>").attr("id","recap_div").addClass("recap").appendTo(e);Main.k.Manager.updateHeroes(),Main.k.Manager.sortHeroes();for(var n=Main.k.Manager.topics.length,s=Main.k.Manager.replies.length,o=n+s,r=($("<p>").html(Main.k.text.strargs(Main.k.text.ngettext("Total : <b>%1</b> message chargé","Total : <b>%1</b> messages chargés",o),[o])+" "+Main.k.text.strargs(Main.k.text.ngettext("en <b>%1</b> topic. <br/> (depuis %2)","en <b>%1</b> topics. <br/> (depuis %2)",n),[n,Main.k.extendAgo(Main.k.Manager.lastago)])).appendTo(i),$("<div>").addClass("chars").appendTo(i)),l="//"+Main.k.text.strargs(Main.k.text.ngettext("Total : %1 message","Total : %1 messages",o),[o])+"//",p=6,d=0;d<Main.k.Manager.sortedheroes.length;d++){var c=Main.k.Manager.heroes[Main.k.Manager.sortedheroes[d]];if(c&&void 0!=c.mess){d==p&&$("<br/>").appendTo(r);var u=$("<div>").addClass("hero _"+c.name).attr("_title",Main.k.COMPLETE_SURNAME(c.name)).css("cursor","help").appendTo(r);p>d&&u.addClass("highlight"),"neron"==c.name?u.attr("_desc",Main.k.text.strargs(Main.k.text.ngettext("<b>%1</b> message","<b>%1</b> messages",c.mess),[c.mess])):u.attr("_desc",Main.k.text.strargs(Main.k.text.ngettext("<b>%1</b> message","<b>%1</b> messages",c.mess),[c.mess])+" "+Main.k.text.strargs(Main.k.text.ngettext("dont <b>%1</b> topic.","dont <b>%1</b> topics.",c.topic),[c.topic])),u.on("mouseover",Main.k.CustomTip),u.on("mouseout",Main.k.hideTip),u.on("click",Main.k.Manager.searchHero),$("<img>").attr("src","/img/icons/ui/"+c.name.replace("_","")+".png").appendTo(u);var g=p>d?c.mess+"&nbsp;messages":c.mess;$("<span>").html(g).appendTo(u),l+="\n"+Main.k.text.strargs(Main.k.text.ngettext("**%1 : ** //%2// message","**%1 : ** //%2// messages",c.mess),[Main.k.COMPLETE_SURNAME(c.name),c.mess])}}$("<textarea>").val(l).appendTo(i)},Main.k.Manager.fillNewFav=function(){for(var e,t,a,i=$("#tabnew_content").empty().css("color","rgb(9, 10, 97)"),n=$("#tabfav_content").empty().css("color","rgb(9, 10, 97)"),s=!0,o=[],r=0;r<this.topics.length;r++)if(e=this.topics[r],e.fav&&o.push(e),!e.read){s=!1,t=this.parseTopic(e),"neron"==e.author&&(t.find("img").remove(),t.addClass("mainmessage neron_talks")),i.append(t);var l=0;e.realread||l++;for(var p=0;p<e.replies.length;p++){var d=e.replies[p];d.read||l++}a=$("<a>").addClass("topicact").attr("href","#topic"+r).on("click",function(){return Main.k.Manager.displayTopic(parseInt(/([0-9]+)/.exec(this.href)[1])),!1}).html(Main.k.text.strargs(Main.k.text.ngettext("%1 réponse","%1 réponses",e.replies.length),[e.replies.length])+" - "+Main.k.text.strargs(Main.k.text.ngettext("%1 message non lu","%1 messages non lus",l),[l])).appendTo(i)}for(s&&$("<p>").addClass("warning").html(Main.k.text.gettext("Aucun message non lu.")).appendTo(i),0==o.length&&$("<p>").addClass("warning").html(Main.k.text.gettext("Vous n'avez pas de favoris.")).appendTo(i),r=0;r<o.length;r++)e=o[r],t=this.parseTopic(e),"neron"==e.author&&(t.find("img").remove(),t.addClass("mainmessage neron_talks")),n.append(t),a=$("<a>").addClass("topicact").attr("href","#topic"+e.id).on("click",function(){return Main.k.Manager.displayTopic(parseInt(/([0-9]+)/.exec(this.href)[1])),!1}).html(Main.k.text.strargs(Main.k.text.ngettext("%1 réponse","%1 réponses",e.replies.length),[e.replies.length])).appendTo(n)},Main.k.Manager.fillWall=function(){for(var e=$("#tabwall_content").empty().css("color","rgb(9, 10, 97)"),t=0;t<this.topics.length;t++){var a=this.topics[t],i=this.parseTopic(a);"neron"==a.author&&(i.find("img").remove(),i.addClass("mainmessage neron_talks")),e.append(i);var n=0;a.realread||n++;for(var s=0;s<a.replies.length;s++){var o=a.replies[s];o.read||n++}{$("<a>").addClass("topicact").attr("href","#topic"+t).on("click",function(){return Main.k.Manager.displayTopic(parseInt(/([0-9]+)/.exec(this.href)[1])),!1}).html(Main.k.text.strargs(Main.k.text.ngettext("%1 réponse","%1 réponses",a.replies.length),[a.replies.length])).appendTo(e)}}},Main.k.Manager.fillSearch=function(){var e=$("#tabsearch_content").empty().css("color","rgb(9, 10, 97)"),t=$("<div>").addClass("bar").appendTo(e);$("<input>").css("padding-bottom","2px").attr("type","text").attr("id","searchfield").on("keypress",function(e){13==e.keyCode&&Main.k.Manager.search()}).appendTo(t),$("<a>").css({cursor:"pointer",position:"absolute",top:"4px",left:"4px"}).addClass("butmini").html('<img src="/img/icons/ui/guide.png"/>').appendTo(t).on("click",Main.k.Manager.fillSearch),$("<a>").css("cursor","pointer").addClass("butmini").html('<img src="http://twinoid.com/img/icons/search.png"/>').appendTo(t).on("click",Main.k.Manager.search);var a=$("<div>").attr("id","searchresults").appendTo(e);$("<h4>").html(Main.k.text.gettext("Fonction de recherche")).appendTo(a),$("<p>").addClass("help").html(Main.k.text.gettext("- Vous pouvez rechercher plusieurs mots, dans le désordre, complets ou non, qu'importe le contenu entre eux dans le message.")).appendTo(a),$("<p>").addClass("help").html(Main.k.text.gettext("- Pour rechercher les messages d'un joueur en particulier, utilisez <i>@personnage</i> (le prénom en minuscule, avec un _ pour kuan_ti et jin_su).")).appendTo(a),$("<p>").addClass("help").html(Main.k.text.gettext("- Pour rechercher uniquement dans le premier message des topics, utilisez <i>@topic</i>.")).appendTo(a)},Main.k.Manager.search=function(){var e,t,a,i,n=$("#searchfield").val().trim(),s=[],o=500,r=!1,l=$("#searchresults");l.empty();for(var p=n.split(/\s+/),d=[],c=[],u=[],g=0;g<p.length;g++)if("@topic"!=p[g])if("@"!=p[g][0])"!"!=p[g][0]?(e=p[g].replace(/([^a-z0-9-éèêëàâœôöîïüûùç'%_]+)/gi,""),e.length>2&&d.push(e)):(e=p[g].replace(/([^a-z0-9-éèêëàâœôöîïüûùç'%_]+)/gi,""),e.length>2&&c.push(e));else{var m=p[g].replace("@","");

u.push(m)}else r=!0;if(d=Main.k.EliminateDuplicates(d),c=Main.k.EliminateDuplicates(c),u=Main.k.EliminateDuplicates(u),u.length>=1||d.length>=1||c.length>=1){var h="("+d.join("|")+")",k=d.length,f=0;for(g=0;g<Main.k.Manager.topics.length&&o>f;g++){C=Main.k.Manager.topics[g];var M=!1,x=!1,v=!1;if(u.length>0)for(var b=0;b<u.length;b++)C.author==u[b]&&(x=!0,0==k&&(M=!0));if(c.length>0){var _=new RegExp("("+c.join("|")+")","gi");C.msg.match(_)&&(M=!1,v=!0)}!v&&d.length>0&&(0==u.length||x)&&(t=new RegExp(h,"gi"),a=C.msg.match(t),a&&a.length>=k&&(i=Main.k.EliminateDuplicates(a),a.length==i.length&&(M=!0)));for(var y=0;y<C.replies.length&&!M&&!r;y++){var w=C.replies[y];if(x=!1,v=!1,u.length>0)for(var T=0;T<u.length;T++)w.author==u[T]&&(x=!0,0==k&&(M=!0));c.length>0&&(t=new RegExp("("+c.join("|")+")","gi"),w.msg.match(t)&&(M=!1,v=!0)),!v&&d.length>0&&(0==u.length||x)&&(t=new RegExp(h,"gi"),a=w.msg.match(t),a&&a.length>=k&&(i=Main.k.EliminateDuplicates(a),a.length==i.length&&(M=!0)))}M&&(f++,s.push(C))}}if(s.length>0)for($("<p>").addClass("warning").html(Main.k.text.strargs(Main.k.text.ngettext("%1 résultat (maximum : %2).","%1 résultats (maximum : %2).",s.length),[s.length,o])).appendTo(l),g=0;g<s.length;g++){var C=s[g],P=Main.k.Manager.parseTopic(C,d);l.append(P),$("<a>").addClass("topicact").attr("href","#topic"+C.id).on("click",function(){return Main.k.Manager.displayTopic(parseInt(/([0-9]+)/.exec(this.href)[1]),d),!1}).html(Main.k.text.strargs(Main.k.text.ngettext("%1 réponse","%1 réponses",C.replies.length),[C.replies.length])).appendTo(l)}else u.length>=1||d.length>=1||c.length>=1?$("<p>").addClass("warning").html(Main.k.text.gettext("Aucun résultat.")).appendTo(l):$("<p>").addClass("warning").html(Main.k.text.gettext("Le texte recherché est trop court.")).appendTo(l)},Main.k.Manager.searchHero=function(e){var t=$(e.target);t.attr("class")||(t=t.parent());var a=t.attr("class").replace("hero _","").replace("highlight","");Main.k.Manager.selectTab($("#tabsearch")),$("#searchfield").val("@"+a),Main.k.Manager.search()},Main.k.Manager.replyloaded=!1,Main.k.Manager.fillReply=function(){if(Main.k.Manager.replyloaded)""!=Main.k.Manager.replywaiting&&($("#tabreply_content").find(".tid_wallPost").val(Main.k.Manager.replywaiting),Main.k.Manager.replywaiting="");else{var e=$("#tabreply_content").empty();e.html("<div class='loading'><img src='http://twinoid.com/img/loading.gif' alt='Chargement' /> "+Main.k.text.gettext("Chargement…")+"</div>"),Main.k.LoadJS("/mod/wall/post",{_id:"tabreply_content"},function(){Main.k.Manager.replyloaded=!0;var e=$("#tabreply_content");e.find(".tid_advanced").remove(),e.find(".tid_button").remove(),e.find(".tid_options").remove(),e.find(".tid_editorBut_question").remove(),e.find(".tid_editorBut__user").remove(),e.find(" #tid_wallPost_preview").attr("id","").addClass("tid_wallPost_preview"),e.find(" #tid_wallPost").attr("id","").addClass("tid_wallPost");var t=e.find(".tid_wallPost_preview").attr("id","").addClass("reply bubble");Main.k.Options.cbubbles&&t.addClass("bubble_"+Main.k.ownHero),Main.k.Options.cbubblesNB&&t.addClass("custombubbles_nobackground");var a=Main.k.ownHero;$("<div>").addClass("char "+a).appendTo(t),$("<span>").addClass("buddy").html(Main.k.ownHero.replace("_"," ").capitalize()+" : ").appendTo(t),$("<p>").addClass("tid_preview tid_editorContent tid_wallPost_preview").appendTo(t),$("<div>").addClass("clear").appendTo(t);{var i=$("<div>").addClass("tid_buttons").appendTo(e);Main.k.MakeButton("<img src='http://twinoid.com/img/icons/reply.png' /> "+Main.k.text.gettext("Répondre au topic"),null,function(){var t=e.find(".tid_wallPost"),a=t.val(),i=Main.k.Manager.displayedTopic;Main.k.postMessage(i,a,Main.k.Manager.update),t.val(""),Main.k.Manager.waitingforupdate=!0,setTimeout(function(){Main.k.Manager.waitingforupdate&&Main.k.Manager.update()},5e3)}).css({display:"inline-block",margin:"4px 4px 8px"}).appendTo(i).find("a").attr("_title","Répondre").attr("_desc",Main.k.text.gettext("Envoyer ce message en tant que réponse au topic affiché ci-contre.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),Main.k.MakeButton("<img src='http://twinoid.com/img/icons/reply.png' /> "+Main.k.text.gettext("Nouveau topic"),null,function(){var t=e.find(".tid_wallPost"),a=t.val();Main.k.newTopic(a,Main.k.Manager.update),t.val("")}).css({display:"inline-block",margin:"4px 4px 8px"}).appendTo(i).find("a").attr("_title","Nouveau topic").attr("_desc",Main.k.text.gettext("Poster ce message en tant que nouveau topic.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip)}"undefined"==typeof js.Lib.window.editor_tid_wallPost&&(js.Lib.window.editor_tid_wallPost={}),js.Lib.window.editor_tid_wallPost.preview=t,js.Lib.window.editor_tid_wallPost.loadSmileys=function(e){var t,a=this;if(this.initIcons(),this.smileysPanel.find(".tid_active").removeClass("tid_active").is(e))return this.hideSmileys(!0);this.hideSmileys(!1);var i=e.attr("tid_cat"),n=null;if("_funtag"!=i){for(var s=this.config.icons.iterator();s.hasNext();){var o=s.next();if(o.category==i){n=o;break}}if(null==n)return!1}var r=new StringBuf;if(r.b+='<div class="tid_smileyPopUp">',"_funtag"==i){r.b+=Std.string('<div class="tid_title">'+this.config.funTitle+"</div>");for(var l=[],p=this.config.fun.keys();p.hasNext();)t=p.next(),l.push(t);l.sort(function(e,t){return Reflect.compare(e,t)});for(var d=0;d<l.length;)t=l[d],++d,r.b+=Std.string('<a class="tid_fun" href="#" tid_s="'+StringTools.htmlEscape("{"+t+"}")+'"><img src="http://'+_tid.host+"/img/icons/"+this.config.fun.get(t).i+'.png" alt="'+t+'" title="'+StringTools.htmlEscape(this.config.fun.get(t).n)+'"/>'+StringTools.htmlEscape(this.config.fun.get(t).n)+"</a>")}else{r.b+=Std.string('<div class="tid_title">'+n.category+"</div>"),r.b+='<div class="tid_wrapper">';for(var c=n.icons.iterator();c.hasNext();){var u=c.next();if("Mush"==n.category){if("/ui/o2.png"==u.image)continue;if(":mush_pa_gen:"==u.tag)continue;if(":mush_pa_mov:"==u.tag)continue;if(":mush_planet:"==u.tag)continue;":mush_pa:"==u.tag?(u.tag=":pa:",u.image="/img/icons/ui/pa_slot1.png"):":mush_pm:"==u.tag?(u.tag=":pm:",u.image="/img/icons/ui/pa_slot2.png"):":mush_exp:"==u.tag&&(u.tag=":xp:",u.image="/img/icons/ui/xp.png")}var g=u.tag,m=u.tag;null!=u.alt&&(g=u.alt,m=u.alt+", "+u.tag);var h="";null!=u.max&&(h+='<span class="tid_max tid_max_'+u.tag.split(":").join("")+'">'+u.max+"</span>"),r.b+=Std.string('<a class="tid_smiley" href="#">'+h+'<img src="'+n.url+u.image+'" tid_s="'+StringTools.htmlEscape(g)+'" title="'+StringTools.htmlEscape(m)+'"/></a>')}r.b+="</div>"}r.b+='<div class="tid_clear"></div>',r.b+="</div>",e.addClass("tid_active");var k=$(r.b);return e.parent().append(k),k.hide().slideDown(200),"_funtag"==i?k.find("a.tid_fun").click(function(){return a.insert($(this).attr("tid_s")),!1}):k.find("a.tid_smiley").click(function(){var e=$(this).find(".tid_max");return e.length>0&&0==Std.parseInt(e.html())?!1:(a.insert($(this).find("img").attr("tid_s")),!1)}),!1},""!=Main.k.Manager.replywaiting&&(e.find(".tid_wallPost").val(Main.k.Manager.replywaiting),Main.k.Manager.replywaiting="")})}},Main.k.Manager.customloaded=!1,Main.k.Manager.fillCustom=function(){if(Main.k.Manager.customloaded)""!=Main.k.Manager.replywaiting&&($("#tabcustom_content").find(".tid_wallPost").val(Main.k.Manager.replywaiting),Main.k.Manager.replywaiting="");else{var e=$("#tabcustom_content").empty();e.html("<div class='loading'><img src='http://twinoid.com/img/loading.gif' alt='Chargement' /> "+Main.k.text.gettext("Chargement…")+"</div>"),Main.k.LoadJS("/mod/wall/post",{_id:"tabcustom_content"},function(){Main.k.Manager.customloaded=!0;var e=$("#tabcustom_content");e.find(".tid_advanced").remove(),e.find(".tid_button").remove(),e.find(".tid_options").remove(),e.find(".tid_editorBut_question").remove(),e.find(".tid_editorBut__user").remove(),e.find("#tid_wallPost_preview").attr("id","").addClass("tid_wallPost_preview"),e.find("#tid_wallPost").attr("id","").addClass("tid_wallPost");var t=e.find(".tid_wallPost_preview").addClass("reply bubble");Main.k.Options.cbubbles&&t.addClass("bubble_"+Main.k.ownHero),Main.k.Options.cbubblesNB&&t.addClass("custombubbles_nobackground");var a=Main.k.ownHero.replace(/(\s)/g,"_").toLowerCase();$("<div>").addClass("char "+a).appendTo(t),$("<span>").addClass("buddy").html(Main.k.ownHero.capitalize()+" : ").appendTo(t),$("<p>").addClass("tid_preview tid_editorContent tid_wallPost_preview").appendTo(t),$("<div>").addClass("clear").appendTo(t);{var i=$("<div>").addClass("tid_buttons").appendTo(e);Main.k.MakeButton("<img src='http://twinoid.com/img/icons/reply.png' /> "+Main.k.text.gettext("Répondre au topic"),null,function(){var t=e.find(".tid_wallPost"),a=t.val(),i=Main.k.Manager.displayedTopic;Main.k.postMessage(i,a,Main.k.Manager.update),t.val(""),Main.k.Manager.waitingforupdate=!0,setTimeout(function(){Main.k.Manager.waitingforupdate&&Main.k.Manager.update()},5e3)}).css({display:"inline-block",margin:"4px 4px 8px"}).appendTo(i).find("a").attr("_title","Répondre").attr("_desc",Main.k.text.gettext("Envoyer ce message en tant que réponse au topic affiché ci-contre.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),Main.k.MakeButton("<img src='http://twinoid.com/img/icons/reply.png' /> "+Main.k.text.gettext("Nouveau topic"),null,function(){var t=e.find(".tid_wallPost"),a=t.val();Main.k.newTopic(a,Main.k.Manager.update),t.val("")}).css({display:"inline-block",margin:"4px 4px 8px"}).appendTo(i).find("a").attr("_title","Nouveau topic").attr("_desc",Main.k.text.gettext("Poster ce message en tant que nouveau topic.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),Main.k.MakeButton("<img src='http://mush.vg/img/icons/ui/fav.png' /> "+Main.k.text.gettext("Ajouter aux favoris"),null,function(){var t=e.find(".tid_wallPost"),a=t.val();Main.k.CreateNeronPrompt(),$("#validate").click(function(){var e=$("#neron_alert_content").find("input").val();Main.k.ClosePopup();try{Main.k.Manager.addMsgPrerecorded(e,a)}catch(t){"MessageAlreadyExist"==t.name?Main.k.CreateNeronAlert(Main.k.text.gettext("Le message existe déjà.")):"TitleEmpty"==t.name?Main.k.CreateNeronAlert(Main.k.text.gettext("Le titre est vide.")):"MessageEmpty"==t.name?Main.k.CreateNeronAlert(Main.k.text.gettext("Le message est vide.")):Main.k.debug&&Main.k.treatingBug(t)}})}).css({display:"inline-block",margin:"4px 4px 8px"}).appendTo(i).find("a").attr("_title","Ajouter aux favoris").attr("_desc",Main.k.text.gettext("Ajouter un message à votre liste des messages pré-enregistrés.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),Main.k.MakeButton("<img src='http://mush.vg/img/icons/ui/bin.png' /> "+Main.k.text.gettext("Supprimer un favori"),null,function(){try{var t=e.find(".array_messages_prerecorded .selected").text();Main.k.Manager.delMsgPrerecorded(t)}catch(a){"MessageNotExist"==a.name?Main.k.CreateNeronAlert(Main.k.text.gettext("Le message que vous voulez supprimer n'existe pas.")):Main.k.debug&&Main.k.treatingBug(a)}}).css({display:"inline-block",margin:"4px 4px 8px"}).appendTo(i).find("a").attr("_title","Supprimer un favori").attr("_desc",Main.k.text.gettext("Supprimer une message de votre liste des messges pré-enregistrés.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip)}"undefined"==typeof js.Lib.window.editor_tid_wallPost&&(js.Lib.window.editor_tid_wallPost={}),js.Lib.window.editor_tid_wallPost.preview=t,js.Lib.window.editor_tid_wallPost.loadSmileys=function(e){var t,a=this;if(this.initIcons(),this.smileysPanel.find(".tid_active").removeClass("tid_active").is(e))return this.hideSmileys(!0);this.hideSmileys(!1);var i=e.attr("tid_cat"),n=null;if("_funtag"!=i){for(var s=this.config.icons.iterator();s.hasNext();){var o=s.next();if(o.category==i){n=o;break}}if(null==n)return!1}var r=new StringBuf;if(r.b+='<div class="tid_smileyPopUp">',"_funtag"==i){r.b+=Std.string('<div class="tid_title">'+this.config.funTitle+"</div>");for(var l=[],p=this.config.fun.keys();p.hasNext();)t=p.next(),l.push(t);l.sort(function(e,t){return Reflect.compare(e,t)});for(var d=0;d<l.length;)t=l[d],++d,r.b+=Std.string('<a class="tid_fun" href="#" tid_s="'+StringTools.htmlEscape("{"+t+"}")+'"><img src="http://'+_tid.host+"/img/icons/"+this.config.fun.get(t).i+'.png" alt="'+t+'" title="'+StringTools.htmlEscape(this.config.fun.get(t).n)+'"/>'+StringTools.htmlEscape(this.config.fun.get(t).n)+"</a>")}else{r.b+=Std.string('<div class="tid_title">'+n.category+"</div>"),r.b+='<div class="tid_wrapper">';for(var c=n.icons.iterator();c.hasNext();){var u=c.next();if("Mush"==n.category){if("/ui/o2.png"==u.image)continue;if(":mush_pa_gen:"==u.tag)continue;if(":mush_pa_mov:"==u.tag)continue;if(":mush_planet:"==u.tag)continue;":mush_pa:"==u.tag?(u.tag=":pa:",u.image="/img/icons/ui/pa_slot1.png"):":mush_pm:"==u.tag?(u.tag=":pm:",u.image="/img/icons/ui/pa_slot2.png"):":mush_exp:"==u.tag&&(u.tag=":xp:",u.image="/img/icons/ui/xp.png")}var g=u.tag,m=u.tag;null!=u.alt&&(g=u.alt,m=u.alt+", "+u.tag);var h="";null!=u.max&&(h+='<span class="tid_max tid_max_'+u.tag.split(":").join("")+'">'+u.max+"</span>"),r.b+=Std.string('<a class="tid_smiley" href="#">'+h+'<img src="'+n.url+u.image+'" tid_s="'+StringTools.htmlEscape(g)+'" title="'+StringTools.htmlEscape(m)+'"/></a>')}r.b+="</div>"}r.b+='<div class="tid_clear"></div>',r.b+="</div>",e.addClass("tid_active");var k=$(r.b);return e.parent().append(k),k.hide().slideDown(200),"_funtag"==i?k.find("a.tid_fun").click(function(){return a.insert($(this).attr("tid_s")),!1}):k.find("a.tid_smiley").click(function(){var e=$(this).find(".tid_max");return e.length>0&&0==Std.parseInt(e.html())?!1:(a.insert($(this).find("img").attr("tid_s")),!1)}),!1};var n=$("<p>").addClass("array_messages_prerecorded").prependTo(e),s=[];void 0!=Main.k.Manager.msgs_prerecorded&&(s=Main.k.Manager.msgs_prerecorded);for(var o=0;o<s.length;o++)$("<span>"+s[o][0]+"</span>").addClass("message_prerecorded").appendTo(n).click(function(){if($(this).is(".selected"))e.find(".array_messages_prerecorded .selected").removeClass("selected"),e.find(".tid_wallPost").val("");else{e.find(".array_messages_prerecorded .selected").removeClass("selected"),$(this).addClass("selected");var t="";try{t=Main.k.Manager.getMsgPrerecorded($(this).text())}catch(a){Main.k.debug&&Main.k.treatingBug(a)}e.find(".tid_wallPost").val(t)}})}),""!=Main.k.Manager.replywaiting&&(e.find(".tid_wallPost").val(Main.k.Manager.replywaiting),Main.k.Manager.replywaiting="")}},Main.k.Manager.initHeroes=function(){Main.k.Manager.heroes.neron={name:"neron",mess:0,av:0,a:0};for(var e=0;e<Main.k.HEROES.length;e++)Main.k.Manager.heroes[Main.k.HEROES[e]]={name:Main.k.HEROES[e],mess:0,topic:0}},Main.k.Manager.waitingforupdate=!1,Main.k.Manager.update=function(){Main.k.Manager.waitingforupdate=!1,Main.k.Manager.initHeroes(),Main.k.Manager.parseWall($(".cdWallChannel")),Main.k.Manager.fillStats(),Main.k.Manager.fillNewFav(),Main.k.Manager.fillWall(),Main.k.Manager.fillSearch(),Main.k.Manager.fillReply(),Main.k.Manager.fillCustom(),Main.k.Manager.displayedTopic&&Main.k.Manager.displayTopic(Main.k.Manager.getTopicByTid(Main.k.Manager.displayedTopic).id)},Main.k.Manager.selectTopic=function(e){var t=Main.k.Manager.getTopicByTid(e).id;Main.k.Manager.displayTopic(t)},Main.k.Manager.msgs_prerecorded=[],Main.k.Manager.getMsgPrerecorded=function(e){var t=[];void 0!=this.msgs_prerecorded&&(t=this.msgs_prerecorded);for(var a=0;a<t.length;a++)if(e==t[a][0])return t[a][1];throw new this.Exception("MessageNotExist")},Main.k.Manager.addMsgPrerecorded=function(e,t){if(""==e||void 0==e)throw new this.Exception("TitleEmpty");if(""==t)throw new this.Exception("MessageEmpty");var a=[];void 0!=this.msgs_prerecorded&&(a=this.msgs_prerecorded);for(var i=0;i<a.length;i++)if(e==a[i][0])throw new this.Exception("MessageAlreadyExist");a.push([e,t]),this.msgs_prerecorded=a,this.saveMsgsPrerecorded(),this.customloaded=!1,this.fillCustom()},Main.k.Manager.delMsgPrerecorded=function(e){var t=[],a=!1;void 0!=this.msgs_prerecorded&&(t=this.msgs_prerecorded);for(var i=0;i<t.length;i++)e==t[i][0]&&(t.splice(i,1),a=!0);if(!a)throw new this.Exception("MessageNotExist");this.msgs_prerecorded=t,this.saveMsgsPrerecorded(),this.customloaded=!1,this.fillCustom()},Main.k.Manager.loadMsgsPrerecorded=function(e,t){var a;"undefined"!=typeof e?("undefined"==typeof t||t?(a=e,e=JSON.parse(e)):a=JSON.stringify(e),this.msgs_prerecorded=e,localStorage.setItem("ctrlw_msgs_prerecorded",a)):(a=localStorage.getItem("ctrlw_msgs_prerecorded"),null!=a&&(this.msgs_prerecorded=JSON.parse(a)))},Main.k.Manager.saveMsgsPrerecorded=function(){localStorage.setItem("ctrlw_msgs_prerecorded",JSON.stringify(Main.k.Manager.msgs_prerecorded)),callbacks_storage_sync.fire()},Main.k.Manager.Exception=function(e){this.name=e},Main.k.AliveHeroes=[],Main.k.MushInit=function(){console.log("MushInit");var e=js.Cookie.get("ctrlwsession"),t=js.Cookie.get("sid");"undefined"==typeof t&&(t=js.Cookie.get("mush_sid")),("undefined"==typeof e||t.hashCode()!=e)&&(Main.k.Sync.pull(),localStorage.removeItem("ctrlw_newgame")),js.Cookie.set("ctrlwsession",t.hashCode(),42e7),Main.k.Profiles.load(),Main.k.Manager.loadMsgsPrerecorded(),Main.k.AliveHeroes=[],Main.k.GameInfos.init();var a=$("#content");Main.k.Options.dlogo?(a.css({position:"absolute",top:"120px",left:"125px"}),a.find("[class^=logo]").css({top:"-100px"}),$("body").css("background-position","50% 20px")):(a.css({position:"absolute",top:"40px",left:"125px"}),a.find("[class^=logo]").css({display:"none"}));var i=$(".butmini.distr").css("display","none");i.length>0&&$("#vendingmenu").css("display","inline");var n=$("<div>").addClass("usLeftbar").insertBefore(a);Main.k.MakeButton("<img src='"+Main.k.servurl+"/img/ctrlw_sml.png' height='16' /> "+Main.k.version,null,Main.k.About.open,Main.k.text.gettext("à propos").capitalize(),Main.k.text.gettext("Cliquez ici pour plus d'informations sur le script.")).css({display:"inline-block",margin:"0 auto 10px"}).appendTo($("<div>").css("text-align","center").appendTo(n)),$(window).bind("beforeunload",function(e){return console.warn("beforeunload",Main.k.Sync.push_timer),null!=Main.k.Sync.push_timer?Main.k.text.gettext("CTRL+W : Veuillez attendre la fin de la synchronisation avant de quitter cette page."):void 0}),$("<h3>").addClass("first").html(Main.k.text.gettext("outils").capitalize()).appendTo(n),Main.k.MakeButton("<img src='http://twinoid.com/img/icons/new.png' /> "+Main.k.text.gettext("Mise à jour"),null,null,Main.k.text.gettext("Mise à jour du script"),"Une nouvelle version du script CTRL+W est disponible.").appendTo(n).attr("id","updatebtn").css("display","none").find("a").on("mousedown",Main.k.UpdateDialog),$(window).load(function(){setTimeout(function(){var e=$("#mushUSMenu");if(e.length>0){var t=e.parents(":eq(2)");t.css("left","-"+t.width()+"px");var a=t.find(".arrowright");a.attr("class","arrowleft"),a.off("click"),a.toggle(function(){t.animate({left:0},500)},function(){t.animate({left:"-"+t.width()+"px"},500)}),Main.k.MakeButton("<img src='http://mush.twinoid.com/img/icons/ui/talkie.png' style='vertical-align: -20%' /> MHS",null,null,"Mush Helper Script").insertAfter($("#updatebtn")).find("a").on("mousedown",function(){t.find(".arrowleft").trigger("click")})}if($("#astro_maj_inventaire").length>0){var i=$('<img class="" src="/img/icons/ui/pa_comp.png" height="14"/>'),n=$("#share-inventory-button");n.find("a img").remove(),n.find("a").prepend(i),i.addClass("blink-limited")}},10)}),Main.k.MakeButton("<img src='http://twinoid.com/img/icons/archive.png' style='vertical-align: -20%' /> "+Main.k.text.gettext("Msg Manager"),null,null,Main.k.text.gettext("Message Manager"),Main.k.text.gettext("Ne manquez plus de messages ! Tous les topics avec des messages non lus seront mis en évidence, et vous pourrez effectuer des recherches par auteur ou contenu.")).appendTo(n).find("a").on("mousedown",Main.k.Manager.open),Main.k.MakeButton("<img src='/img/icons/ui/pa_eng.png' style='vertical-align: -20%' /> "+Main.k.text.gettext("Options"),null,null,Main.k.text.gettext("Gérer les options"),Main.k.text.gettext("Certaines fonctionnalitées de Ctrl+W sont configurables. Cliquez ici pour spécifier vos préférences.")).appendTo(n).find("a").on("mousedown",Main.k.Options.open),Main.k.MakeButton("<img src='/img/icons/ui/comm.png' style='vertical-align: -20%' class=\"ctrlw_normal\"/><img src='http://imgup.motion-twin.com/twinoid/a/c/1d84a74e_4030.jpg' style='vertical-align: -20%;display:none' class=\"ctrlw_down\" /><img src='http://imgup.motion-twin.com/twinoid/8/f/0c596094_4030.jpg' style='vertical-align: -20%;display:none' class=\"ctrlw_up\" /> <img src='http://imgup.motion-twin.com/twinoid/3/a/830c06f5_4030.jpg' style='vertical-align: -20%;display:none' class=\"ctrlw_wheels\" /> <span class=\"txt\">"+Main.k.text.gettext("Sync")+'</span> <span class="counter"></span>',null,null,Main.k.text.gettext("Sync"),Main.k.text.gettext("Permet de synchroniser les données du script entre vos différents navigateurs")).attr("id","ctrlw_sync_button").appendTo(n).find("a").on("mousedown",Main.k.Sync.display),Main.k.MakeButton("<img src='http://twinoid.com/img/icons/refresh.png' style='vertical-align: -20%' /> "+Main.k.text.gettext("Actualiser"),null,null,Main.k.text.gettext("Actualiser"),Main.k.text.gettext("Actualiser la page sans tout recharger. <strong>Fonctionnalité en cours d'optimisation.</strong>")).appendTo(n).find("a").on("mousedown",function(){Main.refreshChat(),Main.acListMaintainer.refresh(!0),Main.syncInvOffset(null,!0),Main.doChatPacks(),Main.topChat(),Main.onChanDone(ChatType.Local[1],!0)}),Main.k.MakeButton(Main.k.text.gettext("Nouvelle partie ?"),null,null,Main.k.text.gettext("Nouvelle partie"),Main.k.text.gettext("Vous venez de commencer une nouvelle partie ? Utilisez ce bouton pour supprimer les informations de votre ancienne partie")).attr("id","button_new_game").appendTo(n).find("a").on("mousedown",function(){confirm(Main.k.text.gettext("Êtes vous sûr de vouloir effacer les informations de la partie précédente ?"))&&(localStorage.removeItem("ctrlw_newgame"),Main.k.Profiles.clear(),Main.k.GameInfos.clear(),Main.k.MushUpdate())}),$("<div>").attr("id","expblock").appendTo(n);var s=$('<h3 class="titles_title"></h3>').html(Main.k.text.gettext("titres").capitalize()).appendTo(n);$("<span>").addClass("displayless").attr("_target","#titles_list").appendTo(s).on("click",Main.k.ToggleDisplay),$("<div>").addClass("titles_list").attr("id","titles_list").appendTo(n),s=$("<h3>").html(Main.k.text.gettext("Présent(s)").capitalize()).appendTo(n),$("<span>").addClass("displaymore").attr("_target","#heroes_list").appendTo(s).on("click",Main.k.ToggleDisplay),$("<div>").attr("id","heroes_list").css("display","none").appendTo(n),s=$("<h3>").html(Main.k.text.gettext("équipage").capitalize()).appendTo(n),$("<span>").addClass("displayless").attr("_target","#crew_list").appendTo(s).on("click",Main.k.ToggleDisplay),$("<div>").attr("id","crew_list").css("display","block").appendTo(n),s=$("<h3>").html(Main.k.text.gettext("inventaire").capitalize()).appendTo(n),$("<span>").addClass("displaymore").attr("_target",".kobject_list").appendTo(s).on("click",Main.k.ToggleDisplay),$("<div>").addClass("inventory kobject_list").css("display","none").appendTo(n),$("<div>").css({clear:"both",height:"5px"}).appendTo(n),Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> "+Main.k.text.gettext("Partager"),null,null,Main.k.text.gettext("Partager l'inventaire"),Main.k.text.gettext("<p>Insère l'inventaire de la pièce dans la zone de texte active, de la forme&nbsp;:</p><p><strong>Couloir central :</strong> <i>Combinaison</i>, <i>Couteau</i>, <i>Médikit</i>, <i>Extincteur</i></p><p><strong>Partage aussi sur Astropad si celui-ci est installé.</strong></p>")).appendTo(n).attr("id","share-inventory-button").find("a").on("mousedown",function(e){return Main.k.SyncAstropad(e),$("textarea:focus").each(function(e){var t=Main.k.FormatInventory();$(this).insertAtCaret(t)}),!1}),Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> "+Main.k.text.gettext("Consommables"),null,null,Main.k.text.gettext("Partager les effets des consommables"),Main.k.text.gettext("Insère la liste des consommables avec leurs effets dans la zone de texte active, de la forme&nbsp;:</p><p>TODO: aperçu</p>")).attr("id","pharmashare").css("display","none").appendTo(n).find("a").on("mousedown",function(e){return $("textarea:focus").each(function(e){var t=Main.k.FormatPharma();$(this).insertAtCaret(t)}),!1});var o=$(".spaceshipstatus li");o.first().attr("onmouseover",o.first().attr("onmouseover").replace(/\(o²\)\s+/g,"")),$("<div>").attr("id","project_list").appendTo(n)},Main.k.MushAfterInit=function(){console.info("Main.k.MushAfterInit",$().jquery),Main.k.Resize(),$(window).resize(Main.k.Resize),$("#chatBlock").on("resize",Main.k.Resize)},Main.k.MushUpdate=function(){console.log("mushupdate"),Main.k.MushInitHeroes(),$("#swf_ISO_MODULE").off("mousedown"),$("#swf_ISO_MODULE").on("mousedown",function(){$(".kobject_list .selected").remove(),$("#cdInventory").is(".placard_on")&&Main.closet.hide()});var e=$("#wall").find(".chatbox");e.off("focus"),e.on("focus",function(){Main.k.extend.onChatFocus($(this),$(this).attr("id").replace(/[^0-9]+/,""))});var t=$(".cdReplyBlock .chatbox");t.off("focus"),t.on("focus",Main.k.extend.onWallFocus),t.off("keydown input"),t.removeAttr("onkeydown"),t.on("keydown",Main.k.extend.onWallInput),t.on("input",function(){Tools.send2Store("mush_wallReply_"+$(this).attr("id"),$(this).val())});var a=$("#privateform .chatbox, #wall .chatbox");a.off("keydown input"),a.removeAttr("onkeydown"),a.on("keydown",Main.k.extend.onChatInput),a.on("input",function(){Tools.send2Store("mush_chatContent_"+$(this).attr("id"),$(this).val())});var i=$("#chatBlock");i.off("scroll"),i.on("scroll",Main.k.extend.onChatScroll);var n,s,o,r,l,p=$(".usLeftbar");Main.k.hasTalkie=$("#walltab").length>0,$("table.treereply tr.not_read.cdRepl").css("display","table-row");var d=$(".cycletime");if(d.length>0){var c=new RegExp("\\D+([0-9]{1,2}).*-.*([0-9]{1})"),u=c.exec(d.text());null!=u&&Main.k.Game.updateDayAndCycle(u[1],u[2])}Main.k.UpdateCheck();var g=$("#player_status");0==g.length&&(g=$('<div id="player_status" style="position: absolute;right:6px;bottom:0"><img src="'+Main.k.statusImages.bronze+'" alt="Bronze" title="Bronze" /></div>').appendTo(".sheetmain")),g.html('<img src="'+Main.k.statusImages[Main.k.Game.data.player_status]+'" alt="'+Main.k.Game.data.player_status.capitalize()+'" title="'+Main.k.Game.data.player_status.capitalize()+'" />'),Main.k.Game.displayRemainingCyclesToNextLevel();var m,h=4,k=$("#titles_list");k.empty();var f=$("<div>").appendTo(k);$("<img>").addClass("icon").attr("src","/img/icons/ui/title_01.png").attr("_title",Main.k.text.gettext("Commandant")).attr("_desc",Main.k.text.gettext("Le Commandant décide des planètes que le Daedalus explorera.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(f);var M=0;for(r=0;h>M&&r<Main.k.COMMANDERS.length;r++)n=Main.k.COMMANDERS[r],-1!=$.inArray(n,Main.k.HEROES)&&(m=Main.k.Profiles.get(n),Main.k.Profiles.hasStatusWhichRemoveTitle(m)||(M++,$("<img>").addClass("body "+n).attr("src","/img/design/pixel.gif").css("cursor","pointer").data("dev_surname",n).on("click",function(){Main.k.Profiles.display($(this).data("dev_surname"))}).appendTo(f)));var x=$("<div>").appendTo(k);$("<img>").addClass("icon").attr("src","/img/icons/ui/title_02.png").attr("_title",Main.k.text.gettext("Administrateur NERON")).attr("_desc",Main.k.text.gettext("Le responsable NERON semble avoir une certaine influence auprès de l'ordinateur de bord. Il est notamment le seul à avoir la possibilité de transmettre des messages à tout l'équipage.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(x);var v=0;for(r=0;h>v&&r<Main.k.ADMINS.length;r++)n=Main.k.ADMINS[r],-1!=$.inArray(n,Main.k.HEROES)&&(m=Main.k.Profiles.get(n),Main.k.Profiles.hasStatusWhichRemoveTitle(m)||(v++,$("<img>").addClass("body "+n).attr("src","/img/design/pixel.gif").css("cursor","pointer").data("dev_surname",n).on("click",function(){Main.k.Profiles.display($(this).data("dev_surname"))}).appendTo(x)));var b=$("<div>").appendTo(k);$("<img>").addClass("icon").attr("src","/img/icons/ui/title_03.png").attr("_title",Main.k.text.gettext("Responsable de Communications")).attr("_desc",Main.k.text.gettext("Le Responsable de Communications est la seule personne habilitée à décider quels seront les téléchargements prioritaires du Centre de Communication.")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(b);var _=0;for(r=0;h>_&&r<Main.k.COMMS.length;r++)n=Main.k.COMMS[r],-1!=$.inArray(n,Main.k.HEROES)&&(m=Main.k.Profiles.get(n),Main.k.Profiles.hasStatusWhichRemoveTitle(m)||(_++,$("<img>").addClass("body "+n).attr("src","/img/design/pixel.gif").css("cursor","pointer").data("dev_surname",n).on("click",function(){Main.k.Profiles.display($(this).data("dev_surname"))}).appendTo(b)));for(var y=$("#heroes_list").empty(),w=Main.heroes.iterator();w.hasNext();){n=w.next();var T=!1;s=n.dev_surname;var C=$('<a href="#"><img src="/img/icons/ui/awake.png" /></a>').css({"font-size":0,position:"absolute",right:0,bottom:0}).attr("_title",Main.k.text.gettext("Espionnage")).attr("_desc",Main.k.text.gettext("<p>Vous êtes dans la même pièce que cette personne ; vous pouvez donc l'examiner de plus près.</p><p><strong>Cliquez ici pour enregistrer les compétences visibles, statuts publiques et titres de ce personnage.</strong></p>")).data("dev_surname",s).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).click(function(e){e.preventDefault();var t=$(this).data("dev_surname");Main.k.Profiles.set(t),Main.k.Profiles.display(t)}),P=$("<div>").addClass("icons statuses");if(n.statuses)for(var S=n.statuses.iterator();S.hasNext();){T=!0;var j=S.next();$("<img>").attr("src","/img/icons/ui/status/"+j.img+".png").attr("height","14").attr("alt",j.img).attr("_title",j.name).attr("_desc",j.desc).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(P)}if(n.spores){var I=$("<div>").css({position:"relative",display:"inline-block","margin-left":"2px",top:"2px"}).appendTo(P);$("<img>").attr("src","/img/icons/ui/spore.png").attr("height","16").attr("alt",n.spores.name).attr("_title",n.spores.name).attr("_desc",n.spores.desc).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(I),$("<span>").text(n.spores.nb).css({"font-size":"10px",position:"absolute",left:"4px",top:"3px",opacity:.7,"pointer-events":"none"}).appendTo(I)}var E=$("<div>").addClass("icons skills");if(n.skills)for(var F=n.skills.iterator();F.hasNext();){T=!0;var O=F.next(),z=$("<span>").addClass("skill").appendTo(E);$("<img>").attr("src","/img/icons/skills/"+O.img+".png").attr("height","19").attr("alt",O.img).attr("_title",O.name).attr("_desc",O.desc+(Main.k.compInactiveMush[O.img]?"<p><strong>"+Main.k.text.gettext("Compétence inactive mush")+"</strong></p>":"")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(z),Main.k.compInactiveMush[O.img]&&$("<img>").attr("src",Main.k.servurl_badconker+"/img/non-mush.png").addClass("actmush").attr("width","10").attr("height","10").attr("_title",Main.k.text.gettext("Compétence inactive mush")).attr("_desc",Main.k.text.gettext("Cette compétence est inactive quand on est mush (source : Twinpedia).")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(z)}var A=$("<div>").addClass("titles");if(n.titles)for(var N=n.titles.iterator();N.hasNext();){var R=N.next();$("<img>").attr("src","/img/icons/ui/"+R.img+".png").attr("alt",R.img).attr("_title",R.name).attr("_desc",R.desc).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(A)}var B=$("<div>").addClass("hero").appendTo(y);$("<img>").addClass("body "+s).attr("src","/img/design/pixel.gif").css("cursor","pointer").attr("data-dev_surname",n.dev_surname).addHeroDescToolTip(n.dev_surname).on("click",function(){
console.warn($(this).attr("data-dev_surname")),Main.k.Profiles.display($(this).attr("data-dev_surname"))}).appendTo(B),B.append(E),B.append(P),B.append(A),B.append(C)}var L=$("#crew_list").empty(),D=$("<div>").addClass("missingheroes").appendTo(L);l=0;var G,q,H={alive:[],inactive:[],dead:[]};for(r=0;r<Main.k.HEROES.length;r++){q=null;var n=Main.k.HEROES[r];if(n!=Main.k.ownHero){{Main.k.h[n]}if(l%5==0&&$("<br/>").appendTo(D),l++,s=n.replace(/(\s)/g,"_").toLowerCase(),m=Main.k.Profiles.get(n),G=$("<div>").css({display:"inline-block",position:"relative"}).append($("<img>").addClass("body "+s).attr("src","/img/design/pixel.gif").css("cursor","pointer").addHeroDescToolTip(n).data("dev_surname",n).on("click",function(){Main.k.Profiles.display($(this).data("dev_surname"))})),1==m.dead)H.dead.push(G),$("<img>").attr({src:"/img/icons/ui/dead.png"}).css({position:"absolute",bottom:"-6px",right:"-2px","pointer-events":"none"}).appendTo(G);else{Main.k.Profiles.hasAttr(m,"statuses",Main.k.statuses.mush.img)&&$("<img>").attr({src:"/img/icons/ui/mush.png"}).css({position:"absolute",bottom:"-6px",right:"-2px","pointer-events":"none"}).appendTo(G);for(var W=0;W<m.statuses.length;W++)j=m.statuses[W],j.img&&-1!=$.inArray(j.img,["sleepy","noob"])&&(q=j.img);null!=q?(H.inactive.push(G),$("<img>").attr({src:"/img/icons/ui/"+q+".png"}).css({position:"absolute",bottom:"-6px",right:"-2px","pointer-events":"none"}).appendTo(G)):H.alive.push(G)}}}$.each(H,function(e,t){$.each(t,function(e,t){D.append(t)})});var U=$(".what_happened .table").first();U.length>0&&0==U.find(".ctrlw-save-cryo").length&&(U.find("tr").last().after('<tr><td colspan="2" class="ctrlw-save-cryo" style="font-style:normal"></td></tr>'),U.find(':contains("'+Main.k.text.gettext("Cryo")+'")').length>0?U.find(".ctrlw-save-cryo").append(Main.k.text.gettext("Tout le monde doit être décryogénisé pour pouvoir mettre à jour la liste d'équipage")):Main.k.MakeButton("<img src='/img/icons/ui/notes.gif' /> "+Main.k.text.gettext("Mettre à jour la liste d'équipage"),null,null,Main.k.text.gettext("Mettre à jour la liste d'équipage"),Main.k.text.gettext("Cliquer ici pour mettre à jour la liste d'équipage de CTRL+W")).appendTo(U.find(".ctrlw-save-cryo")).find("a").on("mousedown",function(e){var t,a,i,n,s=[],o={inactive:Main.k.text.gettext("Inactive"),awake:Main.k.text.gettext("Eveillée?"),dead:Main.k.text.gettext("Morte?")};return console.info("status_to_str",o),U.find("tr").each(function(){if(t=$(this).find("td"),2==t.length){if(i=null,a=Main.k.surnameToBubble(t.first().text().trim()),$.each(o,function(e,a){a=new RegExp(a),null!=a.exec(t.last().text().trim())&&(i=e)}),null==i)return console.error("Statut inconnu :",t.last().text().trim()),!0;console.log(a,i),s.push(a),profile=Main.k.Profiles.get(a),"inactive"==i?(n=!0,$.each(profile.statuses,function(e,t){return"sleepy"==t.img?(n=!1,!1):void 0}),n&&profile.statuses.push(Main.k.statuses.inactive),profile.dead=!1):"awake"==i?(profile.dead=!1,$.each(profile.statuses,function(e,t){return"sleepy"==t.img?(console.log("is sleepy"),profile=Main.k.Profiles.removeAttrFromProfile(profile,"statuses",Main.k.statuses.inactive.img),profile=Main.k.Profiles.removeAttrFromProfile(profile,"statuses",Main.k.statuses.hinactive.img),!1):void 0})):"dead"==i&&(profile.dead=!0),Main.k.Profiles.set(profile,!1)}}),Main.k.GameInfos.data.heroes_list=s,Main.k.GameInfos.save(),Main.k.Profiles.save(),Main.k.MushUpdate(),!1}));var J=$(".exploring .exploring2");if($("#expblock").empty(),J.length>0){o=$("<h3>").html("Exploration").appendTo("#expblock"),$("<span>").addClass("displayless").attr("_target","#expblockdiv").appendTo(o).on("click",Main.k.ToggleDisplay);var V=$("<div>").attr("id","expblockdiv").appendTo("#expblock");r=0;J.find("li").each(function(){var e=$(this).clone();e.find("span").remove();var t="";switch(r){case 1:for(var a=$("<div>").addClass("missingheroes").appendTo(V),i=e.html().split(","),n=0;n<i.length;n++){var s=i[n].trim(),o=s.replace(/(\s)/g,"_").toLowerCase(),l=Main.k.h[o];$("<img>").addClass("body "+o).attr("src","/img/design/pixel.gif").attr("_title",s).attr("_desc",l.short_desc).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip).appendTo(a)}break;case 0:t="planet";case 2:""==t&&(t="casio"),$("<p>").css({color:"#DDD","font-size":"12px",margin:"-6px 0 0","text-align":"center"}).html("<img src='/img/icons/ui/"+t+".png' /> "+e.html().trim()).appendTo(V).find("img").css({position:"relative",top:"4px"})}r++})}var Q=!1,K=!1,X=120;$(".kobject_list").empty();var Z=$("#room");Z.find("[data-id='TREE_POT']").size()&&(Q=!0),Z.find("li").not(".cdEmptySlot").not("[data-id='TREE_POT']").each(function(){var e=$(this),t=$("<li>").addClass("item fakeitem").attr("serial_fake",$(this).attr("serial")).attr("data-name",$(this).attr("data-name")).attr("data-id","TREE_POT").css("list-style-type","none").html($(this).html()).on("click",function(){$("#cdInventory").hasClass("placard_on")||Main.closet.show(),$(this).siblings().find(".selected").remove(),$(this).prepend('<div class="selected"></div>'),mush_jquery('[serial="'+e.attr("serial")+'"]').trigger("click")}).appendTo(".kobject_list").find("td").attr("_title",$(this).attr("data-name").split("\\'").join("'")).attr("_desc",$(this).attr("data-desc").split("\\'").join("'")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip),a=$(this).attr("data-name"),i=/\/>x([0-9]+)$/;if(i.test(a)){var n=i.exec(a)[1];$("<span>").addClass("charges").html("x"+n).appendTo(t.find("tr"))}var s="/img/icons/ui/broken.png";a.indexOf(s)>-1&&$("<img>").attr("src",s).addClass("broken").appendTo(t.find("tr")),(-1!=$(this).attr("data-desc").indexOf("Effets")||"CONSUMABLE"==$(this).data("id"))&&(K=!0)}),$(".usLeftbar .inventory").css("max-width",X+"px").css("margin-left","0px"),$("#pharmashare").css("display",K?"block":"none");var Y,ee=$("#project_list").empty(),te=$("#cdModuleContent"),ae=te.find("ul.dev li.cdProjCard"),ie=$("#research_module"),ne=new RegExp(Main.k.text.gettext("Coeur de NERON"),"i");if(ie.length>0&&ae.length>0){o=$("<h3>").html(Main.k.text.gettext("Laboratoire")).appendTo(ee),$("<span>").addClass("displayless").attr("_target","#projectspreview").on("click",Main.k.ToggleDisplay).appendTo(o),Y=$("<div>").addClass("projectspreview labpreview").attr("id","projectspreview").appendTo(ee),ae.each(function(e){var t=$("<div>").addClass("projectpreview").appendTo(Y);$("<img>").addClass("projectimg").attr("src",$(this).find("img.devcard").attr("src")).appendTo(t),$("<div>").addClass("projectpct").html($(this).find("span").html().trim()).appendTo(t);var a=$("<div>").addClass("projectbonus").appendTo(t);$(this).find("div.suggestprogress ul li img").each(function(e){$(this).clone().appendTo(a)});var i=$(this).find("h3").clone();i.find("em").remove(),t.attr("_title",i.html().trim()).attr("_desc",$(this).find("div.desc").html().trim()+"</p><p>"+$(this).find("p.efficacity").html().trim()).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip)}),Main.k.MakeButton("<img src='/img/icons/ui/guide.png' /> "+Main.k.text.gettext("Partager"),null,null,Main.k.text.gettext("Partager les recherches"),Main.k.text.gettext("<p>Insère la liste de recherches dans la zone de texte active, de la forme&nbsp;:</p><p><li><strong>Nom de la recherche</strong> - 0%<br/>Description de la recherche<br/>Bonus : <i>Biologiste</i>, <i>Médecin</i></li><li><strong>Nom de la recherche</strong> - 0%<br/>Description de la recherche<br/>Bonus : <i>Biologiste</i>, <i>Médecin</i></li><li><strong>Nom de la recherche</strong> - 0%<br/>Description de la recherche<br/>Bonus : <i>Biologiste</i>, <i>Médecin</i></li></p>")).appendTo(ee).find("a").addClass("shareresearchbtn").on("mousedown",function(e){return $("textarea:focus").each(function(e){var t=Main.k.FormatResearch();$(this).insertAtCaret(t)}),!1}),Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> "+Main.k.text.gettext("Partager v2"),null,null,Main.k.text.gettext("Partager les recherches"),Main.k.text.gettext("<p>Insère la liste de recherches dans la zone de texte active, de la forme&nbsp;:</p><p><li><strong>Nom de la recherche</strong> - 0%</li><li><strong>Nom de la recherche</strong> - 0%</li><li><strong>Nom de la recherche</strong> - 0%</li></p>")).appendTo(ee).find("a").addClass("shareresearchbtn").on("mousedown",function(e){return $("textarea:focus").each(function(e){var t=Main.k.FormatResearch(!0);$(this).insertAtCaret(t)}),!1});var se=$(".cdActionList"),oe=$(".cdActionRepository .heroRoomActions").children().clone();se.html(oe),$(".cdActionList .move").hide(),mush_jquery("#char_col #myInventory > li").removeAttr("onclick"),$("#char_col #myInventory > li").on("click",function(){Main.k.CreateNeronAlert(Main.k.text.gettext("Veuillez utiliser l'inventaire du labo s'il vous plaît"))}),ie.find(" ul.inventory li.item").off("click"),ie.find(" ul.inventory li.item").on("click",function(){console.log("select",$(this)),a=$(this).attr("serial");$("[serial='"+a+"']");console.log("avant cookie"),js.Cookie.set(CrossConsts.COOK_SEL,StringTools.urlEncode(a),3600),console.log("apres cookie");if(t=$(this),t.hasClass("fakeselected"))return t.removeClass("fakeselected"),$("#cdActionList div").not(".move").remove(),$("#myInventory .selected").parent().removeClass("on"),$("#myInventory .selected").remove(),void(Main.sel.currentInvSelection=null);t.addClass("on"),console.warn("realJMe",t);$("#myInventory .item").not(".cdEmptySlot").add("[serverselected=true]");$(".cdCharColSel").remove(),$("#myInventory .selected").parent().removeClass("on"),$("#myInventory .selected").remove(),$("#myInventory .fakeselected").removeClass("fakeselected"),t.addClass("fakeselected");var e=$("<div>").prependTo(t).addClass("selected");console.log("selected_parent",e.parent());var t=$("[data-tip='"+t.attr("data-tip")+"']").not("[serial='"+a+"']");console.warn("realJMe",t);var a=t.attr("serial");Main.sel.currentInvSelection=null,console.warn(1,$("#myInventory .selected")),console.warn(2,$("#myInventory .selected")),Main.acListMaintainer.heroWorking=!0,Main.sel.currentInvSelection=a,Main.acListMaintainer.heroWorking=!0,Main.acListMaintainer.refreshHeroInv(),console.warn($("#myInventory .selected"));var i=$("div[webdata='"+a+"']");console.log("actions",i),$("#cdActionList").find("div").hide(),i.each(function(){$(this).clone().appendTo("#cdActionList")}),$("<div class='action stSel'> "+t.attr("data-name").split("\\'").join("'")+" :</div>").prependTo("#cdActionList")})}else if(ae.length>0&&ne.test(te.find("h2").html().trim()))o=$("<h3>").html("Projets Neron").appendTo(ee),$("<span>").addClass("displayless").attr("_target","#projectspreview").on("click",Main.k.ToggleDisplay).appendTo(o),Y=$("<div>").addClass("projectspreview").attr("id","projectspreview").appendTo(ee),ae.each(function(e){var t=$("<div>").addClass("projectpreview").appendTo(Y);$("<img>").addClass("projectimg").attr("src",$(this).find("img").attr("src")).appendTo(t),$("<div>").addClass("projectpct").html($(this).find("span").html().trim()).appendTo(t);var a=$("<div>").addClass("projectbonus").appendTo(t);$(this).find("div.suggestprogress ul li img").each(function(e){$(this).clone().appendTo(a)}),t.attr("_title",$(this).find("h3").html().trim()).attr("_desc",$(this).find("div.desc").html().trim()+"</p><p>"+$(this).find("p.efficacity").html().trim()).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip)}),Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> "+Main.k.text.gettext("Partager"),null,null,Main.k.text.gettext("Partager les projets"),Main.k.text.gettext("<p>Insère la liste de projets dans la zone de texte active, de la forme&nbsp;:</p><p><li><strong>Nom du projet</strong> - 0%<br/>Description du projet<br/>Bonus : <i>Tireur</i>, <i>Pilote</i></li><li><strong>Nom du projet</strong> - 0%<br/>Description du projet<br/>Bonus : <i>Tireur</i>, <i>Pilote</i></li><li><strong>Nom du projet</strong> - 0%<br/>Description du projet<br/>Bonus : <i>Tireur</i>, <i>Pilote</i></li></p>")).appendTo(ee).find("a").addClass("shareprojectbtn").on("mousedown",function(e){return $("textarea:focus").each(function(e){var t=Main.k.FormatProjects();$(this).insertAtCaret(t)}),!1});else if($("#navModule").length>0){var re=$("#navModule"),le=re.find(".planet").not(".planetoff");le.length>0&&(o=$("<h3>").html(Main.k.text.gettext("Planètes")).appendTo(ee),$("<span>").addClass("displayless").attr("_target","#projectspreview").on("click",Main.k.ToggleDisplay).appendTo(o),Y=$("<div>").addClass("projectspreview planetpreview").attr("id","projectspreview").appendTo(ee),le.each(function(e){var t=$("<div>").addClass("planetpreview").appendTo(Y);if($("<img>").attr("width","40").attr("src",$(this).find("img.previmg").attr("src")).css({cursor:"pointer"}).on("mousedown",function(t){return $("textarea:focus").each(function(t){var a=Main.k.FormatPlanets(e);$(this).insertAtCaret(a)}),!1}).appendTo(t),0==$(this).find(".share-planet").length){var a=Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> ",null,null,Main.k.text.gettext("Partager la planète"),Main.k.text.gettext("Partage uniquement cette planète dans l'inventaire")).addClass("share-planet");a.find("a").on("mousedown",function(t){return $("textarea:focus").each(function(t){var a=Main.k.FormatPlanets(e);$(this).insertAtCaret(a)}),!1}),$("<td>").append(a).insertAfter($(this).find(".buttons td:last-child"))}}),Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> "+Main.k.text.gettext("Partager"),null,null,Main.k.text.gettext("Partager les planètes"),Main.k.text.gettext("Insère la liste de planètes dans la zone de texte active, de la forme&nbsp;:</p><p>TODO: aperçu")).appendTo(ee).find("a").on("mousedown",function(e){return $("textarea:focus").each(function(e){var t=Main.k.FormatPlanets(null);$(this).insertAtCaret(t)}),!1}))}else if($("#biosModule").length>0)$("<h3>").html("BIOS NERON").appendTo(ee),Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> "+Main.k.text.gettext("Partager"),null,null,Main.k.text.gettext("Partager les paramètres"),Main.k.text.gettext("Insère la liste de paramètres BIOS Neron dans la zone de texte active, de la forme&nbsp;:</p><p>TODO: aperçu")).appendTo(ee).find("a").on("mousedown",function(e){return $("textarea:focus").each(function(e){var t=Main.k.FormatBIOS();$(this).insertAtCaret(t)}),!1});else if($("#trackerModule").length>0){var o=$("<h3>").html(Main.k.text.gettext("Com.")).appendTo(ee);$("<span>").addClass("displayless").attr("_target",".commPreview").on("click",Main.k.ToggleDisplay).appendTo(o);var re=$("#trackerModule"),pe=$("<div>").addClass("commPreview").css({"text-align":"center",cursor:"pointer"}).appendTo(ee),de=$("<img>").attr("src","/img/design/sensor01.png").on("mousedown",function(e){return $("textarea:focus").each(function(e){var t=Main.k.FormatComm();$(this).insertAtCaret(t)}),!1}).appendTo(pe);setInterval(function(){de.attr("src",$("#trackerModule").find(".sensors img").attr("src"))},100),Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> "+Main.k.text.gettext("Partager"),null,null,null,"TODO: aperçu").appendTo(ee).find("a").on("mousedown",function(e){return $("textarea:focus").each(function(e){var t=Main.k.FormatComm();$(this).insertAtCaret(t)}),!1})}if(p.find("#plantmanager").remove(),Q){var ce=$("<div>").attr("id","plantmanager").appendTo(p);o=$("<h3>").html(Main.k.text.gettext("Plantes")).appendTo(ce),$("<span>").addClass("displayless").attr("_target",".kplantlist").appendTo(o).on("click",Main.k.ToggleDisplay);var ue=$("<div>").addClass("kplantlist plants inventory").css("max-width",X+"px").appendTo(ce);Z.find("[data-id='TREE_POT']").each(function(){var e=$(this);$("<li>").addClass("item fakeitem").attr("serial_fake",$(this).attr("serial")).attr("data-name",$(this).attr("data-name")).attr("data-id","TREE_POT").css("list-style-type","none").html($(this).html()).on("click",function(){$("#cdInventory").hasClass("placard_on")||Main.closet.show(),mush_jquery('[serial="'+e.attr("serial")+'"]').trigger("click")}).appendTo(ue).find("td").attr("_title",$(this).attr("data-name").split("\\'").join("'")).attr("_desc",$(this).attr("data-desc").split("\\'").join("'")).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip)}),$("<div>").css("clear","both").css("height","5px").appendTo(ce),Main.k.MakeButton("<img src='/img/icons/ui/talk.gif' /> "+Main.k.text.gettext("Partager"),null,null,Main.k.text.gettext("Plantes"),Main.k.text.gettext("Partager l'état des plantes.")).appendTo(ce).find("a").on("mousedown",function(e){return $("textarea:focus").each(function(e){var t=Main.k.FormatPlants();$(this).insertAtCaret(t)}),!1})}var ge=$("#topinfo_bar"),me=ge.find(".alarm");if(me.length>0){me.find(".alertnb").remove();var he="/img/icons/ui/alert.png",ke="/img/icons/ui/door.png",fe="/img/icons/ui/hunter.png",Me="/img/icons/ui/fire.png";me.find("img").each(function(){var e=$(this).attr("src").toLowerCase(),t=0,a=$(this).parent().attr("onmouseover");switch(e){case he:t=parseInt(/>([0-9]+)/.exec(a)[1]);break;case ke:t=parseInt(/>([0-9]+)/i.exec(a)[1]);break;case fe:var i=new RegExp(Main.k.text.gettext("([0-9]+|un|a)+ appareil"),"i");i.test(a)?t=i.exec(a)[1]:/>([0-9]+|un|a)/i.test(a)&&(t=/>([0-9]+|un|a)/i.exec(a)[1]),t&&(t="un"==t.toLowerCase()||"a"==t.toLowerCase()?1:parseInt(t));break;case Me:t=parseInt(/>([0-9]+)/i.exec(a)[1])}if(0!=t){$(this).css({position:"relative","z-index":"5"}),$(this).parent().css("position","relative");var n=$("<div>").addClass("alertnbwrapper").css("left",parseInt(($(this).parent().width()-20)/2)+"px").appendTo($(this).parent());$("<div>").addClass("alertnb").html(t).appendTo(n)}}),ge.find(".alarm_on").css("background-image","url("+Main.k.servurl+"/img/alertpleft.gif)"),ge.find(".alarm_right_on").css("background-image","url("+Main.k.servurl+"/img/alertpright.gif)"),ge.find(".alarm_bg_on").css("background-image","url("+Main.k.servurl+"/img/alertbg.gif)")}var xe=ge.find(".spaceshipstatus");for(xe.length>0&&(xe.find(".spaceshipstatus-info").remove(),xe.find("img").each(function(){var e=/\/([a-z]+)\.png$/,t=e.exec($(this).attr("src"));if(null!=t)switch(t[1]){case"shield":if(/: *[0-9]+<br\/>.+: *([0-9]+)<br\/>/.test($(this).parent().attr("onmouseover"))){$('<div class="spaceshipstatus-info" style="font-size:10px;text-align:center;">'+RegExp.$1+'&nbsp;<img src="http://'+Main.k.domain+'/img/icons/ui/plasma.png" width="11"></div>').appendTo($(this).parent())}}})),r=0;3>r;r++){var ve=$("#cdTabsChat").find(".cdPrivateTab"+r),be=$("#cdPrivate"+r);if(ve.length>0&&be.length>0){var _e="",$e=be.find(".mini_priv");for(l=0;l<$e.length;l++){var ye=$($e[l]).attr("onmouseover"),we=/<h1>([^<]+)<\/h1>/.exec(ye)[1],Te=/[a-zA-Z]+\s?:\s([^<]+)/.exec(ye)[1].toLowerCase();_e+="<strong>"+we+"</strong> - "+Main.k.text.gettext("connecté(e)")+" "+Te+"<br/>"}ve.find("img").off("mouseover").off("mouseout").attr("_title",Main.k.text.gettext("Canal privé")+" #"+(r+1)).attr("_desc",_e).on("mouseover",Main.k.CustomTip).on("mouseout",Main.k.hideTip)}}Main.k.Manager.opened&&Main.k.Manager.update(),Main.k.Profiles.update(),Main.k.updateBottom(),Main.k.customBubbles(),$("#cdPaBloc").find("img[src='/img/design/pa1bis.png']").attr("src",Main.k.servurl+"/img/pa1bis.png"),Main.k.Resize();var Ce=js.Cookie.get("lastsentmsg");Ce&&Main.k.displayLastSent(!0)},exportFunction(Main.k.MushUpdate,unsafeWindow.Main.k,{defineAs:"MushUpdate"}),Main.k.MushInitHeroes=function(){Main.k.heroes={},Main.k.heroes_same_room=[];for(var e=Main.heroes.iterator(),t=jQuery.extend([],Main.k.HEROES),a=[];e.hasNext();)!function(){var i=e.next();a.push(Main.k.surnameToBubble(i.surname)),t=jQuery.grep(t,function(e){return e!=Main.k.surnameToBubble(i.surname)})}();if(Main.k.heroes_same_room=a,Main.k.HEROES_ALL.length==Main.k.HEROES.length){var i=["andie","derek"];Main.k.GameInfos.data.heroes_list.length>0?Main.k.HEROES=Main.k.GameInfos.data.heroes_list:($(".groupConf").length>0&&0==$('.groupConf img[src*="use_andrek"]').length&&(i=["finola","chao"]),$.each(Main.k.HEROES.replace,function(e,t){var a;a=$("."+e).length>0||-1!=$.inArray(e,i)?$.inArray(t,Main.k.HEROES):$.inArray(e,Main.k.HEROES),Main.k.HEROES.splice(a,1)}))}},Main.k.MushInit(),Main.k.MushUpdate(),Main.k.MushAfterInit(),$(document).keypress(function(e){27===e.keyCode&&Main.k.ClosePopup()})},Main.k.tabs.ranking=function(){Main.k.SwitchRankingTab=function(e){var t=$(e.target).attr("id");switch($("div.bgtablesummar").addClass("hide"),$("ul.tablefilter li").addClass("off"),$(e.target).removeClass("off"),t){case"cdTabFriends":$("div.cdFriends").removeClass("hide");break;case"cdTabContacts":$("div.cdContacts").removeClass("hide");break;case"cdTabAll":$("div.cdGlobal").removeClass("hide")}},$("<style>").attr("type","text/css").html("	span.rankhead {		display: block;		position: absolute;		top: 30px; left: 250px;		bottom: 30px; right: 10px;		font-size: 24pt;		color: #FFF;		text-align: left;		font-family: 'PT Sans Caption','Arial','Segoe UI','Lucida Grande','Trebuchet MS','lucida sans unicode',sans-serif;		text-shadow: -1px 0px 2px rgba(0, 0, 0, 0.3), 0px 1px 2px rgba(0, 0, 0, 0.3), 1px 0px 2px rgba(0, 0, 0, 0.3);		text-transform: uppercase;	}	").appendTo($("head"));var e=$("#category_triumph, #category_nova");e.css({margin:"0",width:"50%","float":"left",display:"block"}),$("th").each(function(){var e=$(this).html().trim();"Héros Favori"==e&&$(this).html("")}),$("ul.tablefilter").first().clone().css({"float":"right",width:"auto"}).prependTo("#ranking").find("li").attr("onclick","").on("click",Main.k.SwitchRankingTab),e.find(".tablefilter, .clear").remove(),$("#ranking").find("th.distinctions").css("width","auto"),$(".bgtablesummar").css("margin","0 5px"),$("table.summar").css("width","100%"),$("table.summar tr.top td").css("font-size","12pt"),$(".pages").css("display","none"),$("ul.category").css("display","none"),$("tr.cdRhtTr").css("display","table-row"),$("<div>").addClass("clear").appendTo("#ranking"),$("<div>").addClass("clear").insertBefore("#category_triumph");var t=$("<div>").css({margin:"20px auto 10px","text-align":"center",position:"relative"}).prependTo("#category_triumph, #category_nova");t.first().html("<span class='rankhead'>Triomphe</span><img alt='Triomphe' src='"+Main.k.servurl+"/img/rank_triumph.png' />"),t.last().html("<span class='rankhead'>Super NOVA</span><img alt='NOVA' src='"+Main.k.servurl+"/img/rank_nova.png' />")},GM_addStyle(GM_getResourceText("css:jgrowl")),eval(GM_getResourceText("jgrowl")),$.jGrowl.defaults.closerTemplate="",$.jGrowl.defaults.theme="ctrl-w",$.jGrowl.defaults.themeState="",eval(GM_getResourceText("mush")),Main.k.init(),Main.k.playing&&$("#topinfo_bar").length>0?Main.k.tabs.playing():$("#credits").length>0?Main.k.tabs.credits():$("#profile.cdTabTgt").length>0?Main.k.tabs.playerProfile():$("#ranking").length>0?Main.k.tabs.ranking():-1!=Main.k.window.location.href.indexOf("expPerma")?Main.k.tabs.expPerma():$("#gameover").length>0?Main.k.tabs.gameover():$("#mediaShow").length>0?($("#maincontainer, .boxcontainer").css("margin","0 auto 0"),$(".kmenu").css({position:"relative",top:"180px"}),$("a.logostart").css("top","20px")):$(".choosehero2").length>0&&(Main.k.Game.clear(),localStorage.setItem("ctrlw_newgame",1)),Main.k.debug&&Main.k.displayBug();
//# sourceMappingURL=CTRLW.mini.user.js.map